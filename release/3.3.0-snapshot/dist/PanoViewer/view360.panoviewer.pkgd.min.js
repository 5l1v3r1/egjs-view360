/*
Copyright (c) 2017 NAVER Corp.
@egjs/view360 project is licensed under the MIT license
@egjs/view360 JavaScript library
https://github.com/naver/egjs-view360
@version 3.3.0-snapshot
All-in-one packaged file for ease use of '@egjs/view360' with below dependencies.
- @egjs/agent ^2.1.5, @egjs/axes ^2.5.8, @egjs/component ^2.1.2, es6-promise ^4.2.5, gl-matrix ^3.1.0, motion-sensors-polyfill ^0.3.1
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t.eg=t.eg||{},t.eg.view360={}))}(this,(function(t){"use strict";function e(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function n(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}function i(){return(i=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}).apply(this,arguments)}function r(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}function o(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var s="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var a=function(t,e){return t(e={exports:{}},e.exports),e.exports}((function(t,e){t.exports=function(){function t(t){return"function"==typeof t}var e=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},n=0,i=void 0,r=void 0,o=function(t,e){d[n]=t,d[n+1]=e,2===(n+=2)&&(r?r(p):y())},a="undefined"!=typeof window?window:void 0,h=a||{},u=h.MutationObserver||h.WebKitMutationObserver,c="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),l="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function f(){var t=setTimeout;return function(){return t(p,1)}}var d=new Array(1e3);function p(){for(var t=0;t<n;t+=2)(0,d[t])(d[t+1]),d[t]=void 0,d[t+1]=void 0;n=0}var v,g,m,_,y=void 0;function E(t,e){var n=this,i=new this.constructor(w);void 0===i[T]&&V(i);var r=n._state;if(r){var s=arguments[r-1];o((function(){return L(r,i,s,n._result)}))}else D(n,i,t,e);return i}function x(t){if(t&&"object"==typeof t&&t.constructor===this)return t;var e=new this(w);return C(e,t),e}c?y=function(){return process.nextTick(p)}:u?(g=0,m=new u(p),_=document.createTextNode(""),m.observe(_,{characterData:!0}),y=function(){_.data=g=++g%2}):l?((v=new MessageChannel).port1.onmessage=p,y=function(){return v.port2.postMessage(0)}):y=void 0===a?function(){try{var t=Function("return this")().require("vertx");return void 0!==(i=t.runOnLoop||t.runOnContext)?function(){i(p)}:f()}catch(t){return f()}}():f();var T=Math.random().toString(36).substring(2);function w(){}var R=void 0,b=1,P=2;function A(e,n,i){n.constructor===e.constructor&&i===E&&n.constructor.resolve===x?function(t,e){e._state===b?I(t,e._result):e._state===P?S(t,e._result):D(e,void 0,(function(e){return C(t,e)}),(function(e){return S(t,e)}))}(e,n):void 0===i?I(e,n):t(i)?function(t,e,n){o((function(t){var i=!1,r=function(t,e,n,i){try{t.call(e,n,i)}catch(t){return t}}(n,e,(function(n){i||(i=!0,e!==n?C(t,n):I(t,n))}),(function(e){i||(i=!0,S(t,e))}),t._label);!i&&r&&(i=!0,S(t,r))}),t)}(e,n,i):I(e,n)}function C(t,e){if(t===e)S(t,new TypeError("You cannot resolve a promise with itself"));else if(function(t){var e=typeof t;return null!==t&&("object"===e||"function"===e)}(e)){var n=void 0;try{n=e.then}catch(e){return void S(t,e)}A(t,e,n)}else I(t,e)}function O(t){t._onerror&&t._onerror(t._result),M(t)}function I(t,e){t._state===R&&(t._result=e,t._state=b,0!==t._subscribers.length&&o(M,t))}function S(t,e){t._state===R&&(t._state=P,t._result=e,o(O,t))}function D(t,e,n,i){var r=t._subscribers,s=r.length;t._onerror=null,r[s]=e,r[s+b]=n,r[s+P]=i,0===s&&t._state&&o(M,t)}function M(t){var e=t._subscribers,n=t._state;if(0!==e.length){for(var i=void 0,r=void 0,o=t._result,s=0;s<e.length;s+=3)i=e[s],r=e[s+n],i?L(n,i,r,o):r(o);t._subscribers.length=0}}function L(e,n,i,r){var o=t(i),s=void 0,a=void 0,h=!0;if(o){try{s=i(r)}catch(t){h=!1,a=t}if(n===s)return void S(n,new TypeError("A promises callback cannot return that same promise."))}else s=r;n._state!==R||(o&&h?C(n,s):!1===h?S(n,a):e===b?I(n,s):e===P&&S(n,s))}var N=0;function V(t){t[T]=N++,t._state=void 0,t._result=void 0,t._subscribers=[]}var F=function(){function t(t,n){this._instanceConstructor=t,this.promise=new t(w),this.promise[T]||V(this.promise),e(n)?(this.length=n.length,this._remaining=n.length,this._result=new Array(this.length),0===this.length?I(this.promise,this._result):(this.length=this.length||0,this._enumerate(n),0===this._remaining&&I(this.promise,this._result))):S(this.promise,new Error("Array Methods must be provided an Array"))}return t.prototype._enumerate=function(t){for(var e=0;this._state===R&&e<t.length;e++)this._eachEntry(t[e],e)},t.prototype._eachEntry=function(t,e){var n=this._instanceConstructor,i=n.resolve;if(i===x){var r=void 0,o=void 0,s=!1;try{r=t.then}catch(t){s=!0,o=t}if(r===E&&t._state!==R)this._settledAt(t._state,e,t._result);else if("function"!=typeof r)this._remaining--,this._result[e]=t;else if(n===U){var a=new n(w);s?S(a,o):A(a,t,r),this._willSettleAt(a,e)}else this._willSettleAt(new n((function(e){return e(t)})),e)}else this._willSettleAt(i(t),e)},t.prototype._settledAt=function(t,e,n){var i=this.promise;i._state===R&&(this._remaining--,t===P?S(i,n):this._result[e]=n),0===this._remaining&&I(i,this._result)},t.prototype._willSettleAt=function(t,e){var n=this;D(t,void 0,(function(t){return n._settledAt(b,e,t)}),(function(t){return n._settledAt(P,e,t)}))},t}(),U=function(){function e(t){this[T]=N++,this._result=this._state=void 0,this._subscribers=[],w!==t&&("function"!=typeof t&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof e?function(t,e){try{e((function(e){C(t,e)}),(function(e){S(t,e)}))}catch(e){S(t,e)}}(this,t):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return e.prototype.catch=function(t){return this.then(null,t)},e.prototype.finally=function(e){var n=this.constructor;return t(e)?this.then((function(t){return n.resolve(e()).then((function(){return t}))}),(function(t){return n.resolve(e()).then((function(){throw t}))})):this.then(e,e)},e}();return U.prototype.then=E,U.all=function(t){return new F(this,t).promise},U.race=function(t){var n=this;return e(t)?new n((function(e,i){for(var r=t.length,o=0;o<r;o++)n.resolve(t[o]).then(e,i)})):new n((function(t,e){return e(new TypeError("You must pass an array to race."))}))},U.resolve=x,U.reject=function(t){var e=new this(w);return S(e,t),e},U._setScheduler=function(t){r=t},U._setAsap=function(t){o=t},U._asap=o,U.polyfill=function(){var t=void 0;if(void 0!==s)t=s;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var e=t.Promise;if(e){var n=null;try{n=Object.prototype.toString.call(e.resolve())}catch(t){}if("[object Promise]"===n&&!e.cast)return}t.Promise=U},U.Promise=U,U}()}));function h(t){return void 0===t}var u=function(){var t=function(){function t(){this._eventHandler={},this.options={}}var e=t.prototype;return e.trigger=function(t,e){void 0===e&&(e={});var n=this._eventHandler[t]||[],i=n.length>0;if(!i)return!0;n=n.concat(),e.eventType=t;var r=!1,o=[e],s=0;e.stop=function(){r=!0},e.currentTarget=this;for(var a=arguments.length,h=new Array(a>2?a-2:0),u=2;u<a;u++)h[u-2]=arguments[u];for(h.length>=1&&(o=o.concat(h)),s=0;n[s];s++)n[s].apply(this,o);return!r},e.once=function(t,e){if("object"==typeof t&&h(e)){var n,i=t;for(n in i)this.once(n,i[n]);return this}if("string"==typeof t&&"function"==typeof e){var r=this;this.on(t,(function n(){for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];e.apply(r,o),r.off(t,n)}))}return this},e.hasOn=function(t){return!!this._eventHandler[t]},e.on=function(t,e){if("object"==typeof t&&h(e)){var n,i=t;for(n in i)this.on(n,i[n]);return this}if("string"==typeof t&&"function"==typeof e){var r=this._eventHandler[t];h(r)&&(this._eventHandler[t]=[],r=this._eventHandler[t]),r.push(e)}return this},e.off=function(t,e){if(h(t))return this._eventHandler={},this;if(h(e)){if("string"==typeof t)return this._eventHandler[t]=void 0,this;var n,i=t;for(n in i)this.off(n,i[n]);return this}var r,o,s=this._eventHandler[t];if(s)for(r=0;void 0!==(o=s[r]);r++)if(o===e){s=s.splice(r,1);break}return this},t}();return t.VERSION="2.1.2",t}(),c=1e-6,l="undefined"!=typeof Float32Array?Float32Array:Array,f=Math.PI/180;function d(t){return t*f}function p(){var t=new l(9);return l!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function v(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function g(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],s=e[4],a=e[5],h=e[6],u=e[7],c=e[8],l=c*s-a*u,f=-c*o+a*h,d=u*o-s*h,p=n*l+i*f+r*d;return p?(p=1/p,t[0]=l*p,t[1]=(-c*i+r*u)*p,t[2]=(a*i-r*s)*p,t[3]=f*p,t[4]=(c*n-r*h)*p,t[5]=(-a*n+r*o)*p,t[6]=d*p,t[7]=(-u*n+i*h)*p,t[8]=(s*n-i*o)*p,t):null}function m(){var t=new l(16);return l!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function _(t,e,n){var i=Math.sin(n),r=Math.cos(n),o=e[4],s=e[5],a=e[6],h=e[7],u=e[8],c=e[9],l=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*r+u*i,t[5]=s*r+c*i,t[6]=a*r+l*i,t[7]=h*r+f*i,t[8]=u*r-o*i,t[9]=c*r-s*i,t[10]=l*r-a*i,t[11]=f*r-h*i,t}function y(t,e,n){var i=Math.sin(n),r=Math.cos(n),o=e[0],s=e[1],a=e[2],h=e[3],u=e[8],c=e[9],l=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*r-u*i,t[1]=s*r-c*i,t[2]=a*r-l*i,t[3]=h*r-f*i,t[8]=o*i+u*r,t[9]=s*i+c*r,t[10]=a*i+l*r,t[11]=h*i+f*r,t}function E(t,e,n,i,r){var o,s=1/Math.tan(e/2);return t[0]=s/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=r&&r!==1/0?(o=1/(i-r),t[10]=(r+i)*o,t[14]=2*r*i*o):(t[10]=-1,t[14]=-2*i),t}function x(){var t=new l(3);return l!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function T(t){var e=t[0],n=t[1],i=t[2];return Math.hypot(e,n,i)}function w(t,e,n){var i=new l(3);return i[0]=t,i[1]=e,i[2]=n,i}function R(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function b(t,e){var n=e[0],i=e[1],r=e[2],o=n*n+i*i+r*r;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t}function P(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function A(t,e,n){var i=e[0],r=e[1],o=e[2],s=n[0],a=n[1],h=n[2];return t[0]=r*h-o*a,t[1]=o*s-i*h,t[2]=i*a-r*s,t}function C(t,e,n){var i=e[0],r=e[1],o=e[2];return t[0]=i*n[0]+r*n[3]+o*n[6],t[1]=i*n[1]+r*n[4]+o*n[7],t[2]=i*n[2]+r*n[5]+o*n[8],t}function O(t,e,n){var i=n[0],r=n[1],o=n[2],s=n[3],a=e[0],h=e[1],u=e[2],c=r*u-o*h,l=o*a-i*u,f=i*h-r*a,d=r*f-o*l,p=o*c-i*f,v=i*l-r*c,g=2*s;return c*=g,l*=g,f*=g,d*=2,p*=2,v*=2,t[0]=a+c+d,t[1]=h+l+p,t[2]=u+f+v,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var I,S=R,D=T;I=x();!function(){var t,e=(t=new l(4),l!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t)}();function M(){var t=new l(4);return l!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function L(t,e,n){n*=.5;var i=Math.sin(n);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(n),t}function N(t,e,n){var i=e[0],r=e[1],o=e[2],s=e[3],a=n[0],h=n[1],u=n[2],c=n[3];return t[0]=i*c+s*a+r*u-o*h,t[1]=r*c+s*h+o*a-i*u,t[2]=o*c+s*u+i*h-r*a,t[3]=s*c-i*a-r*h-o*u,t}function V(t,e,n,i){var r,o,s,a,h,u=e[0],l=e[1],f=e[2],d=e[3],p=n[0],v=n[1],g=n[2],m=n[3];return(o=u*p+l*v+f*g+d*m)<0&&(o=-o,p=-p,v=-v,g=-g,m=-m),1-o>c?(r=Math.acos(o),s=Math.sin(r),a=Math.sin((1-i)*r)/s,h=Math.sin(i*r)/s):(a=1-i,h=i),t[0]=a*u+h*p,t[1]=a*l+h*v,t[2]=a*f+h*g,t[3]=a*d+h*m,t}function F(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}var U,W,Y,X,B,H,k=function(t){var e=new l(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},G=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},j=N,z=function(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],s=n*n+i*i+r*r+o*o;return s>0&&(s=1/Math.sqrt(s)),t[0]=n*s,t[1]=i*s,t[2]=r*s,t[3]=o*s,t},q=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]};U=x(),W=w(1,0,0),Y=w(0,1,0),X=M(),B=M(),H=p();function K(t,e){var n=new l(2);return n[0]=t,n[1]=e,n}function Q(t,e){return t[0]=e[0],t[1]=e[1],t}function Z(t,e){var n=e[0],i=e[1],r=n*n+i*i;return r>0&&(r=1/Math.sqrt(r)),t[0]=e[0]*r,t[1]=e[1]*r,t}!function(){var t,e=(t=new l(2),l!=Float32Array&&(t[0]=0,t[1]=0),t)}();var J="undefined"!=typeof window&&window.Math===Math?window:"undefined"!=typeof self&&self.Math===Math?self:Function("return this")(),$=J.document,tt=J.navigator&&J.navigator.userAgent||"",et=navigator.platform&&/iPad|iPhone|iPod/.test(navigator.platform),nt=-1!==tt.indexOf("Safari")&&-1===tt.indexOf("Chrome")&&-1!==tt.indexOf("Mac OS X")&&!et;/SamsungBrowser/i.test(tt);J.Float32Array=void 0!==J.Float32Array?J.Float32Array:J.Array;J.Float32Array;var it=J.getComputedStyle,rt=J.navigator.userAgent,ot="ontouchstart"in J,st="ondevicemotion"in J,at=J.DeviceMotionEvent,ht=J.devicePixelRatio,ut=(function(){for(var t=$.documentElement.style,e=["transform","webkitTransform","msTransform","mozTransform"],n=0,i=e.length;n<i;n++)if(e[n]in t)return e[n]}(),J.CSS&&J.CSS.supports&&J.CSS.supports("will-change","transform"),!1),ct=function(){navigator.xr&&(navigator.xr.isSessionSupported?navigator.xr.isSessionSupported("immersive-vr").then((function(){ut=!0})).catch((function(){})):navigator.xr.supportsSession&&navigator.xr.supportsSession("immersive-vr").then((function(){ut=!0})).catch((function(){})))};function lt(){return(lt=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}).apply(this,arguments)}function ft(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}function dt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var pt,vt="function"!=typeof Object.assign?function(t){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),n=1;n<arguments.length;n++){var i=arguments[n];if(null!=i)for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])}return e}:Object.assign,gt=["","webkit","Moz","MS","ms","o"],mt="undefined"==typeof document?{style:{}}:document.createElement("div"),_t="function",yt=Math.round,Et=Math.abs,xt=Date.now;function Tt(t,e){for(var n,i,r=e[0].toUpperCase()+e.slice(1),o=0;o<gt.length;){if((i=(n=gt[o])?n+r:e)in t)return i;o++}}pt="undefined"==typeof window?{}:window;var wt=Tt(mt.style,"touchAction"),Rt=void 0!==wt;var bt="auto",Pt="manipulation",At="none",Ct="pan-x",Ot="pan-y",It=function(){if(!Rt)return!1;var t={},e=pt.CSS&&pt.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach((function(n){return t[n]=!e||pt.CSS.supports("touch-action",n)})),t}(),St="ontouchstart"in pt,Dt=void 0!==Tt(pt,"PointerEvent"),Mt=St&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),Lt="touch",Nt="mouse",Vt=25,Ft=1,Ut=2,Wt=4,Yt=8,Xt=1,Bt=2,Ht=4,kt=8,Gt=16,jt=Bt|Ht,zt=kt|Gt,qt=jt|zt,Kt=["x","y"],Qt=["clientX","clientY"];function Zt(t,e,n){var i;if(t)if(t.forEach)t.forEach(e,n);else if(void 0!==t.length)for(i=0;i<t.length;)e.call(n,t[i],i,t),i++;else for(i in t)t.hasOwnProperty(i)&&e.call(n,t[i],i,t)}function Jt(t,e){return typeof t===_t?t.apply(e&&e[0]||void 0,e):t}function $t(t,e){return t.indexOf(e)>-1}var te=function(){function t(t,e){this.manager=t,this.set(e)}var e=t.prototype;return e.set=function(t){"compute"===t&&(t=this.compute()),Rt&&this.manager.element.style&&It[t]&&(this.manager.element.style[wt]=t),this.actions=t.toLowerCase().trim()},e.update=function(){this.set(this.manager.options.touchAction)},e.compute=function(){var t=[];return Zt(this.manager.recognizers,(function(e){Jt(e.options.enable,[e])&&(t=t.concat(e.getTouchAction()))})),function(t){if($t(t,At))return At;var e=$t(t,Ct),n=$t(t,Ot);return e&&n?At:e||n?e?Ct:Ot:$t(t,Pt)?Pt:bt}(t.join(" "))},e.preventDefaults=function(t){var e=t.srcEvent,n=t.offsetDirection;if(this.manager.session.prevented)e.preventDefault();else{var i=this.actions,r=$t(i,At)&&!It[At],o=$t(i,Ot)&&!It[Ot],s=$t(i,Ct)&&!It[Ct];if(r){var a=1===t.pointers.length,h=t.distance<2,u=t.deltaTime<250;if(a&&h&&u)return}if(!s||!o)return r||o&&n&jt||s&&n&zt?this.preventSrc(e):void 0}},e.preventSrc=function(t){this.manager.session.prevented=!0,t.preventDefault()},t}();function ee(t,e){for(;t;){if(t===e)return!0;t=t.parentNode}return!1}function ne(t){var e=t.length;if(1===e)return{x:yt(t[0].clientX),y:yt(t[0].clientY)};for(var n=0,i=0,r=0;r<e;)n+=t[r].clientX,i+=t[r].clientY,r++;return{x:yt(n/e),y:yt(i/e)}}function ie(t){for(var e=[],n=0;n<t.pointers.length;)e[n]={clientX:yt(t.pointers[n].clientX),clientY:yt(t.pointers[n].clientY)},n++;return{timeStamp:xt(),pointers:e,center:ne(e),deltaX:t.deltaX,deltaY:t.deltaY}}function re(t,e,n){n||(n=Kt);var i=e[n[0]]-t[n[0]],r=e[n[1]]-t[n[1]];return Math.sqrt(i*i+r*r)}function oe(t,e,n){n||(n=Kt);var i=e[n[0]]-t[n[0]],r=e[n[1]]-t[n[1]];return 180*Math.atan2(r,i)/Math.PI}function se(t,e){return t===e?Xt:Et(t)>=Et(e)?t<0?Bt:Ht:e<0?kt:Gt}function ae(t,e,n){return{x:e/t||0,y:n/t||0}}function he(t,e){var n=t.session,i=e.pointers,r=i.length;n.firstInput||(n.firstInput=ie(e)),r>1&&!n.firstMultiple?n.firstMultiple=ie(e):1===r&&(n.firstMultiple=!1);var o=n.firstInput,s=n.firstMultiple,a=s?s.center:o.center,h=e.center=ne(i);e.timeStamp=xt(),e.deltaTime=e.timeStamp-o.timeStamp,e.angle=oe(a,h),e.distance=re(a,h),function(t,e){var n=e.center,i=t.offsetDelta||{},r=t.prevDelta||{},o=t.prevInput||{};e.eventType!==Ft&&o.eventType!==Wt||(r=t.prevDelta={x:o.deltaX||0,y:o.deltaY||0},i=t.offsetDelta={x:n.x,y:n.y}),e.deltaX=r.x+(n.x-i.x),e.deltaY=r.y+(n.y-i.y)}(n,e),e.offsetDirection=se(e.deltaX,e.deltaY);var u,c,l=ae(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=l.x,e.overallVelocityY=l.y,e.overallVelocity=Et(l.x)>Et(l.y)?l.x:l.y,e.scale=s?(u=s.pointers,re((c=i)[0],c[1],Qt)/re(u[0],u[1],Qt)):1,e.rotation=s?function(t,e){return oe(e[1],e[0],Qt)+oe(t[1],t[0],Qt)}(s.pointers,i):0,e.maxPointers=n.prevInput?e.pointers.length>n.prevInput.maxPointers?e.pointers.length:n.prevInput.maxPointers:e.pointers.length,function(t,e){var n,i,r,o,s=t.lastInterval||e,a=e.timeStamp-s.timeStamp;if(e.eventType!==Yt&&(a>Vt||void 0===s.velocity)){var h=e.deltaX-s.deltaX,u=e.deltaY-s.deltaY,c=ae(a,h,u);i=c.x,r=c.y,n=Et(c.x)>Et(c.y)?c.x:c.y,o=se(h,u),t.lastInterval=e}else n=s.velocity,i=s.velocityX,r=s.velocityY,o=s.direction;e.velocity=n,e.velocityX=i,e.velocityY=r,e.direction=o}(n,e);var f,d=t.element,p=e.srcEvent;ee(f=p.composedPath?p.composedPath()[0]:p.path?p.path[0]:p.target,d)&&(d=f),e.target=d}function ue(t,e,n){var i=n.pointers.length,r=n.changedPointers.length,o=e&Ft&&i-r==0,s=e&(Wt|Yt)&&i-r==0;n.isFirst=!!o,n.isFinal=!!s,o&&(t.session={}),n.eventType=e,he(t,n),t.emit("hammer.input",n),t.recognize(n),t.session.prevInput=n}function ce(t){return t.trim().split(/\s+/g)}function le(t,e,n){Zt(ce(e),(function(e){t.addEventListener(e,n,!1)}))}function fe(t,e,n){Zt(ce(e),(function(e){t.removeEventListener(e,n,!1)}))}function de(t){var e=t.ownerDocument||t;return e.defaultView||e.parentWindow||window}var pe=function(){function t(t,e){var n=this;this.manager=t,this.callback=e,this.element=t.element,this.target=t.options.inputTarget,this.domHandler=function(e){Jt(t.options.enable,[t])&&n.handler(e)},this.init()}var e=t.prototype;return e.handler=function(){},e.init=function(){this.evEl&&le(this.element,this.evEl,this.domHandler),this.evTarget&&le(this.target,this.evTarget,this.domHandler),this.evWin&&le(de(this.element),this.evWin,this.domHandler)},e.destroy=function(){this.evEl&&fe(this.element,this.evEl,this.domHandler),this.evTarget&&fe(this.target,this.evTarget,this.domHandler),this.evWin&&fe(de(this.element),this.evWin,this.domHandler)},t}();function ve(t,e,n){if(t.indexOf&&!n)return t.indexOf(e);for(var i=0;i<t.length;){if(n&&t[i][n]==e||!n&&t[i]===e)return i;i++}return-1}var ge={pointerdown:Ft,pointermove:Ut,pointerup:Wt,pointercancel:Yt,pointerout:Yt},me={2:Lt,3:"pen",4:Nt,5:"kinect"},_e="pointerdown",ye="pointermove pointerup pointercancel";pt.MSPointerEvent&&!pt.PointerEvent&&(_e="MSPointerDown",ye="MSPointerMove MSPointerUp MSPointerCancel");var Ee=function(t){function e(){var n,i=e.prototype;return i.evEl=_e,i.evWin=ye,(n=t.apply(this,arguments)||this).store=n.manager.session.pointerEvents=[],n}return ft(e,t),e.prototype.handler=function(t){var e=this.store,n=!1,i=t.type.toLowerCase().replace("ms",""),r=ge[i],o=me[t.pointerType]||t.pointerType,s=o===Lt,a=ve(e,t.pointerId,"pointerId");r&Ft&&(0===t.button||s)?a<0&&(e.push(t),a=e.length-1):r&(Wt|Yt)&&(n=!0),a<0||(e[a]=t,this.callback(this.manager,r,{pointers:e,changedPointers:[t],pointerType:o,srcEvent:t}),n&&e.splice(a,1))},e}(pe);function xe(t){return Array.prototype.slice.call(t,0)}function Te(t,e,n){for(var i=[],r=[],o=0;o<t.length;){var s=e?t[o][e]:t[o];ve(r,s)<0&&i.push(t[o]),r[o]=s,o++}return n&&(i=e?i.sort((function(t,n){return t[e]>n[e]})):i.sort()),i}var we={touchstart:Ft,touchmove:Ut,touchend:Wt,touchcancel:Yt},Re="touchstart touchmove touchend touchcancel",be=function(t){function e(){var n;return e.prototype.evTarget=Re,(n=t.apply(this,arguments)||this).targetIds={},n}return ft(e,t),e.prototype.handler=function(t){var e=we[t.type],n=Pe.call(this,t,e);n&&this.callback(this.manager,e,{pointers:n[0],changedPointers:n[1],pointerType:Lt,srcEvent:t})},e}(pe);function Pe(t,e){var n,i,r=xe(t.touches),o=this.targetIds;if(e&(Ft|Ut)&&1===r.length)return o[r[0].identifier]=!0,[r,r];var s=xe(t.changedTouches),a=[],h=this.target;if(i=r.filter((function(t){return ee(t.target,h)})),e===Ft)for(n=0;n<i.length;)o[i[n].identifier]=!0,n++;for(n=0;n<s.length;)o[s[n].identifier]&&a.push(s[n]),e&(Wt|Yt)&&delete o[s[n].identifier],n++;return a.length?[Te(i.concat(a),"identifier",!0),a]:void 0}var Ae={mousedown:Ft,mousemove:Ut,mouseup:Wt},Ce="mousedown",Oe="mousemove mouseup",Ie=function(t){function e(){var n,i=e.prototype;return i.evEl=Ce,i.evWin=Oe,(n=t.apply(this,arguments)||this).pressed=!1,n}return ft(e,t),e.prototype.handler=function(t){var e=Ae[t.type];e&Ft&&0===t.button&&(this.pressed=!0),e&Ut&&1!==t.which&&(e=Wt),this.pressed&&(e&Wt&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:Nt,srcEvent:t}))},e}(pe),Se=2500,De=25;function Me(t){var e=t.changedPointers[0];if(e.identifier===this.primaryTouch){var n={x:e.clientX,y:e.clientY},i=this.lastTouches;this.lastTouches.push(n);setTimeout((function(){var t=i.indexOf(n);t>-1&&i.splice(t,1)}),Se)}}function Le(t,e){t&Ft?(this.primaryTouch=e.changedPointers[0].identifier,Me.call(this,e)):t&(Wt|Yt)&&Me.call(this,e)}function Ne(t){for(var e=t.srcEvent.clientX,n=t.srcEvent.clientY,i=0;i<this.lastTouches.length;i++){var r=this.lastTouches[i],o=Math.abs(e-r.x),s=Math.abs(n-r.y);if(o<=De&&s<=De)return!0}return!1}var Ve=function(){return function(t){function e(e,n){var i;return(i=t.call(this,e,n)||this).handler=function(t,e,n){var r=n.pointerType===Lt,o=n.pointerType===Nt;if(!(o&&n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents)){if(r)Le.call(dt(dt(i)),e,n);else if(o&&Ne.call(dt(dt(i)),n))return;i.callback(t,e,n)}},i.touch=new be(i.manager,i.handler),i.mouse=new Ie(i.manager,i.handler),i.primaryTouch=null,i.lastTouches=[],i}return ft(e,t),e.prototype.destroy=function(){this.touch.destroy(),this.mouse.destroy()},e}(pe)}();function Fe(t,e,n){return!!Array.isArray(t)&&(Zt(t,n[e],n),!0)}var Ue=1,We=2,Ye=4,Xe=8,Be=Xe,He=16,ke=1;function Ge(t,e){var n=e.manager;return n?n.get(t):t}function je(t){return t&He?"cancel":t&Xe?"end":t&Ye?"move":t&We?"start":""}var ze=function(){function t(t){void 0===t&&(t={}),this.options=lt({enable:!0},t),this.id=ke++,this.manager=null,this.state=Ue,this.simultaneous={},this.requireFail=[]}var e=t.prototype;return e.set=function(t){return vt(this.options,t),this.manager&&this.manager.touchAction.update(),this},e.recognizeWith=function(t){if(Fe(t,"recognizeWith",this))return this;var e=this.simultaneous;return e[(t=Ge(t,this)).id]||(e[t.id]=t,t.recognizeWith(this)),this},e.dropRecognizeWith=function(t){return Fe(t,"dropRecognizeWith",this)?this:(t=Ge(t,this),delete this.simultaneous[t.id],this)},e.requireFailure=function(t){if(Fe(t,"requireFailure",this))return this;var e=this.requireFail;return-1===ve(e,t=Ge(t,this))&&(e.push(t),t.requireFailure(this)),this},e.dropRequireFailure=function(t){if(Fe(t,"dropRequireFailure",this))return this;t=Ge(t,this);var e=ve(this.requireFail,t);return e>-1&&this.requireFail.splice(e,1),this},e.hasRequireFailures=function(){return this.requireFail.length>0},e.canRecognizeWith=function(t){return!!this.simultaneous[t.id]},e.emit=function(t){var e=this,n=this.state;function i(n){e.manager.emit(n,t)}n<Xe&&i(e.options.event+je(n)),i(e.options.event),t.additionalEvent&&i(t.additionalEvent),n>=Xe&&i(e.options.event+je(n))},e.tryEmit=function(t){if(this.canEmit())return this.emit(t);this.state=32},e.canEmit=function(){for(var t=0;t<this.requireFail.length;){if(!(this.requireFail[t].state&(32|Ue)))return!1;t++}return!0},e.recognize=function(t){var e=vt({},t);if(!Jt(this.options.enable,[this,e]))return this.reset(),void(this.state=32);this.state&(Be|He|32)&&(this.state=Ue),this.state=this.process(e),this.state&(We|Ye|Xe|He)&&this.tryEmit(e)},e.process=function(t){},e.getTouchAction=function(){},e.reset=function(){},t}(),qe=function(t){function e(e){return void 0===e&&(e={}),t.call(this,lt({pointers:1},e))||this}ft(e,t);var n=e.prototype;return n.attrTest=function(t){var e=this.options.pointers;return 0===e||t.pointers.length===e},n.process=function(t){var e=this.state,n=t.eventType,i=e&(We|Ye),r=this.attrTest(t);return i&&(n&Yt||!r)?e|He:i||r?n&Wt?e|Xe:e&We?e|Ye:We:32},e}(ze);function Ke(t){return t===Gt?"down":t===kt?"up":t===Bt?"left":t===Ht?"right":""}var Qe=function(t){function e(e){var n;return void 0===e&&(e={}),(n=t.call(this,lt({event:"pan",threshold:10,pointers:1,direction:qt},e))||this).pX=null,n.pY=null,n}ft(e,t);var n=e.prototype;return n.getTouchAction=function(){var t=this.options.direction,e=[];return t&jt&&e.push(Ot),t&zt&&e.push(Ct),e},n.directionTest=function(t){var e=this.options,n=!0,i=t.distance,r=t.direction,o=t.deltaX,s=t.deltaY;return r&e.direction||(e.direction&jt?(r=0===o?Xt:o<0?Bt:Ht,n=o!==this.pX,i=Math.abs(t.deltaX)):(r=0===s?Xt:s<0?kt:Gt,n=s!==this.pY,i=Math.abs(t.deltaY))),t.direction=r,n&&i>e.threshold&&r&e.direction},n.attrTest=function(t){return qe.prototype.attrTest.call(this,t)&&(this.state&We||!(this.state&We)&&this.directionTest(t))},n.emit=function(e){this.pX=e.deltaX,this.pY=e.deltaY;var n=Ke(e.direction);n&&(e.additionalEvent=this.options.event+n),t.prototype.emit.call(this,e)},e}(qe),Ze=function(t){function e(e){return void 0===e&&(e={}),t.call(this,lt({event:"pinch",threshold:0,pointers:2},e))||this}ft(e,t);var n=e.prototype;return n.getTouchAction=function(){return[At]},n.attrTest=function(e){return t.prototype.attrTest.call(this,e)&&(Math.abs(e.scale-1)>this.options.threshold||this.state&We)},n.emit=function(e){if(1!==e.scale){var n=e.scale<1?"in":"out";e.additionalEvent=this.options.event+n}t.prototype.emit.call(this,e)},e}(qe),Je={domEvents:!1,touchAction:"compute",enable:!0,inputTarget:null,inputClass:null,cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};function $e(t,e){var n,i=t.element;i.style&&(Zt(t.options.cssProps,(function(r,o){n=Tt(i.style,o),e?(t.oldCssProps[n]=i.style[n],i.style[n]=r):i.style[n]=t.oldCssProps[n]||""})),e||(t.oldCssProps={}))}var tn=function(){function t(t,e){var n,i=this;this.options=vt({},Je,e||{}),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=t,this.input=new((n=this).options.inputClass||(Dt?Ee:Mt?be:St?Ve:Ie))(n,ue),this.touchAction=new te(this,this.options.touchAction),$e(this,!0),Zt(this.options.recognizers,(function(t){var e=i.add(new t[0](t[1]));t[2]&&e.recognizeWith(t[2]),t[3]&&e.requireFailure(t[3])}),this)}var e=t.prototype;return e.set=function(t){return vt(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},e.stop=function(t){this.session.stopped=t?2:1},e.recognize=function(t){var e=this.session;if(!e.stopped){var n;this.touchAction.preventDefaults(t);var i=this.recognizers,r=e.curRecognizer;(!r||r&&r.state&Be)&&(e.curRecognizer=null,r=null);for(var o=0;o<i.length;)n=i[o],2===e.stopped||r&&n!==r&&!n.canRecognizeWith(r)?n.reset():n.recognize(t),!r&&n.state&(We|Ye|Xe)&&(e.curRecognizer=n,r=n),o++}},e.get=function(t){if(t instanceof ze)return t;for(var e=this.recognizers,n=0;n<e.length;n++)if(e[n].options.event===t)return e[n];return null},e.add=function(t){if(Fe(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t},e.remove=function(t){if(Fe(t,"remove",this))return this;var e=this.get(t);if(t){var n=this.recognizers,i=ve(n,e);-1!==i&&(n.splice(i,1),this.touchAction.update())}return this},e.on=function(t,e){if(void 0===t||void 0===e)return this;var n=this.handlers;return Zt(ce(t),(function(t){n[t]=n[t]||[],n[t].push(e)})),this},e.off=function(t,e){if(void 0===t)return this;var n=this.handlers;return Zt(ce(t),(function(t){e?n[t]&&n[t].splice(ve(n[t],e),1):delete n[t]})),this},e.emit=function(t,e){this.options.domEvents&&function(t,e){var n=document.createEvent("Event");n.initEvent(t,!0,!0),n.gesture=e,e.target.dispatchEvent(n)}(t,e);var n=this.handlers[t]&&this.handlers[t].slice();if(n&&n.length){e.type=t,e.preventDefault=function(){e.srcEvent.preventDefault()};for(var i=0;i<n.length;)n[i](e),i++}},e.destroy=function(){this.element&&$e(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null},t}();function en(t,e,n){var i="DEPRECATED METHOD: "+e+"\n"+n+" AT \n";return function(){var e=new Error("get-stack-trace"),n=e&&e.stack?e.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",r=window.console&&(window.console.warn||window.console.log);return r&&r.call(window.console,i,n),t.apply(this,arguments)}}var nn=en((function(t,e,n){for(var i=Object.keys(e),r=0;r<i.length;)(!n||n&&void 0===t[i[r]])&&(t[i[r]]=e[i[r]]),r++;return t}),"extend","Use `assign`.");en((function(t,e){return nn(t,e,!0)}),"merge","Use `assign`.");var rn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};function on(t,e){function n(){this.constructor=t}rn(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var sn,an=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t};function hn(t,e,n,i){var r=t,o=[n[0]?e[0]:i?e[0]-i[0]:e[0],n[1]?e[1]:i?e[1]+i[1]:e[1]];return r=Math.max(o[0],r),r=Math.min(o[1],r)}function un(t,e){return t<e[0]||t>e[1]}function cn(t,e,n){return n[1]&&t>e[1]||n[0]&&t<e[0]}function ln(t,e,n){var i=t,r=e[0],o=e[1],s=o-r;return n[1]&&t>o&&(i=(i-o)%s+r),n[0]&&t<r&&(i=(i-r)%s+o),i}function fn(t){for(var e=[],n=0,i=t.length;n<i;n++)e.push(t[n]);return e}function dn(t,e){var n;if(void 0===e&&(e=!1),"string"==typeof t){if(t.match(/^<([a-z]+)\s*([^>]*)>/)){var i=document.createElement("div");i.innerHTML=t,n=fn(i.childNodes)}else n=fn(document.querySelectorAll(t));e||(n=n.length>=1?n[0]:void 0)}else t===sn?n=t:!t.nodeName||1!==t.nodeType&&9!==t.nodeType?"jQuery"in sn&&t instanceof jQuery||t.constructor.prototype.jquery?n=e?t.toArray():t.get(0):Array.isArray(t)&&(n=t.map((function(t){return dn(t)})),e||(n=n.length>=1?n[0]:void 0)):n=t;return n}var pn=(sn="undefined"==typeof window?{}:window).requestAnimationFrame||sn.webkitRequestAnimationFrame,vn=sn.cancelAnimationFrame||sn.webkitCancelAnimationFrame;if(pn&&!vn){var gn={},mn=pn;pn=function(t){var e=mn((function(n){gn[e]&&t(n)}));return gn[e]=!0,e},vn=function(t){delete gn[t]}}else pn&&vn||(pn=function(t){return sn.setTimeout((function(){t(sn.performance&&sn.performance.now&&sn.performance.now()||(new Date).getTime())}),16)},vn=sn.clearTimeout);function _n(t,e){var n={};for(var i in t)i&&(n[i]=e(t[i],i));return n}function yn(t,e){var n={};for(var i in t)i&&e(t[i],i)&&(n[i]=t[i]);return n}function En(t,e){for(var n in t)if(n&&!e(t[n],n))return!1;return!0}function xn(t,e){return En(t,(function(t,n){return t===e[n]}))}var Tn={};function wn(t,e){return Tn[e]||(Tn[e]=function(t){var e=t<1?Math.pow(10,bn(t)):1;return function(n){return 0===t?0:Math.round(Math.round(n/t)*t*e)/e}}(e)),Tn[e](t)}function Rn(t,e){if(!t||!e)return t;var n="number"==typeof e;return _n(t,(function(t,i){return wn(t,n?e:e[i])}))}function bn(t){if(!isFinite(t))return 0;var e=t+"";if(e.indexOf("e")>=0){for(var n=0,i=1;Math.round(t*i)/i!==t;)i*=10,n++;return n}return e.indexOf(".")>=0?e.length-e.indexOf(".")-1:0}function Pn(t,e,n){return Math.max(Math.min(t,n),e)}var An=function(){function t(t){var e=t.options,n=t.itm,i=t.em,r=t.axm;this.options=e,this.itm=n,this.em=i,this.axm=r,this.animationEnd=this.animationEnd.bind(this)}var e=t.prototype;return e.getDuration=function(t,e,n){var i,r=this;if(void 0!==n)i=n;else{var o=_n(e,(function(e,n){return function(t,e){var n=Math.sqrt(t/e*2);return n<100?0:n}(Math.abs(e-t[n]),r.options.deceleration)}));i=Object.keys(o).reduce((function(t,e){return Math.max(t,o[e])}),-1/0)}return Pn(i,this.options.minimumDuration,this.options.maximumDuration)},e.createAnimationParam=function(t,e,n){var i=this.axm.get(),r=t,o=n&&n.event||null;return{depaPos:i,destPos:r,duration:Pn(e,this.options.minimumDuration,this.options.maximumDuration),delta:this.axm.getDelta(i,r),inputEvent:o,input:n&&n.input||null,isTrusted:!!o,done:this.animationEnd}},e.grab=function(t,e){if(this._animateParam&&t.length){var n=this.axm.get(t),i=this.axm.map(n,(function(t,e){return ln(t,e.range,e.circular)}));En(i,(function(t,e){return n[e]===t}))||this.em.triggerChange(i,!1,n,e,!!e),this._animateParam=null,this._raf&&(r=this._raf,vn(r)),this._raf=null,this.em.triggerAnimationEnd(!(!e||!e.event))}var r},e.getEventInfo=function(){return this._animateParam&&this._animateParam.input&&this._animateParam.inputEvent?{input:this._animateParam.input,event:this._animateParam.inputEvent}:null},e.restore=function(t){var e=this.axm.get(),n=this.axm.map(e,(function(t,e){return Math.min(e.range[1],Math.max(e.range[0],t))}));this.animateTo(n,this.getDuration(e,n),t)},e.animationEnd=function(){var t=this.getEventInfo();this._animateParam=null;var e=this.axm.filter(this.axm.get(),(function(t,e){return cn(t,e.range,e.circular)}));Object.keys(e).length>0&&this.setTo(this.axm.map(e,(function(t,e){return ln(t,e.range,e.circular)}))),this.itm.setInterrupt(!1),this.em.triggerAnimationEnd(!!t),this.axm.isOutside()?this.restore(t):this.finish(!!t)},e.finish=function(t){this._animateParam=null,this.itm.setInterrupt(!1),this.em.triggerFinish(t)},e.animateLoop=function(t,e){if(t.duration){this._animateParam=an({},t);var n=this._animateParam,i=this,r=n.destPos,o=n.depaPos,s=0,a=_n(o,(function(t,e){return t<=r[e]?1:-1})),h=_n(r,(function(t){return t})),u=(new Date).getTime();n.startTime=u,function c(){i._raf=null;var l=(new Date).getTime(),f=(l-n.startTime)/t.duration,d=i.easing(f),p=i.axm.map(o,(function(t,e,i){var h=f>=1?r[i]:t+n.delta[i]*(d-s),u=ln(h,e.range,e.circular);if(h!==u){var c=a[i]*(e.range[1]-e.range[0]);r[i]-=c,o[i]-=c}return u})),v=!i.em.triggerChange(p,!1,o);if(o=p,u=l,s=d,d>=1)return xn(r=i.getFinalPos(r,h),i.axm.get(Object.keys(r)))||i.em.triggerChange(r,!0,o),void e();v?i.finish(!1):i._raf=pn(c)}()}else this.em.triggerChange(t.destPos,!0),e()},e.getFinalPos=function(t,e){var n=this;return _n(t,(function(t,i){return t>=e[i]-1e-6&&t<=e[i]+1e-6?e[i]:wn(t,n.getRoundUnit(t,i))}))},e.getRoundUnit=function(t,e){var n,i=this.options.round,r=null;if(!i){var o=this.axm.getAxisOptions(e);n=Math.max(bn(o.range[0]),bn(o.range[1]),bn(t)),r=1/Math.pow(10,n)}return r||i},e.getUserControll=function(t){var e=t.setTo();return e.destPos=this.axm.get(e.destPos),e.duration=Pn(e.duration,this.options.minimumDuration,this.options.maximumDuration),e},e.animateTo=function(t,e,n){var i=this,r=this.createAnimationParam(t,e,n),o=an({},r.depaPos),s=this.em.triggerAnimationStart(r),a=this.getUserControll(r);if(!s&&this.axm.every(a.destPos,(function(t,e){return cn(t,e.range,e.circular)}))&&console.warn("You can't stop the 'animation' event when 'circular' is true."),s&&!xn(a.destPos,o)){var h=n&&n.event||null;this.animateLoop({depaPos:o,destPos:a.destPos,duration:a.duration,delta:this.axm.getDelta(o,a.destPos),isTrusted:!!h,inputEvent:h,input:n&&n.input||null},(function(){return i.animationEnd()}))}},e.easing=function(t){return t>1?1:this.options.easing(t)},e.setTo=function(t,e){void 0===e&&(e=0);var n=Object.keys(t);this.grab(n);var i=this.axm.get(n);if(xn(t,i))return this;this.itm.setInterrupt(!0);var r=yn(t,(function(t,e){return i[e]!==t}));return Object.keys(r).length?xn(r=this.axm.map(r,(function(t,e){var n=e.range,i=e.circular;return i&&(i[0]||i[1])?t:hn(t,n,i)})),i)?this:(e>0?this.animateTo(r,e):(this.em.triggerChange(r),this.finish(!1)),this):this},e.setBy=function(t,e){return void 0===e&&(e=0),this.setTo(_n(this.axm.get(Object.keys(t)),(function(e,n){return e+t[n]})),e)},t}(),Cn=function(){function t(t){this.axes=t}var e=t.prototype;return e.triggerHold=function(t,e){var n=this.getRoundPos(t).roundPos;this.axes.trigger("hold",{pos:n,input:e.input||null,inputEvent:e.event||null,isTrusted:!0})},e.triggerRelease=function(t){var e=this.getRoundPos(t.destPos,t.depaPos),n=e.roundPos,i=e.roundDepa;t.destPos=n,t.depaPos=i,t.setTo=this.createUserControll(t.destPos,t.duration),this.axes.trigger("release",t)},e.triggerChange=function(t,e,n,i,r){void 0===r&&(r=!1);var o=this.am,s=o.axm,a=o.getEventInfo(),h=this.getRoundPos(t,n),u=h.roundPos,c=h.roundDepa,l=s.moveTo(u,c),f=i&&i.event||a&&a.event||null,d={pos:l.pos,delta:l.delta,holding:r,inputEvent:f,isTrusted:!!f,input:i&&i.input||a&&a.input||null,set:f?this.createUserControll(l.pos):function(){}},p=this.axes.trigger("change",d);return f&&s.set(d.set().destPos),p},e.triggerAnimationStart=function(t){var e=this.getRoundPos(t.destPos,t.depaPos),n=e.roundPos,i=e.roundDepa;return t.destPos=n,t.depaPos=i,t.setTo=this.createUserControll(t.destPos,t.duration),this.axes.trigger("animationStart",t)},e.triggerAnimationEnd=function(t){void 0===t&&(t=!1),this.axes.trigger("animationEnd",{isTrusted:t})},e.triggerFinish=function(t){void 0===t&&(t=!1),this.axes.trigger("finish",{isTrusted:t})},e.createUserControll=function(t,e){void 0===e&&(e=0);var n={destPos:an({},t),duration:e};return function(t,e){return t&&(n.destPos=an({},t)),void 0!==e&&(n.duration=e),n}},e.setAnimationManager=function(t){this.am=t},e.destroy=function(){this.axes.off()},e.getRoundPos=function(t,e){var n=this.axes.options.round;return{roundPos:Rn(t,n),roundDepa:Rn(e,n)}},t}(),On=function(){function t(t){this.options=t,this._prevented=!1}var e=t.prototype;return e.isInterrupting=function(){return this.options.interruptable||this._prevented},e.isInterrupted=function(){return!this.options.interruptable&&this._prevented},e.setInterrupt=function(t){!this.options.interruptable&&(this._prevented=t)},t}(),In=function(){function t(t,e){var n=this;this.axis=t,this.options=e,this._complementOptions(),this._pos=Object.keys(this.axis).reduce((function(t,e){return t[e]=n.axis[e].range[0],t}),{})}var e=t.prototype;return e._complementOptions=function(){var t=this;Object.keys(this.axis).forEach((function(e){t.axis[e]=an({range:[0,100],bounce:[0,0],circular:[!1,!1]},t.axis[e]),["bounce","circular"].forEach((function(n){var i=t.axis,r=i[e][n];/string|number|boolean/.test(typeof r)&&(i[e][n]=[r,r])}))}))},e.getDelta=function(t,e){var n=this.get(t);return _n(this.get(e),(function(t,e){return t-n[e]}))},e.get=function(t){var e=this;return t&&Array.isArray(t)?t.reduce((function(t,n){return n&&n in e._pos&&(t[n]=e._pos[n]),t}),{}):an({},this._pos,t||{})},e.moveTo=function(t,e){void 0===e&&(e=this._pos);var n=_n(this._pos,(function(n,i){return i in t&&i in e?t[i]-e[i]:0}));return this.set(this.map(t,(function(t,e){return e?ln(t,e.range,e.circular):0}))),{pos:an({},this._pos),delta:n}},e.set=function(t){for(var e in t)e&&e in this._pos&&(this._pos[e]=t[e])},e.every=function(t,e){var n=this.axis;return En(t,(function(t,i){return e(t,n[i],i)}))},e.filter=function(t,e){var n=this.axis;return yn(t,(function(t,i){return e(t,n[i],i)}))},e.map=function(t,e){var n=this.axis;return _n(t,(function(t,i){return e(t,n[i],i)}))},e.isOutside=function(t){return!this.every(t?this.get(t):this._pos,(function(t,e){return!un(t,e.range)}))},e.getAxisOptions=function(t){return this.axis[t]},t}(),Sn=function(){function t(t){var e=t.options,n=t.itm,i=t.em,r=t.axm,o=t.am;this.isOutside=!1,this.moveDistance=null,this.isStopped=!1,this.options=e,this.itm=n,this.em=i,this.axm=r,this.am=o}var e=t.prototype;return e.atOutside=function(t){var e=this;if(this.isOutside)return this.axm.map(t,(function(t,e){var n=e.range[0]-e.bounce[0],i=e.range[1]+e.bounce[1];return t>i?i:t<n?n:t}));var n=this.am.easing(1e-5)/1e-5;return this.axm.map(t,(function(t,i){var r=i.range[0],o=i.range[1],s=i.bounce,a=i.circular;return a&&(a[0]||a[1])?t:t<r?r-e.am.easing((r-t)/(s[0]*n))*s[0]:t>o?o+e.am.easing((t-o)/(s[1]*n))*s[1]:t}))},e.get=function(t){return this.axm.get(t.axes)},e.hold=function(t,e){if(!this.itm.isInterrupted()&&t.axes.length){var n={input:t,event:e};this.isStopped=!1,this.itm.setInterrupt(!0),this.am.grab(t.axes,n),!this.moveDistance&&this.em.triggerHold(this.axm.get(),n),this.isOutside=this.axm.isOutside(t.axes),this.moveDistance=this.axm.get(t.axes)}},e.change=function(t,e,n){if(!this.isStopped&&this.itm.isInterrupting()&&!this.axm.every(n,(function(t){return 0===t}))){var i,r=this.moveDistance||this.axm.get(t.axes);i=_n(r,(function(t,e){return t+(n[e]||0)})),this.moveDistance&&(this.moveDistance=i),this.isOutside&&this.axm.every(r,(function(t,e){return!un(t,e.range)}))&&(this.isOutside=!1),r=this.atOutside(r),i=this.atOutside(i),!this.em.triggerChange(i,!1,r,{input:t,event:e},!0)&&(this.isStopped=!0,this.moveDistance=null,this.am.finish(!1))}},e.release=function(t,e,n,i){if(!this.isStopped&&this.itm.isInterrupting()&&this.moveDistance){var r=this.axm.get(t.axes),o=this.axm.get(),s=this.axm.get(this.axm.map(n,(function(t,e,n){return e.circular&&(e.circular[0]||e.circular[1])?r[n]+t:hn(r[n]+t,e.range,e.circular,e.bounce)}))),a=this.am.getDuration(s,r,i);0===a&&(s=an({},o));var h={depaPos:o,destPos:s,duration:a,delta:this.axm.getDelta(o,s),inputEvent:e,input:t,isTrusted:!0};this.em.triggerRelease(h),this.moveDistance=null;var u=this.am.getUserControll(h),c=xn(u.destPos,o),l={input:t,event:e};c||0===u.duration?(!c&&this.em.triggerChange(u.destPos,!1,o,l,!0),this.itm.setInterrupt(!1),this.axm.isOutside()?this.am.restore(l):this.em.triggerFinish(!0)):this.am.animateTo(u.destPos,u.duration,l)}},t}(),Dn=function(){if("undefined"==typeof document)return"";for(var t=(document.head||document.getElementsByTagName("head")[0]).style,e=["transform","webkitTransform","msTransform","mozTransform"],n=0,i=e.length;n<i;n++)if(e[n]in t)return e[n];return""}(),Mn=function(t){function e(e,n,i){void 0===e&&(e={}),void 0===n&&(n={});var r=t.call(this)||this;return r.axis=e,r._inputs=[],r.options=an({easing:function(t){return 1-Math.pow(1-t,3)},interruptable:!0,maximumDuration:1/0,minimumDuration:0,deceleration:6e-4,round:null},n),r.itm=new On(r.options),r.axm=new In(r.axis,r.options),r.em=new Cn(r),r.am=new An(r),r.io=new Sn(r),r.em.setAnimationManager(r.am),i&&r.em.triggerChange(i),r}on(e,t);var n=e.prototype;return n.connect=function(t,e){var n;if(n="string"==typeof t?t.split(" "):t.concat(),~this._inputs.indexOf(e)&&this.disconnect(e),"hammer"in e){var i=this._inputs.filter((function(t){return t.hammer&&t.element===e.element}));i.length&&(e.hammer=i[0].hammer)}return e.mapAxes(n),e.connect(this.io),this._inputs.push(e),this},n.disconnect=function(t){if(t){var e=this._inputs.indexOf(t);e>=0&&(this._inputs[e].disconnect(),this._inputs.splice(e,1))}else this._inputs.forEach((function(t){return t.disconnect()})),this._inputs=[];return this},n.get=function(t){return this.axm.get(t)},n.setTo=function(t,e){return void 0===e&&(e=0),this.am.setTo(t,e),this},n.setBy=function(t,e){return void 0===e&&(e=0),this.am.setBy(t,e),this},n.isBounceArea=function(t){return this.axm.isOutside(t)},n.destroy=function(){this.disconnect(),this.em.destroy()},e.VERSION="2.6.0",e.TRANSFORM=Dn,e.DIRECTION_NONE=Xt,e.DIRECTION_LEFT=Bt,e.DIRECTION_RIGHT=Ht,e.DIRECTION_UP=kt,e.DIRECTION_DOWN=Gt,e.DIRECTION_HORIZONTAL=jt,e.DIRECTION_VERTICAL=zt,e.DIRECTION_ALL=qt,e}(u),Ln="PointerEvent"in sn||"MSPointerEvent"in sn,Nn="ontouchstart"in sn,Vn="_EGJS_AXES_INPUTTYPE_";function Fn(t,e){return e.reduce((function(e,n,i){return t[i]&&(e[t[i]]=n),e}),{})}function Un(t,e){try{return new tn(t,an({},e))}catch(t){return null}}function Wn(t){void 0===t&&(t=[]);var e=!1,n=!1,i=!1;return t.forEach((function(t){switch(t){case"mouse":n=!0;break;case"touch":e=Nn;break;case"pointer":i=Ln}})),i?Ee:e&&n?Ve:e?be:n?Ie:null}function Yn(t,e,n){return n?!!(e===qt||e&t&&n&t):!!(e&t)}var Xn=function(){function t(t,e){if(this.axes=[],this.hammer=null,this.element=null,this.panRecognizer=null,void 0===tn)throw new Error("The Hammerjs must be loaded before eg.Axes.PanInput.\nhttp://hammerjs.github.io/");this.element=dn(t),this.options=an({inputType:["touch","mouse","pointer"],scale:[1,1],thresholdAngle:45,threshold:0,hammerManagerOptions:{cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",userDrag:"none"}}},e),this.onHammerInput=this.onHammerInput.bind(this),this.onPanmove=this.onPanmove.bind(this),this.onPanend=this.onPanend.bind(this)}var e=t.prototype;return e.mapAxes=function(t){var e=!!t[0],n=!!t[1];this._direction=e&&n?qt:e?jt:n?zt:Xt,this.axes=t},e.connect=function(t){var e={direction:this._direction,threshold:this.options.threshold};if(this.hammer)this.removeRecognizer(),this.dettachEvent();else{var n=this.element[Vn];n||(n=String(Math.round(Math.random()*(new Date).getTime())));var i=Wn(this.options.inputType);if(!i)throw new Error("Wrong inputType parameter!");this.hammer=Un(this.element,an({inputClass:i},this.options.hammerManagerOptions)),this.element[Vn]=n}return this.panRecognizer=new Qe(e),this.hammer.add(this.panRecognizer),this.attachEvent(t),this},e.disconnect=function(){return this.removeRecognizer(),this.hammer&&this.dettachEvent(),this._direction=Xt,this},e.destroy=function(){this.disconnect(),this.hammer&&0===this.hammer.recognizers.length&&this.hammer.destroy(),delete this.element[Vn],this.element=null,this.hammer=null},e.enable=function(){return this.hammer&&(this.hammer.get("pan").options.enable=!0),this},e.disable=function(){return this.hammer&&(this.hammer.get("pan").options.enable=!1),this},e.isEnable=function(){return!(!this.hammer||!this.hammer.get("pan").options.enable)},e.removeRecognizer=function(){this.hammer&&this.panRecognizer&&(this.hammer.remove(this.panRecognizer),this.panRecognizer=null)},e.onHammerInput=function(t){this.isEnable()&&(t.isFirst?this.observer.hold(this,t):t.isFinal&&this.onPanend(t))},e.onPanmove=function(t){var e=function(t,e){if(e<0||e>90)return Xt;var n=Math.abs(t);return n>e&&n<180-e?zt:jt}(t.angle,this.options.thresholdAngle),n=this.hammer.session.prevInput;n?(t.offsetX=t.deltaX-n.deltaX,t.offsetY=t.deltaY-n.deltaY):(t.offsetX=0,t.offsetY=0);var i=this.getOffset([t.offsetX,t.offsetY],[Yn(jt,this._direction,e),Yn(zt,this._direction,e)]),r=i.some((function(t){return 0!==t}));r&&(t.srcEvent.preventDefault(),t.srcEvent.stopPropagation()),t.preventSystemEvent=r,r&&this.observer.change(this,t,Fn(this.axes,i))},e.onPanend=function(t){var e,n,i,r,o=this.getOffset([Math.abs(t.velocityX)*(t.deltaX<0?-1:1),Math.abs(t.velocityY)*(t.deltaY<0?-1:1)],[Yn(jt,this._direction),Yn(zt,this._direction)]);e=o,n=this.observer.options.deceleration,i=Math.sqrt(e[0]*e[0]+e[1]*e[1]),r=Math.abs(i/-n),o=[e[0]/2*r,e[1]/2*r],this.observer.release(this,t,Fn(this.axes,o))},e.attachEvent=function(t){this.observer=t,this.hammer.on("hammer.input",this.onHammerInput).on("panstart panmove",this.onPanmove)},e.dettachEvent=function(){this.hammer.off("hammer.input",this.onHammerInput).off("panstart panmove",this.onPanmove),this.observer=null},e.getOffset=function(t,e){var n=[0,0],i=this.options.scale;return e[0]&&(n[0]=t[0]*i[0]),e[1]&&(n[1]=t[1]*i[1]),n},t}(),Bn=function(){function t(t,e){if(this.axes=[],this.hammer=null,this.element=null,this._base=null,this._prev=null,this.pinchRecognizer=null,void 0===tn)throw new Error("The Hammerjs must be loaded before eg.Axes.PinchInput.\nhttp://hammerjs.github.io/");this.element=dn(t),this.options=an({scale:1,threshold:0,inputType:["touch","pointer"],hammerManagerOptions:{cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",userDrag:"none"}}},e),this.onPinchStart=this.onPinchStart.bind(this),this.onPinchMove=this.onPinchMove.bind(this),this.onPinchEnd=this.onPinchEnd.bind(this)}var e=t.prototype;return e.mapAxes=function(t){this.axes=t},e.connect=function(t){var e={threshold:this.options.threshold};if(this.hammer)this.removeRecognizer(),this.dettachEvent();else{var n=this.element[Vn];n||(n=String(Math.round(Math.random()*(new Date).getTime())));var i=Wn(this.options.inputType);if(!i)throw new Error("Wrong inputType parameter!");this.hammer=Un(this.element,an({inputClass:i},this.options.hammerManagerOptions)),this.element[Vn]=n}return this.pinchRecognizer=new Ze(e),this.hammer.add(this.pinchRecognizer),this.attachEvent(t),this},e.disconnect=function(){return this.removeRecognizer(),this.hammer&&(this.hammer.remove(this.pinchRecognizer),this.pinchRecognizer=null,this.dettachEvent()),this},e.destroy=function(){this.disconnect(),this.hammer&&0===this.hammer.recognizers.length&&this.hammer.destroy(),delete this.element[Vn],this.element=null,this.hammer=null},e.removeRecognizer=function(){this.hammer&&this.pinchRecognizer&&(this.hammer.remove(this.pinchRecognizer),this.pinchRecognizer=null)},e.onPinchStart=function(t){this._base=this.observer.get(this)[this.axes[0]];var e=this.getOffset(t.scale);this.observer.hold(this,t),this.observer.change(this,t,Fn(this.axes,[e])),this._prev=t.scale},e.onPinchMove=function(t){var e=this.getOffset(t.scale,this._prev);this.observer.change(this,t,Fn(this.axes,[e])),this._prev=t.scale},e.onPinchEnd=function(t){var e=this.getOffset(t.scale,this._prev);this.observer.change(this,t,Fn(this.axes,[e])),this.observer.release(this,t,Fn(this.axes,[0]),0),this._base=null,this._prev=null},e.getOffset=function(t,e){return void 0===e&&(e=1),this._base*(t-e)*this.options.scale},e.attachEvent=function(t){this.observer=t,this.hammer.on("pinchstart",this.onPinchStart).on("pinchmove",this.onPinchMove).on("pinchend",this.onPinchEnd)},e.dettachEvent=function(){this.hammer.off("pinchstart",this.onPinchStart).off("pinchmove",this.onPinchMove).off("pinchend",this.onPinchEnd),this.observer=null,this._prev=null},e.enable=function(){return this.hammer&&(this.hammer.get("pinch").options.enable=!0),this},e.disable=function(){return this.hammer&&(this.hammer.get("pinch").options.enable=!1),this},e.isEnable=function(){return!(!this.hammer||!this.hammer.get("pinch").options.enable)},t}(),Hn=function(){function t(t,e){this.axes=[],this.element=null,this._isEnabled=!1,this._isHolded=!1,this._timer=null,this.element=dn(t),this.options=an({scale:1,useNormalized:!0},e),this.onWheel=this.onWheel.bind(this)}var e=t.prototype;return e.mapAxes=function(t){this.axes=t},e.connect=function(t){return this.dettachEvent(),this.attachEvent(t),this},e.disconnect=function(){return this.dettachEvent(),this},e.destroy=function(){this.disconnect(),this.element=null},e.onWheel=function(t){var e=this;if(this._isEnabled&&(t.preventDefault(),0!==t.deltaY)){this._isHolded||(this.observer.hold(this,t),this._isHolded=!0);var n=(t.deltaY>0?-1:1)*this.options.scale*(this.options.useNormalized?1:Math.abs(t.deltaY));this.observer.change(this,t,Fn(this.axes,[n])),clearTimeout(this._timer),this._timer=setTimeout((function(){e._isHolded&&(e._isHolded=!1,e.observer.release(e,t,Fn(e.axes,[0])))}),50)}},e.attachEvent=function(t){this.observer=t,this.element.addEventListener("wheel",this.onWheel),this._isEnabled=!0},e.dettachEvent=function(){this.element.removeEventListener("wheel",this.onWheel),this._isEnabled=!1,this.observer=null,this._timer&&(clearTimeout(this._timer),this._timer=null)},e.enable=function(){return this._isEnabled=!0,this},e.disable=function(){return this._isEnabled=!1,this},e.isEnable=function(){return this._isEnabled},t}(),kn=function(){function t(t,e){this.axes=[],this.element=null,this._isEnabled=!1,this._isHolded=!1,this._timer=null,this.element=dn(t),this.options=an({scale:[1,1]},e),this.onKeydown=this.onKeydown.bind(this),this.onKeyup=this.onKeyup.bind(this)}var e=t.prototype;return e.mapAxes=function(t){this.axes=t},e.connect=function(t){return this.dettachEvent(),"0"!==this.element.getAttribute("tabindex")&&this.element.setAttribute("tabindex","0"),this.attachEvent(t),this},e.disconnect=function(){return this.dettachEvent(),this},e.destroy=function(){this.disconnect(),this.element=null},e.onKeydown=function(t){if(this._isEnabled){var e=!0,n=1,i=-1;switch(t.keyCode){case 37:case 65:n=-1;break;case 39:case 68:break;case 40:case 83:n=-1,i=1;break;case 38:case 87:i=1;break;default:e=!1}if((-1===i&&!this.axes[0]||1===i&&!this.axes[1])&&(e=!1),e){var r=-1===i?[+this.options.scale[0]*n,0]:[0,+this.options.scale[1]*n];this._isHolded||(this.observer.hold(this,event),this._isHolded=!0),clearTimeout(this._timer),this.observer.change(this,event,Fn(this.axes,r))}}},e.onKeyup=function(t){var e=this;this._isHolded&&(clearTimeout(this._timer),this._timer=setTimeout((function(){e.observer.release(e,t,Fn(e.axes,[0,0])),e._isHolded=!1}),80))},e.attachEvent=function(t){this.observer=t,this.element.addEventListener("keydown",this.onKeydown,!1),this.element.addEventListener("keypress",this.onKeydown,!1),this.element.addEventListener("keyup",this.onKeyup,!1),this._isEnabled=!0},e.dettachEvent=function(){this.element.removeEventListener("keydown",this.onKeydown,!1),this.element.removeEventListener("keypress",this.onKeydown,!1),this.element.removeEventListener("keyup",this.onKeyup,!1),this._isEnabled=!1,this.observer=null},e.enable=function(){return this._isEnabled=!0,this},e.disable=function(){return this._isEnabled=!1,this},e.isEnable=function(){return this._isEnabled},t}();function Gn(t){return 180*t/Math.PI}var jn={isPowerOfTwo:function(t){return t&&0==(t&t-1)}};jn.extractPitchFromQuat=function(t){var e=function(t){var e=w(0,0,1);return O(e,e,t),e}(t);return-1*Math.atan2(e[1],Math.sqrt(Math.pow(e[0],2)+Math.pow(e[2],2)))},jn.hypot=Math.hypot||function(t,e){return Math.sqrt(t*t+e*e)};var zn={PITCH_DELTA:1,YAW_DELTA_BY_ROLL:2,YAW_DELTA_BY_YAW:3};function qn(t,e){var n=t[0]*e[1]-e[0]*t[1];return-Math.atan2(n,function(t,e){return t[0]*e[0]+t[1]*e[1]}(t,e))}zn[zn.PITCH_DELTA]={targetAxis:[0,1,0],meshPoint:[0,0,1]},zn[zn.YAW_DELTA_BY_ROLL]={targetAxis:[0,1,0],meshPoint:[1,0,0]},zn[zn.YAW_DELTA_BY_YAW]={targetAxis:[1,0,0],meshPoint:[0,0,1]},jn.yawOffsetBetween=function(t,e){var n=K(t[0],t[2]),i=K(e[0],e[2]);return Z(n,n),Z(i,i),-qn(n,i)},jn.toDegree=Gn,jn.getRotationDelta=function(t,e,n){var i=w(zn[n].targetAxis[0],zn[n].targetAxis[1],zn[n].targetAxis[2]),r=zn[n].meshPoint,o=k(t),s=k(e);z(o,o),z(s,s);var a=w(0,0,1),h=w(0,0,1);O(a,a,o),O(h,h,s),O(i,i,s);var u,c=P(i,A(x(),a,h))>0?1:-1,l=w(r[0],r[1],r[2]);u=n!==zn.YAW_DELTA_BY_YAW?w(0,c,0):w(c,0,0),O(l,l,s),O(u,u,s);var f=l,d=u,p=x();A(p,f,d),b(p,p);var v=p[0],g=p[1],m=p[2];O(h=w(r[0],r[1],r[2]),h,s),O(a=w(r[0],r[1],r[2]),a,o);var _=Math.abs(a[0]*v+a[1]*g+a[2]*m),y=x();R(y,a,function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}(x(),p,_));var E=(y[0]*h[0]+y[1]*h[1]+y[2]*h[2])/(T(y)*T(h));E>1&&(E=1);var C=Math.acos(E),I=A(x(),h,y);return _=v*I[0]+g*I[1]+m*I[2],Gn(C*(n!==zn.YAW_DELTA_BY_YAW?_>0?1:-1:_<0?1:-1)*c)},jn.angleBetweenVec2=qn;var Kn=function(t){function e(e,n,i){var r;return(r=t.call(this,e,n)||this)._useRotation=!1,r._deviceSensor=i,r.setUseRotation(!(!n||!n.useRotation)),r._userDirection=Mn.DIRECTION_ALL,r}r(e,t);var n=e.prototype;return n.setUseRotation=function(t){this._useRotation=t},n.connect=function(e){this._userDirection=this._direction,this._useRotation&&this._direction&Mn.DIRECTION_ALL&&(this._direction=Mn.DIRECTION_HORIZONTAL),t.prototype.connect.call(this,e)},n.getOffset=function(e,n){if(!1===this._useRotation)return t.prototype.getOffset.call(this,e,n);var i=t.prototype.getOffset.call(this,e,[!0,!0]),r=[0,0],o=this._deviceSensor.getDeviceHorizontalRight(),s=K(o[0],o[1]),a=K(1,0),h=jn.angleBetweenVec2(s,a),u=Math.cos(h),c=Math.sin(h);return r[0]=i[0]*u-i[1]*c,r[1]=i[1]*u+i[0]*c,this._userDirection&Mn.DIRECTION_HORIZONTAL?this._userDirection&Mn.DIRECTION_VERTICAL||(r[1]=0):r[0]=0,r},n.destroy=function(){t.prototype.destroy.call(this)},e}(Xn);const Qn=Symbol("__sensor__"),Zn=Qn;function Jn(t,e){for(const n in e)Object.defineProperty(t,n,{configurable:!0,value:e[n]})}const $n=(t,...e)=>(class extends t{constructor(...t){super(t);const e=document.createDocumentFragment();this.addEventListener=(t,...n)=>e.addEventListener(t,...n),this.removeEventListener=(...t)=>e.removeEventListener(...t),this.dispatchEvent=t=>{Jn(t,{currentTarget:this}),t.target||Jn(t,{target:this});const n=`on${t.type}`;"function"==typeof this[n]&&this[n](t);const i=e.dispatchEvent(t);return i&&this.parentNode&&this.parentNode.dispatchEvent(t),Jn(t,{currentTarget:null,target:null}),i}}});class ti extends($n(Object)){}function ei(t,e,n){const i=t[e];for(const e in n)i[e]=n[e],Object.defineProperty(t,e,{get:()=>i[e]})}class ni extends Event{constructor(t,e){if(super(t,e),!(e&&e.error instanceof DOMException))throw TypeError("Failed to construct 'SensorErrorEvent':2nd argument much contain 'error' property");Object.defineProperty(this,"error",{configurable:!1,writable:!1,value:e.error})}}function ii(t,e){Object.defineProperty(t,`on${e}`,{enumerable:!0,configurable:!1,writable:!0,value:null})}const ri={IDLE:1,ACTIVATING:2,ACTIVE:3};class oi extends ti{constructor(t){if(super(),this[Zn]=new WeakMap,ii(this,"reading"),ii(this,"activate"),ii(this,"error"),ei(this,Zn,{activated:!1,hasReading:!1,timestamp:null}),this[Zn].state=ri.IDLE,this[Zn].notifyError=(t,e)=>{let n=new ni("error",{error:new DOMException(t,e)});this.dispatchEvent(n),this.stop()},this[Zn].notifyActivatedState=()=>{let t=new Event("activate");this[Zn].activated=!0,this.dispatchEvent(t),this[Zn].state=ri.ACTIVE},this[Zn].activateCallback=()=>{},this[Zn].deactivateCallback=()=>{},this[Zn].frequency=null,window&&window.parent!=window.top)throw new DOMException("Only instantiable in a top-level browsing context","SecurityError");t&&"number"==typeof t.frequency&&t.frequency>60&&(this.frequency=t.frequency)}start(){this[Zn].state!==ri.ACTIVATING&&this[Zn].state!==ri.ACTIVE&&(this[Zn].state=ri.ACTIVATING,this[Zn].activateCallback())}stop(){this[Zn].state!==ri.IDLE&&(this[Zn].activated=!1,this[Zn].hasReading=!1,this[Zn].timestamp=null,this[Zn].deactivateCallback(),this[Zn].state=ri.IDLE)}}const si=Qn;let ai;screen.orientation?ai=screen.orientation:screen.msOrientation?ai=screen.msOrientation:(ai={},Object.defineProperty(ai,"angle",{get:()=>window.orientation||0}));const hi=(t,...e)=>(class extends t{constructor(...t){super(t);for(const t of e)if(`on${t}`in window){this[si].eventName=t;break}this[si].activateCallback=()=>{window.addEventListener(this[si].eventName,this[si].handleEvent,{capture:!0})},this[si].deactivateCallback=()=>{window.removeEventListener(this[si].eventName,this[si].handleEvent,{capture:!0})}}});function ui(t,e,n){const i=Math.PI/180,r=(e||0)*i,o=(n||0)*i,s=(t||0)*i,a=Math.cos(.5*s),h=Math.sin(.5*s),u=Math.cos(.5*o),c=Math.sin(.5*o),l=Math.cos(.5*r),f=Math.sin(.5*r);return[f*u*a-l*c*h,l*c*a+f*u*h,l*u*h+f*c*a,l*u*a-f*c*h]}function ci(t,e){return(t instanceof Float32Array||t instanceof Float64Array)&&t.length>=16&&(t[0]=1-2*(e[1]**2+e[2]**2),t[1]=2*(e[0]*e[1]-e[2]*e[3]),t[2]=2*(e[0]*e[2]+e[1]*e[3]),t[3]=0,t[4]=2*(e[0]*e[1]+e[2]*e[3]),t[5]=1-2*(e[0]**2+e[2]**2),t[6]=2*(e[1]*e[2]-e[0]*e[3]),t[7]=0,t[8]=2*(e[0]*e[2]-e[1]*e[3]),t[9]=2*(e[1]*e[2]+e[0]*e[3]),t[10]=1-2*(e[0]**2+e[1]**2),t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1),t}function li(t){return t?function(t,e,n){const i=Math.sin(n/2),r=Math.cos(n/2);return function(t){const e=Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2);return 0===e?[0,0,0,1]:t.map(t=>t/e)}(function(t,e){return[t[0]*e[3]+t[3]*e[0]+t[1]*e[2]-t[2]*e[1],t[1]*e[3]+t[3]*e[1]+t[2]*e[0]-t[0]*e[2],t[2]*e[3]+t[3]*e[2]+t[0]*e[1]-t[1]*e[0],t[3]*e[3]-t[0]*e[0]-t[1]*e[1]-t[2]*e[2]]}(t,[e[0]*i,e[1]*i,e[2]*i,r]))}(t,[0,0,1],-ai.angle*Math.PI/180):null}const fi=window.RelativeOrientationSensor||class extends(hi(oi,"deviceorientation")){constructor(t={}){switch(super(t),t.coordinateSystem||"world"){case"screen":Object.defineProperty(this,"quaternion",{get:()=>li(this[si].quaternion)});break;case"world":default:Object.defineProperty(this,"quaternion",{get:()=>this[si].quaternion})}this[si].handleEvent=t=>{t.absolute||null===t.alpha?this[si].notifyError("Could not connect to a sensor","NotReadableError"):(this[si].activated||this[si].notifyActivatedState(),this[si].timestamp=performance.now(),this[si].quaternion=ui(t.alpha,t.beta,t.gamma),this[si].hasReading=!0,this.dispatchEvent(new Event("reading")))},this[si].deactivateCallback=()=>{this[si].quaternion=null}}populateMatrix(t){ci(t,this.quaternion)}};window.AbsoluteOrientationSensor||hi(oi,"deviceorientationabsolute","deviceorientation"),window.Gyroscope||hi(oi,"devicemotion"),window.Accelerometer||hi(oi,"devicemotion"),window.LinearAccelerationSensor||hi(oi,"devicemotion"),window.GravitySensor||hi(oi,"devicemotion");function di(t,e){return jn.getRotationDelta(t,e,zn.PITCH_DELTA)}var pi=/Chrome\/([0-9]+)\.(?:[0-9]*)\.([0-9]*)\.([0-9]*)/i.exec(rt);pi&&(parseInt(pi[1],10),pi[2],pi[3]);/Android/i.test(rt);var vi=6,gi=[.2,.2],mi={NONE:"none",YAWPITCH:"yawPitch",VR:"VR"},_i="undefined"==typeof Promise?a.Promise:Promise,yi=w(1,0,0),Ei=w(0,1,0),xi=L(M(),yi,-Math.PI/2),Ti=function(){return function(t){function e(e){var n;return(n=t.call(this)||this)._onFirstRead=function(){var t=n._sensor,e=n._getOrientation(),i=w(0,0,-1),r=O(x(),i,e),o=jn.yawOffsetBetween(r,i);if(0!==o){var s=L(M(),Ei,-o);j(xi,s,xi),n._calibrated=!0,t.removeEventListener("reading",n._onFirstRead),t.addEventListener("reading",n._onSensorRead)}},n._onSensorRead=function(){if(n._observer&&n._gyroMode===mi.YAWPITCH){var t=n.getYawPitchDelta();n._observer.change(o(n),{},{yaw:t.yaw,pitch:t.pitch})}n.trigger("change",{isTrusted:!0})},n._enabled=!1,n._calibrated=!1,n._sensor=new fi({frequency:60,coordinateSystem:"screen",referenceFrame:"screen"}),n._prevQuaternion=null,n._gyroMode=e,n._observer=null,n.axes=null,n}r(e,t);var n=e.prototype;return n.mapAxes=function(t){this.axes=t},n.connect=function(t){return this._observer?this:(this._observer=t,this)},n.disconnect=function(){return this._observer?(this._observer=null,this):this},n.setGyroMode=function(t){this._gyroMode=t},n.enable=function(){var t=this;return this._enabled?_i.resolve("Sensor already enabled"):navigator&&navigator.permissions?_i.all([navigator.permissions.query({name:"accelerometer"}),navigator.permissions.query({name:"gyroscope"})]).then((function(e){e.every((function(t){return"granted"===t.state}))&&t._startSensor()})).catch((function(){t._startSensor()})):(this._startSensor(),_i.resolve())},n.disable=function(){this._enabled&&(this._prevQuaternion=null,this._sensor.removeEventListener("read",this._onSensorRead),this._sensor.stop())},n.isEnabled=function(){return this._enabled},n.getYawPitchDelta=function(){var t=this._prevQuaternion,e=this._getOrientation();if(!t)return this._prevQuaternion=e,{yaw:0,pitch:0};var n,i,r,o={yaw:(n=t,i=e,r=jn.getRotationDelta(n,i,zn.YAW_DELTA_BY_YAW),jn.getRotationDelta(n,i,zn.YAW_DELTA_BY_ROLL)*Math.sin(jn.extractPitchFromQuat(i))+r),pitch:di(t,e)};return G(t,e),o},n.getCombinedQuaternion=function(t){var e=this._getOrientation();this._prevQuaternion||(this._prevQuaternion=G(M(),e));var n=L(M(),Ei,d(t)),i=N(M(),n,e);return F(i,i),G(this._prevQuaternion,e),i},n.getDeviceHorizontalRight=function(t){var e=t||this._getOrientation(),n=F(M(),e),i=w(0,0,-1),r=O(x(),i,e),o=A(x(),r,Ei),s=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}(x(),r,o),a=x();return O(a,s,n),S(a,a,i),a[2]=0,b(a,a),a},n.destroy=function(){this.disable()},n._getOrientation=function(){return this._sensor.quaternion?N(M(),xi,this._sensor.quaternion):M()},n._startSensor=function(){var t=this._sensor;t.start(),this._calibrated?t.addEventListener("reading",this._onSensorRead):t.addEventListener("reading",this._onFirstRead),this._enabled=!0},e}(u)}(),wi="3.3.0-snapshot",Ri="undefined"==typeof Promise?a.Promise:Promise,bi=[-180,180],Pi=[-90,90],Ai=[-180,180],Ci=function(){var t=function(t){function e(e){var n;n=t.call(this)||this;var r=i({element:null,yaw:0,pitch:0,fov:65,showPolePoint:!1,useZoom:!0,useKeyboard:!0,gyroMode:mi.YAWPITCH,touchDirection:vi,yawRange:bi,pitchRange:Pi,fovRange:[30,110],aspectRatio:1},e);return n._element=r.element,n._initialFov=r.fov,n._enabled=!1,n._isAnimating=!1,n._deviceSensor=(new Ti).on("change",(function(t){n._triggerChange(t)})),n._initAxes(r),n.option(r),n}r(e,t);var n=e.prototype;return n._initAxes=function(t){var n=this,i=this._updateYawRange(t.yawRange,t.fov,t.aspectRatio),r=this._updatePitchRange(t.pitchRange,t.fov,t.showPolePoint),o=t.gyroMode===mi.VR;this.axesPanInput=new Kn(this._element,{useRotation:o},this._deviceSensor),this.axesWheelInput=new Hn(this._element,{scale:-4}),this.axesPinchInput=ot?new Bn(this._element,{scale:-1}):null,this.axesMoveKeyInput=new kn(this._element,{scale:[-6,6]}),this.axes=new Mn({yaw:{range:i,circular:e.isCircular(i),bounce:[0,0]},pitch:{range:r,circular:e.isCircular(r),bounce:[0,0]},fov:{range:t.fovRange,circular:[!1,!1],bounce:[0,0]}},{deceleration:.0014,maximumDuration:1e3},{yaw:t.yaw,pitch:t.pitch,fov:t.fov}).on({hold:function(t){n.axes.options.maximumDuration=1e3,n.trigger("hold",{isTrusted:t.isTrusted})},change:function(t){0!==t.delta.fov&&(n._updateControlScale(t),n.updatePanScale()),n._triggerChange(t)},release:function(t){n._triggerChange(t)},animationStart:function(t){},animationEnd:function(t){n.trigger("animationEnd",{isTrusted:t.isTrusted})}})},n.updatePanScale=function(t){void 0===t&&(t={});var e=this.axes.get().fov,n=t.height||parseInt(it(this._element).height,10),i=gi[0]*e/this._initialFov*320/n;return this.axesPanInput.options.scale=[i,i],this.axes.options.deceleration=.0014*e/110,this},n.option=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=e.length;if(0===r)return this._getOptions();if(1===r&&"string"==typeof e[0])return this._getOptions(e[0]);var o=i({},this.options),s={},a=[];return 1===r?(a=Object.keys(e[0]),s=i({},e[0])):r>=2&&(a.push(e[0]),s[e[0]]=e[1]),this._setOptions(this._getValidatedOptions(s)),this._applyOptions(a,o),this},n._getValidatedOptions=function(t){return t.yawRange&&(t.yawRange=this._getValidYawRange(t.yawRange,t.fov,t.aspectRatio)),t.pitchRange&&(t.pitchRange=this._getValidPitchRange(t.pitchRange,t.fov)),t},n._getOptions=function(t){var e;return"string"==typeof t?e=this.options[t]:0===arguments.length&&(e=this.options),e},n._setOptions=function(t){for(var e in t)this.options[e]=t[e]},n._applyOptions=function(t,e){var n=this.options,i=this.axes,r=n.gyroMode===mi.VR,o=n.gyroMode===mi.YAWPITCH,s=r?2&n.touchDirection:n.touchDirection;if(t.some((function(t){return"showPolePoint"===t||"fov"===t||"aspectRatio"===t||"yawRange"===t||"pitchRange"===t}))&&(t.indexOf("fov")>=0&&(i.setTo({fov:n.fov}),this.updatePanScale()),this._updateControlScale()),t.some((function(t){return"fovRange"===t}))){var a=n.fovRange,h=i.get().fov,u=i.get().fov;Q(i.axis.fov.range,a),u<a[0]?u=a[0]:h>a[1]&&(u=a[1]),h!==u&&(i.setTo({fov:u},0),this._updateControlScale(),this.updatePanScale())}(t.some((function(t){return"gyroMode"===t}))&&st&&(r||o?(i.connect(["yaw","pitch"],this._deviceSensor),this._deviceSensor.enable().catch((function(){}))):(i.disconnect(this._deviceSensor),this._deviceSensor.disable()),this._deviceSensor.setGyroMode(n.gyroMode),r&&this.axesPanInput.setUseRotation(r)),t.some((function(t){return"useKeyboard"===t})))&&(n.useKeyboard?i.connect(["yaw","pitch"],this.axesMoveKeyInput):i.disconnect(this.axesMoveKeyInput));if(t.some((function(t){return"useZoom"===t}))){var c=n.useZoom;i.disconnect(this.axesWheelInput),c&&i.connect(["fov"],this.axesWheelInput)}this._togglePinchInputByOption(n.touchDirection,n.useZoom),t.some((function(t){return"touchDirection"===t}))&&this._enabled&&this._enableTouch(s)},n._togglePinchInputByOption=function(t,e){this.axesPinchInput&&(this.axes.disconnect(this.axesPinchInput),e&&t===vi&&-1===this.axes._inputs.indexOf(this.axesPinchInput)&&this.axes.connect(["fov"],this.axesPinchInput))},n._enableTouch=function(t){this.axesPanInput&&this.axes.disconnect(this.axesPanInput);var e=2&t?"yaw":null,n=4&t?"pitch":null;this.axes.connect([e,n],this.axesPanInput)},n._getValidYawRange=function(t,n,i){var r=e.adjustAspectRatio(i||this.options.aspectRatio||1),o=(n||this.axes.get().fov)*r;return t[1]-t[0]>=o?t:this.options.yawRange||bi},n._getValidPitchRange=function(t,e){var n=e||this.axes.get().fov;return t[1]-t[0]>=n?t:this.options.pitchRange||Pi},e.isCircular=function(t){return t[1]-t[0]<360?[!1,!1]:[!0,!0]},n._updateControlScale=function(t){var n=this.options,i=this.axes.get().fov,r=this._updatePitchRange(n.pitchRange,i,n.showPolePoint),o=this._updateYawRange(n.yawRange,i,n.aspectRatio),s=this.axes.get(),a=s.yaw,h=s.pitch;return Q(this.axes.axis.yaw.range,o),Q(this.axes.axis.pitch.range,r),this.axes.axis.yaw.circular=e.isCircular(o),this.axes.axis.pitch.circular=e.isCircular(r),a<o[0]?a=o[0]:a>o[1]&&(a=o[1]),h<r[0]?h=r[0]:h>r[1]&&(h=r[1]),t&&t.set({yaw:a,pitch:h}),this.axes.setTo({yaw:a,pitch:h},0),this},n._updatePitchRange=function(t,e,n){if(this.options.gyroMode===mi.VR)return Ai;var i=t[1]-t[0],r=e/2;return n&&!(i<180)?t.concat():[t[0]+r,t[1]-r]},n._updateYawRange=function(t,e,n){if(this.options.gyroMode===mi.VR)return bi;if(t[1]-t[0]>=360)return t.concat();var i=jn.toDegree(Math.atan2(n,1/Math.tan(d(e/2))));return[t[0]+i,t[1]-i]},n._triggerChange=function(t){var e=this.axes.get(),n=this.options,i={targetElement:n.element,isTrusted:t.isTrusted};i.yaw=e.yaw,i.pitch=e.pitch,i.fov=e.fov,n.gyroMode===mi.VR&&(i.quaternion=this._deviceSensor.getCombinedQuaternion(e.yaw)),this.trigger("change",i)},e.adjustAspectRatio=function(t){for(var n=[.52,.54,.563,.57,.584,.59,.609,.67,.702,.72,.76,.78,.82,.92,.97,1,1.07,1.14,1.19,1.25,1.32,1.38,1.4,1.43,1.53,1.62,1.76,1.77,1.86,1.96,2.26,2.3,2.6,3,5,6],i=[.51,.54,.606,.56,.628,.63,.647,.71,.736,.757,.78,.77,.8,.89,.975,1,1.07,1.1,1.15,1.18,1.22,1.27,1.3,1.33,1.39,1.45,1.54,1.55,1.58,1.62,1.72,1.82,1.92,2,2.24,2.3],r=-1,o=0;o<n.length-1;o++)if(n[o]<=t&&n[o+1]>=t){r=o;break}if(-1===r)return n[0]>t?i[0]:i[i[0].length-1];var s=n[r],a=n[r+1],h=i[r],u=i[r+1];return e.lerp(h,u,(t-s)/(a-s))},e.lerp=function(t,e,n){return t+n*(e-t)},n.enable=function(){return this._enabled?this:(this._enabled=!0,this._applyOptions(Object.keys(this.options),this.options),this.updatePanScale(),this.enableSensor().catch((function(){})),this)},n.disable=function(t){return this._enabled?(t||this._resetOrientation(),this.axes.disconnect(),this.disableSensor(),this._enabled=!1,this):this},n._resetOrientation=function(){var t=this.options;return this.axes.setTo({yaw:t.yaw,pitch:t.pitch,fov:t.fov},0),this},n.lookAt=function(t,e){var n=t.yaw,i=t.pitch,r=t.fov,o=this.axes.get(),s=void 0===n?0:n-o.yaw,a=void 0===i?0:i-o.pitch,h=void 0===r?0:r-o.fov;this.axes.options.maximumDuration=1/0,this.axes.setBy({yaw:s,pitch:a,fov:h},e)},n.enableSensor=function(){var t=this;return new Ri((function(e,n){var i=function(){t.options.gyroMode!==mi.NONE?(t._deviceSensor.enable(),e()):n(new Error("gyroMode not set"))};DeviceMotionEvent&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceMotionEvent.requestPermission().then((function(t){"granted"===t?i():n(new Error("denied"))})).catch((function(t){n(t)})):i()}))},n.disableSensor=function(){this._deviceSensor.disable()},n.getYawPitch=function(){var t=this.axes.get();return{yaw:t.yaw,pitch:t.pitch}},n.getFov=function(){return this.axes.get().fov},n.getQuaternion=function(){var t=this.axes.get();return this._deviceSensor.getCombinedQuaternion(t.yaw)},n.shouldRenderWithQuaternion=function(){return this.options.gyroMode===mi.VR},n.destroy=function(){this.axes&&this.axes.destroy(),this.axisPanInput&&this.axisPanInput.destroy(),this.axesWheelInput&&this.axesWheelInput.destroy(),this.axesDeviceOrientationInput&&this.axesDeviceOrientationInput.destroy(),this.axesPinchInput&&this.axesPinchInput.destroy(),this.axesMoveKeyInput&&this.axesMoveKeyInput.destroy(),this._deviceSensor&&this._deviceSensor.destroy()},e}(u);return t.VERSION=wi,t.CONTROL_MODE_VR=1,t.CONTROL_MODE_YAWPITCH=2,t.TOUCH_DIRECTION_ALL=vi,t.TOUCH_DIRECTION_YAW=2,t.TOUCH_DIRECTION_PITCH=4,t.TOUCH_DIRECTION_NONE=1,t}(),Oi="undefined"==typeof Promise?a.Promise:Promise,Ii={NONE:0,LOADING:1,LOADED:2,ERROR:3},Si="readystatechange",Di=function(){var t=function(t){function e(e){var n;return(n=t.call(this)||this)._image=null,n._onceHandlers=[],n._loadStatus=Ii.NONE,e&&n.set(e),n}r(e,t);var n=e.prototype;return n.get=function(){var t=this;return new Oi((function(n,i){t._image?t._loadStatus===Ii.LOADED?n(t.getElement()):t._loadStatus===Ii.LOADING?e.isMaybeLoaded(t._image)?(t._loadStatus=Ii.LOADED,n(t.getElement())):t.on(Si,(function(e){e.type===Ii.LOADED?n(t.getElement()):i("ImageLoader: failed to load images.")})):i("ImageLoader: failed to load images"):i("ImageLoader: image is not defiend")}))},n.set=function(t){var n=this;this._loadStatus=Ii.LOADING,this._image=e.createElement(t),e.isMaybeLoaded(this._image)?this._loadStatus=Ii.LOADED:this.onceLoaded(this._image,(function(){n._loadStatus=Ii.LOADED,n.trigger(Si,{type:Ii.LOADED})}),(function(){n._loadStatus=Ii.ERROR,n.trigger(Si,{type:Ii.ERROR})}))},e.createElement=function(t){return(t instanceof Array?t:[t]).map((function(t){var e=t;return"string"==typeof t&&((e=new Image).crossOrigin="anonymous",e.src=t),e}))},n.getElement=function(){return 1===this._image.length?this._image[0]:this._image},e.isMaybeLoaded=function(t){var e=!1;return t instanceof Image?e=t.complete&&0!==t.naturalWidth:t instanceof Array&&(e=!t.some((function(t){return!t.complete||0===t.naturalWidth}))),e},n.onceLoaded=function(t,n,i){var r=this,o=t instanceof Array?t:[t],s=o.filter((function(t){return!e.isMaybeLoaded(t)})).map((function(t){return new Oi((function(e,n){r._once(t,"load",(function(){return e(t)})),r._once(t,"error",(function(){return n(t)}))}))}));Oi.all(s).then((function(t){return n(1===o.length?o[0]:o)}),(function(t){return i(t)}))},n._once=function(t,e,n){var i=function i(r){t.removeEventListener(e,i),n(r)};t.addEventListener(e,i),this._onceHandlers.push({target:t,type:e,fn:i})},n.getStatus=function(){return this._loadStatus},n.destroy=function(){this._onceHandlers.forEach((function(t){t.target.removeEventListener(t.type,t.fn)})),this._onceHandlers=[],this._image.src="",this._image=null,this._loadStatus=Ii.NONE},e}(u);return t.STATUS=Ii,t}(),Mi="undefined"==typeof Promise?a.Promise:Promise,Li={HAVE_NOTHING:0,HAVE_METADATA:1,HAVE_CURRENT_DATA:2,HAVE_FUTURE_DATA:3,HAVE_ENOUGH_DATA:4,LOADING_FAILED:-1},Ni={};Ni[Li.HAVE_METADATA]="loadedmetadata",Ni[Li.HAVE_CURRENT_DATA]="loadeddata",Ni[Li.HAVE_FUTURE_DATA]="canplay",Ni[Li.HAVE_ENOUGH_DATA]="canplaythrough";var Vi=function(){function t(t){this._handlers=[],this._sourceCount=0,this._thresholdReadyState=Li.HAVE_METADATA,this._thresholdEventName=Ni[this._thresholdReadyState],this._loadStatus=t&&t.readyState||Li.HAVE_NOTHING,this._onerror=this._onerror.bind(this),t&&this.set(t)}var e=t.prototype;return e._onerror=function(){this._errorCount++,this._errorCount>=this._sourceCount&&(this._loadStatus=Li.LOADING_FAILED,this._detachErrorHandler(this._onerror))},e._appendSourceElement=function(t){var e,n;if("object"==typeof t?(e=t.src,n=t.type):"string"==typeof t&&(e=t),!e)return!1;var i=document.createElement("source");return i.src=e,n&&(i.type=n),this._video.appendChild(i),!0},e.set=function(t){var e=this;this._reset(),t&&(t instanceof HTMLVideoElement?this._video=t:"string"!=typeof t&&"object"!=typeof t||(this._video=document.createElement("video"),this._video.setAttribute("crossorigin","anonymous"),this._video.setAttribute("webkit-playsinline",""),this._video.setAttribute("playsinline",""),t instanceof Array?t.forEach((function(t){return e._appendSourceElement(t)})):this._appendSourceElement(t),this._sourceCount=this._video.querySelectorAll("source").length,this._sourceCount>0?this._video.readyState<this._thresholdReadyState&&(this._video.load(),this._attachErrorHandler(this._onerror)):this._video=null))},e._attachErrorHandler=function(t){this._video.addEventListener("error",t),this._sources=this._video.querySelectorAll("source"),[].forEach.call(this._sources,(function(e){e.addEventListener("error",t)}))},e._detachErrorHandler=function(t){this._video.removeEventListener("error",t),[].forEach.call(this._sources,(function(e){e.removeEventListener("error",t)}))},e.get=function(){var t=this;return new Mi((function(e,n){if(t._video)if(t._loadStatus===Li.LOADING_FAILED)n("VideoLoader: video source is invalid");else if(t._video.readyState>=t._thresholdReadyState)e(t._video);else{t._attachErrorHandler((function e(){t._loadStatus===Li.LOADING_FAILED&&(t._detachErrorHandler(e),n("VideoLoader: video source is invalid"))})),t._once(t._thresholdEventName,(function(){return e(t._video)}))}else n("VideoLoader: video is undefined")}))},e.getElement=function(){return this._video},e.destroy=function(){this._reset()},e._reset=function(){var t=this;this._handlers.forEach((function(e){t._video.removeEventListener(e.type,e.fn)})),this._handlers=[],this._video=null,this._sourceCount=0,this._errorCount=0},e._once=function(t,e){var n=this._video,i=function i(r){n.removeEventListener(t,i),e(r)};n.addEventListener(t,i,!0),this._handlers.push({type:t,fn:i})},t}(),Fi="undefined"!=typeof window&&window||{},Ui=(Fi.RegExp,Fi.navigator),Wi={browser:[{criteria:"PhantomJS",identity:"PhantomJS"},{criteria:/Whale/,identity:"Whale",versionSearch:"Whale"},{criteria:/Edge/,identity:"Edge",versionSearch:"Edge"},{criteria:/MSIE|Trident|Windows Phone/,identity:"IE",versionSearch:"IEMobile|MSIE|rv"},{criteria:/MiuiBrowser/,identity:"MIUI Browser",versionSearch:"MiuiBrowser"},{criteria:/SamsungBrowser/,identity:"Samsung Internet",versionSearch:"SamsungBrowser"},{criteria:/SAMSUNG /,identity:"Samsung Internet",versionSearch:"Version"},{criteria:/Chrome|CriOS/,identity:"Chrome"},{criteria:/Android/,identity:"Android Browser",versionSearch:"Version"},{criteria:/iPhone|iPad/,identity:"Safari",versionSearch:"Version"},{criteria:"Apple",identity:"Safari",versionSearch:"Version"},{criteria:"Firefox",identity:"Firefox"}],os:[{criteria:/Windows Phone/,identity:"Windows Phone",versionSearch:"Windows Phone"},{criteria:"Windows 2000",identity:"Window",versionAlias:"5.0"},{criteria:/Windows NT/,identity:"Window",versionSearch:"Windows NT"},{criteria:/iPhone|iPad/,identity:"iOS",versionSearch:"iPhone OS|CPU OS"},{criteria:"Mac",versionSearch:"OS X",identity:"MAC"},{criteria:/Android/,identity:"Android"},{criteria:/Tizen/,identity:"Tizen"},{criteria:/Web0S/,identity:"WebOS"}],webview:[{criteria:/iPhone|iPad/,browserVersionSearch:"Version",webviewBrowserVersion:/-1/},{criteria:/iPhone|iPad|Android/,webviewToken:/NAVER|DAUM|; wv/}],defaultString:{browser:{version:"-1",name:"unknown"},os:{version:"-1",name:"unknown"}}};function Yi(t,e){for(var n=[],i=0;i<t.length;i++)e(t[i])&&n.push(t[i]);return n}var Xi=void 0;function Bi(t,e){return e&&e.test?!!e.test(t):t.indexOf(e)>-1}function Hi(t,e){var n=Yi(t,(function(t){return Bi(Xi,t.criteria)}))[0];return n&&n.identity||e.name}function ki(t,e){return Yi(t,(function(t){var n=t.criteria,i=new RegExp(t.identity,"i").test(e);return!!(n?i&&Bi(Xi,n):i)}))[0]}function Gi(t,e){var n=Wi.defaultString.browser.version,i=new RegExp("("+t+")","i").exec(e);if(!i)return n;var r=i.index,o=i[0];if(r>-1){var s=r+o.length+1;n=e.substring(s).split(" ")[0].replace(/_/g,".").replace(/;|\)/g,"")}return n}function ji(t){if(t)return Gi(function(t){var e=ki(Wi.browser,t);return e||(e={criteria:t,versionSearch:t,identity:t}),e}(t).versionSearch||t,Xi)}function zi(t){var e=function(t){return ki(Wi.os,t)}(t)||{},n=Wi.defaultString.os.version,i=void 0;if(t){if(e.versionAlias)return e.versionAlias;var r=e.versionSearch||t,o=new RegExp("("+r+")\\s([\\d_\\.]+|\\d_0)","i");return o.exec(Xi)&&(i=o.exec(Xi)[2].replace(/_/g,".").replace(/;|\)/g,"")),i||n}}function qi(){var t=Hi(Wi.os,Wi.defaultString.os);return{name:t,version:zi(t)}}function Ki(){var t,e,n=Hi(Wi.browser,Wi.defaultString.browser);return{name:n,version:ji(n),webview:(t=Wi.webview,e=void 0,function(t,e){for(var n=0;n<t.length;n++)if(e(t[n]))return!0;return!1}(Yi(t,(function(t){return Bi(Xi,t.criteria)})),(function(t){return e=Gi(t.browserVersionSearch,Xi),!(!Bi(Xi,t.webviewToken)&&!Bi(e,t.webviewBrowserVersion))})))}}function Qi(){!function(t){Xi=t}(arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ui.userAgent);var t={os:qi(),browser:Ki(),isMobile:-1!==Xi.indexOf("Mobi")};return t.browser.name=t.browser.name.toLowerCase(),t.os.name=t.os.name.toLowerCase(),t.os.version=t.os.version.toLowerCase(),"ios"===t.os.name&&t.browser.webview&&(t.browser.version="-1"),t}Qi.VERSION="2.1.5";var Zi,Ji,$i={0:"NO_ERROR",1280:"INVALID_ENUM",1281:"INVALID_VALUE",1282:"INVALID_OPERATION",1285:"OUT_OF_MEMORY",1286:"INVALID_FRAMEBUFFER_OPERATION",37442:"CONTEXT_LOST_WEBGL"},tr=null,er=function(){function t(){}return t.createShader=function(t,e,n){var i=t.createShader(e);return t.shaderSource(i,n),t.compileShader(i),t.getShaderParameter(i,t.COMPILE_STATUS)?i:(console.error(t.getShaderInfoLog(i)),null)},t.createProgram=function(t,e,n){var i=t.createProgram();return t.attachShader(i,e),t.attachShader(i,n),t.linkProgram(i),t.detachShader(i,e),t.detachShader(i,n),t.deleteShader(e),t.deleteShader(n),t.getProgramParameter(i,t.LINK_STATUS)?i:(t.deleteProgram(i),null)},t.initBuffer=function(t,e,n,i,r){var o=t.createBuffer();return t.bindBuffer(e,o),t.bufferData(e,n,t.STATIC_DRAW),o&&(o.itemSize=i,o.numItems=n.length/i),void 0!==r&&(t.enableVertexAttribArray(r),t.vertexAttribPointer(r,o.itemSize,t.FLOAT,!1,0,0)),o},t.getWebglContext=function(t,e){var n=["webgl","experimental-webgl","webkit-3d","moz-webgl"],r=null,o=i({preserveDrawingBuffer:!1,antialias:!1,xrCompatible:!0},e);function s(t){return t.statusMessage}t.addEventListener("webglcontextcreationerror",s);for(var a=0;a<n.length;a++){try{r=t.getContext(n[a],o)}catch(t){}if(r)break}return t.removeEventListener("webglcontextcreationerror",s),r},t.createTexture=function(t,e){var n=t.createTexture();return t.bindTexture(e,n),t.texParameteri(e,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(e,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(e,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(e,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.bindTexture(e,null),n},t.isWebGLAvailable=function(){if(null===tr){var e=document.createElement("canvas"),n=t.getWebglContext(e);if(tr=!!n,n){var i=n.getExtension("WEBGL_lose_context");i&&i.loseContext()}}return tr},t.isStableWebGL=function(){var t=Qi(),e=!0;return"android"===t.os.name&&parseFloat(t.os.version)<=4.3?e=!1:"android"===t.os.name&&4.4===parseFloat(t.os.version)&&"chrome"!==t.browser.name&&(e=!1),e},t.getErrorNameFromWebGLErrorCode=function(t){return t in $i?$i[t]:"UNKNOWN_ERROR"},t.texImage2D=function(t,e,n){try{t.texImage2D(e,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n)}catch(t){console.error("WebGLUtils.texImage2D error:",t)}},t.getMaxTextureSize=function(t){return t.getParameter(t.MAX_TEXTURE_SIZE)},t}(),nr=Qi(),ir="ie"===nr.browser.name&&"11.0"===nr.browser.version,rr={ERROR:"error"},or=function(){var t=function(t){function e(){var e;return(e=t.call(this)||this)._forceDimension=null,e._pixelCanvas=null,e._pixelContext=null,e}r(e,t);var n=e.prototype;return n.render=function(t){var e=t.gl,n=t.shaderProgram,i=t.indexBuffer,r=t.mvMatrix,o=t.pMatrix;e.uniformMatrix4fv(n.pMatrixUniform,!1,o),e.uniformMatrix4fv(n.mvMatrixUniform,!1,r),i&&e.drawElements(e.TRIANGLES,i.numItems,e.UNSIGNED_SHORT,0)},n.getDimension=function(t){return{width:t.naturalWidth||t.videoWidth,height:t.naturalHeight||t.videoHeight}},n.updateShaderData=function(t){},n._initPixelSource=function(t,e){if(ir&&t instanceof HTMLVideoElement||e){var n=e||this.getDimension(t),i=n.width,r=n.height;this._pixelCanvas=document.createElement("canvas"),this._pixelCanvas.width=i,this._pixelCanvas.height=r,this._pixelContext=this._pixelCanvas.getContext("2d")}this._forceDimension=e},n._getPixelSource=function(t){if(!this._pixelCanvas)return t;var e=this.getDimension(t),n=this._forceDimension||e;return this._pixelCanvas.width!==n.width&&(this._pixelCanvas.width=n.width),this._pixelCanvas.height!==n.height&&(this._pixelCanvas.height=n.height),this._forceDimension?this._pixelContext.drawImage(t,0,0,e.width,e.height,0,0,n.width,n.height):this._pixelContext.drawImage(t,0,0),this._pixelCanvas},n._extractTileConfig=function(t){var e=Array.isArray(t.tileConfig)?t.tileConfig:Array.apply(void 0,Array(6)).map((function(){return t.tileConfig}));return e=e.map((function(t){return i({flipHorizontal:!1,rotation:0},t)}))},n._triggerError=function(t){console.error("Renderer Error:",t),this.trigger(rr.ERROR,{message:"string"==typeof t?t:t.message})},e}(u);return t.EVENTS=rr,t}(),sr=function(){var t=function(t){function e(){return t.apply(this,arguments)||this}r(e,t);var n=e.prototype;return n.getVertexPositionData=function(){return e._VERTEX_POSITION_DATA=null!==e._VERTEX_POSITION_DATA?e._VERTEX_POSITION_DATA:[1,-1,1,-1,-1,1,-1,1,1,1,1,1,-1,-1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,1,-1,1,1,-1,1,1,1,-1,1,1,1,-1,-1,-1,-1,-1,-1,-1,1,1,-1,1,1,-1,-1,1,-1,1,1,1,1,1,1,-1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1],e._VERTEX_POSITION_DATA},n.getIndexData=function(){if(e._INDEX_DATA)return e._INDEX_DATA;for(var t=[],n=this.getVertexPositionData(),i=0;i<n.length/3;i+=4)t.push(i,i+2,i+1,i,i+3,i+2);return e._INDEX_DATA=t,t},e.extractOrder=function(t){return t.order||"RLUDBF"},n.getTextureCoordData=function(t){var n=e.extractOrder(t),i=this.getVertexPositionData(),r=this._extractTileConfig(t);return"BFUDRL".split("").map((function(t){return r[n.indexOf(t)]})).map((function(t,e){for(var n=parseInt(t.rotation/90,10),r=t.flipHorizontal?[0,1,2,3]:[1,0,3,2],o=0;o<Math.abs(n);o++)t.flipHorizontal&&n>0||!t.flipHorizontal&&n<0?r.push(r.shift()):r.unshift(r.pop());for(var s=i.slice(12*e,12*e+12),a=[],h=0;h<4;h++)a[r[h]]=s.splice(0,3);return a})).join().split(",").map((function(t){return parseInt(t,10)}))},n.getVertexShaderSource=function(){return"\nattribute vec3 aVertexPosition;\nattribute vec3 aTextureCoord;\nuniform mat4 uMVMatrix;\nuniform mat4 uPMatrix;\nvarying highp vec3 vVertexDirectionVector;\nvoid main(void) {\n\tvVertexDirectionVector = aTextureCoord;\n\tgl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\n}"},n.getFragmentShaderSource=function(){return"\nprecision highp float;\nuniform samplerCube uSampler;\nvarying highp vec3 vVertexDirectionVector;\nvoid main(void) {\n\tgl_FragColor = textureCube(uSampler, vVertexDirectionVector);\n}"},n.updateTexture=function(t,n,i){var r=e.extractOrder(i),o={};r.split("").forEach((function(t,e){o[t]=e}));try{if(n instanceof Array)for(var s=0;s<6;s++){var a=o["RLUDBF"[s]];er.texImage2D(t,t.TEXTURE_CUBE_MAP_POSITIVE_X+s,n[a])}else for(var h=this.getMaxCubeMapTextureSize(t,n),u=0;u<6;u++){var c=o["RLUDBF"[u]],l=this.extractTileFromImage(n,c,h);er.texImage2D(t,t.TEXTURE_CUBE_MAP_POSITIVE_X+u,l)}}catch(t){this._triggerError(t)}},n.bindTexture=function(t,e,n,i){t.bindTexture(t.TEXTURE_CUBE_MAP,e),this.updateTexture(t,n,i)},n.getSourceTileSize=function(t){var e=this.getDimension(t),n=e.width,i=e.height,r=n/i;return r===1/6?n:6===r?i:r===2/3?n/2:n/3},n.extractTileFromImage=function(t,e,n){var i=this.getDimension(t).width,r=this.getSourceTileSize(t),o=document.createElement("canvas");o.width=n,o.height=n;var s=o.getContext("2d"),a=i/r,h=r*e%(r*a),u=parseInt(e/a,10)*r;return s.drawImage(t,h,u,r,r,0,0,n,n),o},n.getMaxCubeMapTextureSize=function(t,e){var n=Qi(),i=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),r=this.getSourceTileSize(e);if("ie"===n.browser.name&&11===parseInt(n.browser.version,10)&&!jn.isPowerOfTwo(r))for(var o=1;o<i;o*=2)if(!(o<r)){r=o;break}return"ios"===n.os.name&&9===parseInt(n.os.version,10)&&(r=1024),"ios"===n.os.name&&8===parseInt(n.os.version,10)&&(r=512),Math.min(i,r)},e}(or);return t._VERTEX_POSITION_DATA=null,t._INDEX_DATA=null,t}(),ar=function(t){function e(){return t.apply(this,arguments)||this}r(e,t);var n=e.prototype;return n.getVertexShaderSource=function(){return"\nattribute vec3 aVertexPosition;\nattribute vec2 aTextureCoord;\nuniform mat4 uMVMatrix;\nuniform mat4 uPMatrix;\nvarying highp vec2 vTextureCoord;\nvoid main(void) {\n\tvTextureCoord = aTextureCoord;\n\tgl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\n}"},n.getFragmentShaderSource=function(){return"\n#define PI 3.14159265359\nprecision highp float;\nvarying highp vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform bool uIsEAC;\nconst vec2 OPERATE_COORDS_RANGE = vec2(-1.0, 1.0);\nconst vec2 TEXTURE_COORDS_RANGE = vec2(0.0, 1.0);\n// vector type is used for initializing values instead of array.\nconst vec4 TEXTURE_DIVISION_X = vec4(0.0, 1.0 / 3.0, 2.0 / 3.0, 1.0);\nconst vec3 TEXTURE_DIVISION_Y = vec3(0.0, 1.0 / 2.0, 1.0);\nconst float EAC_CONST = 2.0 / PI;\nfloat scale(vec2 domainRange, vec2 targetRange, float val) {\n\tfloat unit = 1.0 / (domainRange[1] - domainRange[0]);\n\treturn targetRange[0] + (targetRange[1] - targetRange[0]) * (val - domainRange[0]) * unit;\n}\nvoid main(void) {\n\tfloat transformedCoordX;\n\tfloat transformedCoordY;\n\n\tif (uIsEAC) {\n\t\tvec2 orgTextureRangeX;\n\t\tvec2 orgTextureRangeY;\n\n\t\t// Apply EAC transform\n\t\tif (vTextureCoord.s >= TEXTURE_DIVISION_X[2]) {\n\t\t\torgTextureRangeX = vec2(TEXTURE_DIVISION_X[2], TEXTURE_DIVISION_X[3]);\n\t\t} else if (vTextureCoord.s >= TEXTURE_DIVISION_X[1]) {\n\t\t\torgTextureRangeX = vec2(TEXTURE_DIVISION_X[1], TEXTURE_DIVISION_X[2]);\n\t\t} else {\n\t\t\torgTextureRangeX = vec2(TEXTURE_DIVISION_X[0], TEXTURE_DIVISION_X[1]);\n\t\t}\n\n\t\tif (vTextureCoord.t >= TEXTURE_DIVISION_Y[1]) {\n\t\t\torgTextureRangeY = vec2(TEXTURE_DIVISION_Y[1], TEXTURE_DIVISION_Y[2]);\n\t\t} else {\n\t\t\torgTextureRangeY = vec2(TEXTURE_DIVISION_Y[0], TEXTURE_DIVISION_Y[1]);\n\t\t}\n\n\t\t// scaling coors by the coordinates following the range from -1.0 to 1.0.\n\t\tfloat px = scale(orgTextureRangeX, OPERATE_COORDS_RANGE, vTextureCoord.s);\n\t\tfloat py = scale(orgTextureRangeY, OPERATE_COORDS_RANGE, vTextureCoord.t);\n\n\t\tfloat qu = EAC_CONST * atan(px) + 0.5;\n\t\tfloat qv = EAC_CONST * atan(py) + 0.5;\n\n\t\t// re-scaling coors by original coordinates ranges\n\t\ttransformedCoordX = scale(TEXTURE_COORDS_RANGE, orgTextureRangeX, qu);\n\t\ttransformedCoordY = scale(TEXTURE_COORDS_RANGE, orgTextureRangeY, qv);\n\t} else {\n\t\t// normal cubemap\n\t\ttransformedCoordX = vTextureCoord.s;\n\t\ttransformedCoordY = vTextureCoord.t;\n\t}\n\n\tgl_FragColor = texture2D(uSampler, vec2(transformedCoordX, transformedCoordY));\n}"},n.getVertexPositionData=function(){return this._vertices||(this._vertices=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,-1,-1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,1,-1,1,1,-1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,-1,-1,-1,-1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,-1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1]),this._vertices},n.getIndexData=function(){var t=this;return function(){for(var e=[],n=0;n<t._vertices.length/3;n+=4)e.push(n,n+1,n+2,n,n+2,n+3);return e}()},n.getTextureCoordData=function(t){for(var e=this,n=t.order||"RLUDFB",i=[],r=1;r>=0;r--)for(var o=0;o<3;o++){var s=[o/3,r/2,(o+1)/3,r/2,(o+1)/3,(r+1)/2,o/3,(r+1)/2];i.push(s)}var a=this._extractTileConfig(t);return i=i.map((function(t){return e._shrinkCoord(t)})).map((function(t,n){return e._transformCoord(t,a[n])})),"BFUDRL".split("").map((function(t){return n.indexOf(t)})).map((function(t){return i[t]})).reduce((function(t,e){return t.concat(e)}),[])},n.updateTexture=function(t,e){er.texImage2D(t,t.TEXTURE_2D,this._getPixelSource(e))},n.bindTexture=function(t,e,n){var i=this.getDimension(n),r=i.width,o=i.height,s=Math.max(r,o),a=er.getMaxTextureSize(t);s>a?this._triggerError("Image width("+r+") exceeds device limit("+a+"))"):(this._initPixelSource(n),t.activeTexture(t.TEXTURE0),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.bindTexture(t.TEXTURE_2D,e),this.updateTexture(t,n))},n._transformCoord=function(t,e){var n=t.slice();return e.flipHorizontal&&(n=this._flipHorizontalCoord(n)),e.rotation&&(n=this._rotateCoord(n,e.rotation)),n},n._shrinkCoord=function(t){return[t[0]+0,t[1]+0,t[2]-0,t[3]+0,t[4]-0,t[5]-0,t[6]+0,t[7]-0]},n._rotateCoord=function(t,e){var n,i=parseInt(e/90,10)%4;if(0===i)return t;var r=[];return i>0?(n=t.splice(0,2*i),r=t.concat(n)):r=(n=t.splice(2*(4+i),2*-i)).concat(t),r},n._flipHorizontalCoord=function(t){return[t[2],t[3],t[0],t[1],t[6],t[7],t[4],t[5]]},e}(or),hr={INVALID_DEVICE:10,NO_WEBGL:11,FAIL_IMAGE_LOAD:12,FAIL_BIND_TEXTURE:13,INVALID_RESOURCE:14,RENDERING_CONTEXT_LOST:15},ur={READY:"ready",VIEW_CHANGE:"viewChange",ANIMATION_END:"animationEnd",ERROR:"error"},cr={EQUIRECTANGULAR:"equirectangular",CUBEMAP:"cubemap",CUBESTRIP:"cubestrip",PANORAMA:"panorama",STEREOSCOPIC_EQUI:"stereoequi"},lr={TOP_BOTTOM:"3dv",LEFT_RIGHT:"3dh",NONE:""},fr=-.5*Math.PI,dr=[],pr=[],vr=[];for(Zi=0;Zi<=60;Zi++){var gr=(Zi/60-.5)*Math.PI,mr=Math.sin(gr),_r=Math.cos(gr);for(Ji=0;Ji<=60;Ji++){var yr=2*(Ji/60-.5)*Math.PI+fr,Er=Math.sin(yr),xr=Math.cos(yr)*_r,Tr=mr,wr=Er*_r,Rr=Ji/60,br=Zi/60;if(dr.push(Rr,br),pr.push(2*xr,2*Tr,2*wr),60!==Ji&&60!==Zi){var Pr=61*Zi+Ji,Ar=Pr+60+1;vr.push(Pr,Ar,Pr+1,Ar,Ar+1,Pr+1)}}}var Cr=function(){var t=function(t){function e(e){var n;return(n=t.call(this)||this)._stereoFormat=e,n}r(e,t);var n=e.prototype;return n.render=function(e){var n,i,r=e.gl,o=e.shaderProgram;switch(this._stereoFormat){case lr.TOP_BOTTOM:n=[1,.5,0,0],i=[1,.5,0,.5];break;case lr.LEFT_RIGHT:n=[.5,1,0,0],i=[.5,1,.5,0];break;default:n=[1,1,0,0],i=[1,1,0,0]}var s=r.getUniformLocation(o,"uTexScaleOffset");r.uniform4fv(s,[].concat(n,i)),t.prototype.render.call(this,e)},n.getVertexPositionData=function(){return e._VERTEX_POSITION_DATA},n.getIndexData=function(){return e._INDEX_DATA},n.getTextureCoordData=function(){return e._TEXTURE_COORD_DATA},n.getVertexShaderSource=function(){return"\nattribute vec3 aVertexPosition;\nattribute vec2 aTextureCoord;\nuniform mat4 uMVMatrix;\nuniform mat4 uPMatrix;\nuniform float uEye;\nuniform vec4 uTexScaleOffset[2];\nvarying highp vec2 vTextureCoord;\nvoid main(void) {\n\tvec4 scaleOffset = uTexScaleOffset[int(uEye)];\n\tvTextureCoord = aTextureCoord.xy * scaleOffset.xy + scaleOffset.zw;\n\tgl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\n}"},n.getFragmentShaderSource=function(){return"\nprecision highp float;\nvarying highp vec2 vTextureCoord;\nuniform sampler2D uSampler;\nvoid main(void) {\n\tgl_FragColor = texture2D(uSampler, vTextureCoord.st);\n}"},n.updateTexture=function(t,e){er.texImage2D(t,t.TEXTURE_2D,this._getPixelSource(e))},n.bindTexture=function(t,e,n){var i=this.getDimension(n),r=i.width,o=i.height,s=Math.max(r,o),a=er.getMaxTextureSize(t);s>a?this._triggerError("Image width("+r+") exceeds device limit("+a+"))"):(this._initPixelSource(n),t.activeTexture(t.TEXTURE0),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.bindTexture(t.TEXTURE_2D,e),this.updateTexture(t,n))},e}(or);return t._VERTEX_POSITION_DATA=pr,t._TEXTURE_COORD_DATA=dr,t._INDEX_DATA=vr,t}(),Or=[],Ir=[],Sr=[],Dr=function(){var t=function(t){function e(){return t.apply(this,arguments)||this}r(e,t);var n=e.prototype;return n.getVertexPositionData=function(){return e._VERTEX_POSITION_DATA},n.getIndexData=function(){return e._INDEX_DATA},n.getTextureCoordData=function(){return e._TEXTURE_COORD_DATA},n.getVertexShaderSource=function(){return"\nattribute vec3 aVertexPosition;\nattribute vec2 aTextureCoord;\nuniform mat4 uMVMatrix;\nuniform mat4 uPMatrix;\nvarying highp vec2 vTextureCoord;\nvoid main(void) {\n\tvTextureCoord = aTextureCoord;\n\tgl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\n}"},n.getFragmentShaderSource=function(){return"\nprecision highp float;\nvarying highp vec2 vTextureCoord;\nuniform sampler2D uSampler;\nvoid main(void) {\n\tgl_FragColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));\n}"},n.updateTexture=function(t,e){er.texImage2D(t,t.TEXTURE_2D,this._getPixelSource(e))},n.bindTexture=function(t,e,n){var i,r=this.getDimension(n),o=r.width,s=r.height,a=Math.max(o,s),h=er.getMaxTextureSize(t);a>h&&(this._triggerError("Image width("+o+") exceeds device texture limit("+h+"))"),i=o>s?{width:h,height:h*s/o}:{width:h*o/s,height:h}),this._initPixelSource(n,i),t.activeTexture(t.TEXTURE0),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.bindTexture(t.TEXTURE_2D,e),this.updateTexture(t,n)},n.updateShaderData=function(t){var e,n,i,r,o,s=t.imageAspectRatio,a=void 0===s?6:s;if(a<1?(r=!0,o=1/a):(r=!1,o=a),o>=6){var h=360/o;n=2*Math.PI,i=Math.tan(d(h/2))}else n=o,i=.5;Or.length=0,Ir.length=0,Sr.length=0;for(var u=[-i,i],c=Math.PI/2+(2*Math.PI-n)/2,l=0,f=u.length;l<f;l++)for(e=0;e<=60;e++){var p=c+e/60*n,v=Math.cos(p),g=u[l],m=Math.sin(p),_=void 0,y=void 0;if(r?(_=1-l,y=e/60):(_=e/60,y=l),Or.push(_,y),Ir.push(v,g,m),0===l&&e<60){var E=e,x=E+60+1;Sr.push(E,x,E+1,x,x+1,E+1)}}},e}(or);return t._VERTEX_POSITION_DATA=Ir,t._TEXTURE_COORD_DATA=Or,t._INDEX_DATA=Sr,t}(),Mr="undefined"==typeof Promise?a.Promise:Promise,Lr=[0,0,.5,1],Nr=[.5,0,.5,1],Vr="left",Fr="right",Ur=function(){return function(){function t(){var t=this;this.destroy=function(){var e=t._vrDisplay;t.removeEndCallback(t.destroy),e&&e.isPresenting&&e.exitPresent(),t._clear()},this._frameData=new window.VRFrameData,this._clear()}n(t,[{key:"context",get:function(){return this._vrDisplay}}]);var e=t.prototype;return e.canRender=function(){return Boolean(this._vrDisplay)},e.beforeRender=function(t){t.bindFramebuffer(t.FRAMEBUFFER,null)},e.afterRender=function(){this._vrDisplay.submitFrame()},e.getEyeParams=function(t){var e=this._vrDisplay,n=.5*t.drawingBufferWidth,i=t.drawingBufferHeight,r=this._frameData;e.getFrameData(r);var o=r.leftViewMatrix,s=r.rightViewMatrix;return y(o,o,this._yawOffset),y(s,s,this._yawOffset),[{viewport:[0,0,n,i],mvMatrix:o,pMatrix:r.leftProjectionMatrix},{viewport:[n,0,n,i],mvMatrix:s,pMatrix:r.rightProjectionMatrix}]},e.isPresenting=function(){return Boolean(this._vrDisplay&&this._vrDisplay.isPresenting)},e.addEndCallback=function(t){window.addEventListener("vrdisplaypresentchange",t)},e.removeEndCallback=function(t){window.removeEventListener("vrdisplaypresentchange",t)},e.requestPresent=function(t){var e=this;return new Mr((function(n,i){navigator.getVRDisplays().then((function(r){var o=r.length&&r[0];o?o.capabilities.canPresent?o.requestPresent([{source:t}]).then((function(){var i=o.getEyeParameters(Vr),r=o.getEyeParameters(Fr);t.width=2*Math.max(i.renderWidth,r.renderWidth),t.height=Math.max(i.renderHeight,r.renderHeight),e._setDisplay(o),n()})):i(new Error("Display lacking capability to present.")):i(new Error("No displays available."))}))}))},e.setYawOffset=function(t){this._yawOffset=t},e._setDisplay=function(t){this._vrDisplay=t;var e=t.getLayers();if(e.length){var n=e[0];this._leftBounds=n.leftBounds,this._rightBounds=n.rightBounds}this.addEndCallback(this.destroy)},e._clear=function(){this._vrDisplay=null,this._leftBounds=Lr,this._rightBounds=Nr,this._yawOffset=0},t}()}(),Wr=function(){return function(){function t(){var t=this;this.destroy=function(){var e=t._xrSession;t.removeEndCallback(t.destroy),e&&e.end().then((function(){}),(function(){})),t._clear()},this._clear()}n(t,[{key:"context",get:function(){return this._xrSession}}]);var e=t.prototype;return e.canRender=function(t){var e=t.getViewerPose(this._xrRefSpace);return Boolean(e)},e.beforeRender=function(t,e){var n=e.session.renderState.baseLayer;t.bindFramebuffer(t.FRAMEBUFFER,n.framebuffer)},e.afterRender=function(){},e.getEyeParams=function(t,e){var n=this,i=e.session,r=e.getViewerPose(this._xrRefSpace);if(!r)return null;var o=i.renderState.baseLayer;return r.views.map((function(t){var e=o.getViewport(t),i=t.transform.inverse.matrix;return nt&&_(i,i,d(180)),y(i,i,n._yawOffset),{viewport:[e.x,e.y,e.width,e.height],mvMatrix:i,pMatrix:t.projectionMatrix}}))},e.isPresenting=function(){return this._presenting},e.addEndCallback=function(t){var e=this._xrSession;e&&e.addEventListener("end",t)},e.removeEndCallback=function(t){var e=this._xrSession;e&&e.removeEventListener("end",t)},e.requestPresent=function(t,e){var n=this;return navigator.xr.requestSession("immersive-vr",{requiredFeatures:["local"]}).then((function(t){var i=new window.XRWebGLLayer(t,e);return t.updateRenderState({baseLayer:i}),t.requestReferenceSpace("local").then((function(e){n._setSession(t,i,e)}))}))},e.setYawOffset=function(t){this._yawOffset=t},e._setSession=function(t,e,n){this._xrSession=t,this._xrLayer=e,this._xrRefSpace=n,this._presenting=!0,this.addEndCallback(this.destroy)},e._clear=function(){this._xrSession=null,this._xrLayer=null,this._xrRefSpace=null,this._presenting=!1,this._yawOffset=0},t}()}(),Yr=function(){return function(){function t(){var t=this;this._onLoop=function(){t._callback.apply(t,arguments),t._rafId=t._context.requestAnimationFrame(t._onLoop)},this._onLoopNextTick=function(){var e=performance.now();t._callback.apply(t,arguments);var n=performance.now()-e;t._rafTimer>=0&&(clearTimeout(t._rafTimer),t._rafTimer=-1),n<16?t._rafId=t._context.requestAnimationFrame(t._onLoop):t._rafTimer=setTimeout(t._onLoop,0)},this._callback=null,this._context=window,this._rafId=-1,this._rafTimer=-1}var e=t.prototype;return e.setCallback=function(t){this._callback=t},e.setContext=function(t){this._context=t},e.start=function(){var t=this._context,e=this._callback;t&&e&&(this._rafId>=0||this._rafTimer>=0||(this._rafId=nt?t.requestAnimationFrame(this._onLoopNextTick):t.requestAnimationFrame(this._onLoop)))},e.stop=function(){this._rafId>=0&&this._context.cancelAnimationFrame(this._rafId),this._rafTimer>=0&&clearTimeout(this._rafTimer),this._rafId=-1,this._rafTimer=-1},t}()}(),Xr="undefined"==typeof Promise?a.Promise:Promise,Br=cr,Hr=ht||1;Hr>2&&(Hr=2);var kr={BIND_TEXTURE:"bindTexture",IMAGE_LOADED:"imageLoaded",ERROR:"error",RENDERING_CONTEXT_LOST:"renderingContextLost",RENDERING_CONTEXT_RESTORE:"renderingContextRestore"},Gr={INVALID_DEVICE:10,NO_WEBGL:11,FAIL_IMAGE_LOAD:12,RENDERER_ERROR:13},jr=function(){var t=function(t){function e(e,n,i,r,s,a){var h;return(h=t.call(this)||this)._renderStereo=function(t,e){var n=h._vr,i=h.context,r=i.getUniformLocation(h.shaderProgram,"uEye"),o=n.getEyeParams(i,e);if(o){n.beforeRender(i,e);for(var s=0,a=[0,1];s<a.length;s++){var u=a[s],c=o[u];h.mvMatrix=c.mvMatrix,h.pMatrix=c.pMatrix,i.viewport.apply(i,c.viewport),i.uniform1f(r,u),h._draw()}n.afterRender()}},h.exitVR=function(){var t=h._vr,e=h.context,n=h._animator;t&&(t.removeEndCallback(h.exitVR),t.destroy(),h._vr=null,et&&h._restoreStyle(),h.updateViewportDimensions(h.width,h.height),h._updateViewport(),e.bindFramebuffer(e.FRAMEBUFFER,null),h._shouldForceDraw=!0,n.stop(),n.setContext(window),n.setCallback(h._render.bind(o(h))),n.start())},h._onFirstVRFrame=function(t,e){var n=h._vr,i=h.context,r=h._animator;if(n.canRender(e)){var o=w(0,0,-1),s=n.getEyeParams(i,e)[0],a=v(p(),s.mvMatrix),u=v(p(),s.pMatrix),c=g(p(),a),l=g(p(),u),f=C(x(),o,l);C(f,f,c);var d=jn.yawOffsetBetween(f,w(0,0,1));0!==d&&(n.setYawOffset(d),r.setCallback(h._renderStereo))}},h.sphericalConfig=s,h.fieldOfView=s.fieldOfView,h.width=n,h.height=i,h._lastQuaternion=null,h._lastYaw=null,h._lastPitch=null,h._lastFieldOfView=null,h.pMatrix=m(),h.mvMatrix=m(),E(h.pMatrix,d(h.fieldOfView),n/i,.1,100),h.textureCoordBuffer=null,h.vertexBuffer=null,h.indexBuffer=null,h.canvas=h._initCanvas(n,i),h._setDefaultCanvasStyle(),h._wrapper=null,h._wrapperOrigStyle=null,h._renderingContextAttributes=a,h._image=null,h._imageConfig=null,h._imageIsReady=!1,h._shouldForceDraw=!1,h._keepUpdate=!1,h._onContentLoad=h._onContentLoad.bind(o(h)),h._onContentError=h._onContentError.bind(o(h)),h._animator=new Yr,h._vr=null,e&&h.setImage({image:e,imageType:s.imageType,isVideo:r,cubemapConfig:s.cubemapConfig}),h}r(e,t);var n=e.prototype;return n.setYawPitchControl=function(t){this._yawPitchControl=t},n.getContent=function(){return this._image},n.setImage=function(t){var e=t.image,n=t.imageType,r=t.isVideo,o=void 0!==r&&r,s=t.cubemapConfig;return this._imageIsReady=!1,this._isVideo=o,this._imageConfig=i({order:n===Br.CUBEMAP?"RLUDBF":"RLUDFB",tileConfig:{flipHorizontal:!1,rotation:0}},s),this._setImageType(n),this._contentLoader&&this._contentLoader.destroy(),o?(this._contentLoader=new Vi,this._keepUpdate=!0):(this._contentLoader=new Di,this._keepUpdate=!1),this._contentLoader.set(e),this._image=this._contentLoader.getElement(),this._contentLoader.get().then(this._onContentLoad,this._onContentError).catch((function(t){return setTimeout((function(){throw t}))}))},n._setImageType=function(t){var e=this;if(t&&this._imageType!==t){switch(this._imageType=t,this._isCubeMap=t===Br.CUBEMAP,this._renderer&&this._renderer.off(),t){case Br.CUBEMAP:this._renderer=new sr;break;case Br.CUBESTRIP:this._renderer=new ar;break;case Br.PANORAMA:this._renderer=new Dr;break;case Br.STEREOSCOPIC_EQUI:this._renderer=new Cr(this.sphericalConfig.stereoFormat);break;default:this._renderer=new Cr(lr.NONE)}this._renderer.on(or.EVENTS.ERROR,(function(t){e.trigger(kr.ERROR,{type:Gr.RENDERER_ERROR,message:t.message})})),this._initWebGL()}},n._initCanvas=function(t,e){var n=document.createElement("canvas");return n.width=t,n.height=e,this._onWebglcontextlost=this._onWebglcontextlost.bind(this),this._onWebglcontextrestored=this._onWebglcontextrestored.bind(this),n.addEventListener("webglcontextlost",this._onWebglcontextlost),n.addEventListener("webglcontextrestored",this._onWebglcontextrestored),n},n._setDefaultCanvasStyle=function(){var t=this.canvas;t.style.bottom=0,t.style.left=0,t.style.right=0,t.style.top=0,t.style.margin="auto",t.style.maxHeight="100%",t.style.maxWidth="100%",t.style.outline="none",t.style.position="absolute"},n._onContentError=function(t){return this._imageIsReady=!1,this._image=null,this.trigger(kr.ERROR,{type:Gr.FAIL_IMAGE_LOAD,message:"failed to load image"}),!1},n._triggerContentLoad=function(){this.trigger(kr.IMAGE_LOADED,{content:this._image,isVideo:this._isVideo,projectionType:this._imageType})},n._onContentLoad=function(t){return this._imageIsReady=!0,this._triggerContentLoad(),!0},n.isImageLoaded=function(){return!!this._image&&this._imageIsReady&&(!this._isVideo||this._image.readyState>=2)},n.bindTexture=function(){var t=this;return new Xr((function(e,n){t._contentLoader?t._contentLoader.get().then((function(){t._bindTexture()}),n).then(e):n("ImageLoader is not initialized")}))},n.attachTo=function(t){this.detach(),t.appendChild(this.canvas),this._wrapper=t},n.forceContextLoss=function(){if(this.hasRenderingContext()){var t=this.context.getExtension("WEBGL_lose_context");t&&t.loseContext()}},n.detach=function(){this.canvas.parentElement&&this.canvas.parentElement.removeChild(this.canvas)},n.destroy=function(){this._contentLoader&&this._contentLoader.destroy(),this._animator.stop(),this.detach(),this.forceContextLoss(),this.off(),this.canvas.removeEventListener("webglcontextlost",this._onWebglcontextlost),this.canvas.removeEventListener("webglcontextrestored",this._onWebglcontextrestored)},n.hasRenderingContext=function(){return!(!this.context||this.context.isContextLost())&&!(this.context&&!this.context.getProgramParameter(this.shaderProgram,this.context.LINK_STATUS))},n._initShaderProgram=function(){var t=this.context;this.shaderProgram&&(t.deleteProgram(this.shaderProgram),this.shaderProgram=null);var e=this._renderer,n=e.getVertexShaderSource(),i=e.getFragmentShaderSource(),r=er.createShader(t,t.VERTEX_SHADER,n),o=er.createShader(t,t.FRAGMENT_SHADER,i),s=er.createProgram(t,r,o);if(!s)throw new Error("Failed to intialize shaders: "+er.getErrorNameFromWebGLErrorCode(t.getError()));t.useProgram(s),s.vertexPositionAttribute=t.getAttribLocation(s,"aVertexPosition"),t.enableVertexAttribArray(s.vertexPositionAttribute),s.pMatrixUniform=t.getUniformLocation(s,"uPMatrix"),s.mvMatrixUniform=t.getUniformLocation(s,"uMVMatrix"),s.samplerUniform=t.getUniformLocation(s,"uSampler"),s.textureCoordAttribute=t.getAttribLocation(s,"aTextureCoord"),t.enableVertexAttribArray(s.textureCoordAttribute),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT|t.STENCIL_BUFFER_BIT),t.uniform1i(s.samplerUniform,0),this.shaderProgram=s},n._onWebglcontextlost=function(t){t.preventDefault(),this.trigger(kr.RENDERING_CONTEXT_LOST)},n._onWebglcontextrestored=function(t){this._initWebGL(),this.trigger(kr.RENDERING_CONTEXT_RESTORE)},n.updateFieldOfView=function(t){this.fieldOfView=t,this._updateViewport()},n.updateViewportDimensions=function(t,e){var n=!1;this.width=t,this.height=e;var i=t*Hr,r=e*Hr;i!==this.canvas.width&&(this.canvas.width=i,n=!0),r!==this.canvas.height&&(this.canvas.height=r,n=!0),n&&(this._updateViewport(),this._shouldForceDraw=!0)},n._updateViewport=function(){E(this.pMatrix,d(this.fieldOfView),this.canvas.width/this.canvas.height,.1,100),this.context.viewport(0,0,this.context.drawingBufferWidth,this.context.drawingBufferHeight)},n._initWebGL=function(){var t;try{this._initRenderingContext(),t=this.context,this.updateViewportDimensions(this.width,this.height),this._initShaderProgram()}catch(t){return this.trigger(kr.ERROR,{type:Gr.NO_WEBGL,message:"no webgl support"}),this.destroy(),void console.error(t)}t.clearColor(0,0,0,0);var e=this._isCubeMap?t.TEXTURE_CUBE_MAP:t.TEXTURE_2D;this.texture&&t.deleteTexture(this.texture),this.texture=er.createTexture(t,e),this._imageType===Br.CUBESTRIP&&t.enable(t.CULL_FACE)},n._initRenderingContext=function(){if(!this.hasRenderingContext()){if(!window.WebGLRenderingContext)throw new Error("WebGLRenderingContext not available.");if(this.context=er.getWebglContext(this.canvas,this._renderingContextAttributes),!this.context)throw new Error("Failed to acquire 3D rendering context")}},n._initBuffers=function(){var t=this._renderer.getVertexPositionData(),e=this._renderer.getIndexData(),n=this._renderer.getTextureCoordData(this._imageConfig),i=this.context;this.vertexBuffer=er.initBuffer(i,i.ARRAY_BUFFER,new Float32Array(t),3,this.shaderProgram.vertexPositionAttribute),this.indexBuffer=er.initBuffer(i,i.ELEMENT_ARRAY_BUFFER,new Uint16Array(e),1),this.textureCoordBuffer=er.initBuffer(i,i.ARRAY_BUFFER,new Float32Array(n),this._isCubeMap?3:2,this.shaderProgram.textureCoordAttribute)},n._bindTexture=function(){if(this._imageType===Br.CUBESTRIP){var t=this._renderer.getDimension(this._image),e=t.width,n=t.height,i=e&&n&&e/n!=1.5;this.context.uniform1f(this.context.getUniformLocation(this.shaderProgram,"uIsEAC"),i)}else if(this._imageType===Br.PANORAMA){var r=this._renderer.getDimension(this._image),o=r.width,s=r.height,a=o&&s&&o/s;this._renderer.updateShaderData({imageAspectRatio:a})}this._initBuffers(),this._renderer.bindTexture(this.context,this.texture,this._image,this._imageConfig),this._shouldForceDraw=!0,this.trigger(kr.BIND_TEXTURE)},n._updateTexture=function(){this._renderer.updateTexture(this.context,this._image,this._imageConfig)},n.keepUpdate=function(t){t&&!1===this.isImageLoaded()&&(this._shouldForceDraw=!0),this._keepUpdate=t},n.startRender=function(){this._animator.setCallback(this._render.bind(this)),this._animator.start()},n.stopRender=function(){this._animator.stop()},n.renderWithQuaternion=function(t,e){this.isImageLoaded()&&(!1===this._keepUpdate&&this._lastQuaternion&&q(this._lastQuaternion,t)&&this.fieldOfView&&this.fieldOfView===e&&!1===this._shouldForceDraw||(void 0!==e&&e!==this.fieldOfView&&this.updateFieldOfView(e),this.mvMatrix=function(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],s=n+n,a=i+i,h=r+r,u=n*s,c=i*s,l=i*a,f=r*s,d=r*a,p=r*h,v=o*s,g=o*a,m=o*h;return t[0]=1-l-p,t[1]=c+m,t[2]=f-g,t[3]=0,t[4]=c-m,t[5]=1-u-p,t[6]=d+v,t[7]=0,t[8]=f+g,t[9]=d-v,t[10]=1-u-l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}(m(),t),this._draw(),this._lastQuaternion=k(t),this._shouldForceDraw&&(this._shouldForceDraw=!1)))},n.renderWithYawPitch=function(t,e,n){var i;this.isImageLoaded()&&(!1===this._keepUpdate&&null!==this._lastYaw&&this._lastYaw===t&&null!==this._lastPitch&&this._lastPitch===e&&this.fieldOfView&&this.fieldOfView===n&&!1===this._shouldForceDraw||(void 0!==n&&n!==this.fieldOfView&&this.updateFieldOfView(n),(i=this.mvMatrix)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,_(this.mvMatrix,this.mvMatrix,-d(e)),y(this.mvMatrix,this.mvMatrix,-d(t)),this._draw(),this._lastYaw=t,this._lastPitch=e,this._shouldForceDraw&&(this._shouldForceDraw=!1)))},n._render=function(){var t=this._yawPitchControl,e=t.getFov();if(t.shouldRenderWithQuaternion()){var n=t.getQuaternion();this.renderWithQuaternion(n,e)}else{var i=t.getYawPitch();this.renderWithYawPitch(i.yaw,i.pitch,e)}},n._draw=function(){this._isVideo&&this._keepUpdate&&this._updateTexture();var t=this.context,e=this.shaderProgram,n=this.vertexBuffer,i=this.textureCoordBuffer;t.bindBuffer(t.ARRAY_BUFFER,n),t.enableVertexAttribArray(e.vertexPositionAttribute),t.vertexAttribPointer(e.vertexPositionAttribute,n.itemSize,t.FLOAT,!1,0,0),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bindBuffer(t.ARRAY_BUFFER,i),t.enableVertexAttribArray(e.textureCoordAttribute),t.vertexAttribPointer(e.textureCoordAttribute,i.itemSize,t.FLOAT,!1,0,0),this._renderer.render({gl:this.context,shaderProgram:this.shaderProgram,indexBuffer:this.indexBuffer,mvMatrix:this.mvMatrix,pMatrix:this.pMatrix})},n.getProjectionRenderer=function(){return this._renderer},n.enterVR=function(){var t=this._vr;return ut||navigator.getVRDisplays?t&&t.isPresenting()?Xr.resolve("VR already enabled."):this._requestPresent():Xr.reject("VR is not available on this browser.")},n._requestPresent=function(){var t=this,e=this.context,n=this.canvas,i=this._animator;this._vr=ut?new Wr:new Ur;var r=this._vr;return i.stop(),new Xr((function(o,s){r.requestPresent(n,e).then((function(){r.addEndCallback(t.exitVR),i.setContext(r.context),i.setCallback(t._onFirstVRFrame),et&&t._setWrapperFullscreen(),t._shouldForceDraw=!0,i.start(),o("success")})).catch((function(e){r.destroy(),t._vr=null,i.start(),s(e)}))}))},n._setWrapperFullscreen=function(){var t=this._wrapper;if(t){this._wrapperOrigStyle=t.getAttribute("style");var e=t.style;e.width="100vw",e.height="100vh",e.position="fixed",e.left="0",e.top="0",e.zIndex="9999"}},n._restoreStyle=function(){var t=this._wrapper,e=this.canvas;t&&(this._wrapperOrigStyle?t.setAttribute("style",this._wrapperOrigStyle):t.removeAttribute("style"),this._wrapperOrigStyle=null,e.removeAttribute("style"),this._setDefaultCanvasStyle())},e}(u);return t.EVENTS=kr,t.ERROR_TYPE=Gr,t}(),zr="undefined"==typeof Promise?a.Promise:Promise,qr=function(){var t=function(t){function e(n,r){var s;if(void 0===r&&(r={}),s=t.call(this)||this,!er.isWebGLAvailable())return setTimeout((function(){s.trigger(ur.ERROR,{type:hr.NO_WEBGL,message:"no webgl support"})}),0),o(s)||o(s);if(!er.isStableWebGL())return setTimeout((function(){s.trigger(ur.ERROR,{type:hr.INVALID_DEVICE,message:"blacklisted browser"})}),0),o(s)||o(s);if(r.image&&r.video)return setTimeout((function(){s.trigger(ur.ERROR,{type:hr.INVALID_RESOURCE,message:"Specifying multi resouces(both image and video) is not valid."})}),0),o(s)||o(s);ct(),s._container=n,s._image=r.image||r.video,s._isVideo=!!r.video,s._projectionType=r.projectionType||cr.EQUIRECTANGULAR,s._cubemapConfig=i({order:s._projectionType===cr.CUBEMAP?"RLUDBF":"RLUDFB",tileConfig:{flipHorizontal:!1,rotation:0}},r.cubemapConfig),s._stereoFormat=r.stereoFormat||lr.TOP_BOTTOM,s._width=r.width||parseInt(window.getComputedStyle(n).width,10),s._height=r.height||parseInt(window.getComputedStyle(n).height,10),s._yaw=r.yaw||0,s._pitch=r.pitch||0,s._fov=r.fov||65,s._gyroMode=r.gyroMode||mi.YAWPITCH,s._quaternion=null,s._aspectRatio=0!==s._height?s._width/s._height:1;var a=r.fovRange||[30,110],h=e._isValidTouchDirection(r.touchDirection)?r.touchDirection:Ci.TOUCH_DIRECTION_ALL,u=i(r,{element:n,yaw:s._yaw,pitch:s._pitch,fov:s._fov,gyroMode:s._gyroMode,fovRange:a,aspectRatio:s._aspectRatio,touchDirection:h});return s._isReady=!1,s._initYawPitchControl(u),s._initRenderer(s._yaw,s._pitch,s._fov,s._projectionType,s._cubemapConfig),s}r(e,t);var n=e.prototype;return n.getVideo=function(){return this._isVideo?this._photoSphereRenderer.getContent():null},n.setVideo=function(t,e){return void 0===e&&(e={}),t&&this.setImage(t,{projectionType:e.projectionType,isVideo:!0,cubemapConfig:e.cubemapConfig,stereoFormat:e.stereoFormat}),this},n.getImage=function(){return this._isVideo?null:this._photoSphereRenderer.getContent()},n.setImage=function(t,e){void 0===e&&(e={});var n=i({order:"RLUDBF",tileConfig:{flipHorizontal:!1,rotation:0}},e.cubemapConfig),r=e.stereoFormat||lr.TOP_BOTTOM,o=!!e.isVideo;return this._image&&this._isVideo!==o?(console.warn("Currently not supporting to change content type(Image <--\x3e Video)"),this):(t&&(this._image=t,this._isVideo=o,this._projectionType=e.projectionType||cr.EQUIRECTANGULAR,this._cubemapConfig=n,this._stereoFormat=r,this._deactivate(),this._initRenderer(this._yaw,this._pitch,this._fov,this._projectionType,this._cubemapConfig)),this)},n.keepUpdate=function(t){return this._photoSphereRenderer.keepUpdate(t),this},n.getProjectionType=function(){return this._projectionType},n.enableSensor=function(){return this._yawPitchControl.enableSensor()},n.disableSensor=function(){return this._yawPitchControl.disableSensor(),this},n.enterVR=function(){var t=this;return this._isReady?new zr((function(e,n){t.enableSensor().then((function(){return t._photoSphereRenderer.enterVR()})).then((function(t){return e(t)})).catch((function(t){return n(t)}))})):zr.reject(new Error("PanoViewer is not ready to show image."))},n.exitVR=function(){return this._photoSphereRenderer.exitVR(),this},n._initRenderer=function(t,e,n,i,r){var o=this;this._photoSphereRenderer=new jr(this._image,this._width,this._height,this._isVideo,{initialYaw:t,initialPitch:e,fieldOfView:n,imageType:i,cubemapConfig:r,stereoFormat:this._stereoFormat}),this._photoSphereRenderer.setYawPitchControl(this._yawPitchControl),this._bindRendererHandler(),this._photoSphereRenderer.bindTexture().then((function(){return o._activate()})).catch((function(){o._triggerEvent(ur.ERROR,{type:hr.FAIL_BIND_TEXTURE,message:"failed to bind texture"})}))},n._updateYawPitchIfNeeded=function(){if(this._projectionType===e.ProjectionType.PANORAMA){var t,n,i,r=this._photoSphereRenderer.getContent(),o=r.naturalWidth/r.naturalHeight;o<1&&(o=1/o),o<6?(n=jn.toDegree(o),t=!1,i=2*jn.toDegree(Math.atan(.5))):(n=360,t=!0,i=360/o);var s=this._yawPitchControl.option("fovRange")[0];this._yawPitchControl.option({fov:i,yawRange:[-n/2,n/2],isCircular:t,pitchRange:[-i/2,i/2],fovRange:[s,i]}),this.lookAt({fov:i})}},n._bindRendererHandler=function(){var t=this;this._photoSphereRenderer.on(jr.EVENTS.ERROR,(function(e){t.trigger(ur.ERROR,e)})),this._photoSphereRenderer.on(jr.EVENTS.RENDERING_CONTEXT_LOST,(function(e){t._deactivate(),t.trigger(ur.ERROR,{type:hr.RENDERING_CONTEXT_LOST,message:"webgl rendering context lost"})}))},n._initYawPitchControl=function(t){var e=this;this._yawPitchControl=new Ci(t),this._yawPitchControl.on(ur.ANIMATION_END,(function(t){e._triggerEvent(ur.ANIMATION_END,t)})),this._yawPitchControl.on("change",(function(t){e._yaw=t.yaw,e._pitch=t.pitch,e._fov=t.fov,e._quaternion=t.quaternion,e._triggerEvent(ur.VIEW_CHANGE,t)}))},n._triggerEvent=function(t,e){var n=e||{};return this.trigger(t,n)},n.setUseZoom=function(t){return"boolean"==typeof t&&this._yawPitchControl.option("useZoom",t),this},n.setUseKeyboard=function(t){return this._yawPitchControl.option("useKeyboard",t),this},n.setGyroMode=function(t){return this._yawPitchControl.option("gyroMode",t),this},n.setFovRange=function(t){return this._yawPitchControl.option("fovRange",t),this},n.getFovRange=function(){return this._yawPitchControl.option("fovRange")},n.updateViewportDimensions=function(t){if(void 0===t&&(t={width:void 0,height:void 0}),!this._isReady)return this;var e;void 0!==t.width&&void 0!==t.height||(e=window.getComputedStyle(this._container));var n=t.width||parseInt(e.width,10),i=t.height||parseInt(e.height,10);return n===this._width&&i===this._height?this:(this._width=n,this._height=i,this._aspectRatio=n/i,this._photoSphereRenderer.updateViewportDimensions(n,i),this._yawPitchControl.option("aspectRatio",this._aspectRatio),this._yawPitchControl.updatePanScale({height:i}),this.lookAt({},0),this)},n.getFov=function(){return this._fov},n._getHFov=function(){return jn.toDegree(2*Math.atan(this._aspectRatio*Math.tan(d(this._fov)/2)))},n.getYaw=function(){return this._yaw},n.getPitch=function(){return this._pitch},n.getYawRange=function(){return this._yawPitchControl.option("yawRange")},n.getPitchRange=function(){return this._yawPitchControl.option("pitchRange")},n.setYawRange=function(t){return this._yawPitchControl.option("yawRange",t),this},n.setPitchRange=function(t){return this._yawPitchControl.option("pitchRange",t),this},n.setShowPolePoint=function(t){return this._yawPitchControl.option("showPolePoint",t),this},n.lookAt=function(t,e){if(!this._isReady)return this;var n=void 0!==t.yaw?t.yaw:this._yaw,i=void 0!==t.pitch?t.pitch:this._pitch,r=this._yawPitchControl.option("pitchRange"),o=r[1]-r[0],s=void 0!==t.fov?t.fov:this._fov;return o<s&&(s=o),this._yawPitchControl.lookAt({yaw:n,pitch:i,fov:s},e),0===e&&this._photoSphereRenderer.renderWithYawPitch(n,i,s),this},n._activate=function(){this._photoSphereRenderer.attachTo(this._container),this._yawPitchControl.enable(),this.updateViewportDimensions(),this._isReady=!0,this._updateYawPitchIfNeeded(),this._triggerEvent(ur.READY),this._photoSphereRenderer.startRender()},n._deactivate=function(){this._isReady&&(this._photoSphereRenderer.stopRender(),this._yawPitchControl.disable(),this._isReady=!1),this._photoSphereRenderer&&(this._photoSphereRenderer.destroy(),this._photoSphereRenderer=null)},e._isValidTouchDirection=function(t){return t===e.TOUCH_DIRECTION.NONE||t===e.TOUCH_DIRECTION.YAW||t===e.TOUCH_DIRECTION.PITCH||t===e.TOUCH_DIRECTION.ALL},n.setTouchDirection=function(t){return e._isValidTouchDirection(t)&&this._yawPitchControl.option("touchDirection",t),this},n.getTouchDirection=function(){return this._yawPitchControl.option("touchDirection")},n.destroy=function(){return this._deactivate(),this._yawPitchControl&&(this._yawPitchControl.destroy(),this._yawPitchControl=null),this},e.isSupported=function(){return er.isWebGLAvailable()&&er.isStableWebGL()},e.isWebGLAvailable=function(){return er.isWebGLAvailable()},e.isGyroSensorAvailable=function(t){var n;at?zr.race([new zr((function(t,e){n=function(e){var n=!(null==e.rotationRate.alpha);t(n)},window.addEventListener("devicemotion",n)})),new zr((function(t,e){setTimeout((function(){return t(!1)}),1e3)}))]).then((function(i){window.removeEventListener("devicemotion",n),t&&t(i),e.isGyroSensorAvailable=function(t){return t&&t(i),i}})):t&&t(!1)},e}(u);return t.VERSION=wi,t.ERROR_TYPE=hr,t.EVENTS=ur,t.PROJECTION_TYPE=cr,t.GYRO_MODE=mi,t.ProjectionType=cr,t.STEREO_FORMAT=lr,t.TOUCH_DIRECTION={NONE:Ci.TOUCH_DIRECTION_NONE,YAW:Ci.TOUCH_DIRECTION_YAW,PITCH:Ci.TOUCH_DIRECTION_PITCH,ALL:Ci.TOUCH_DIRECTION_ALL},t}();t.PanoViewer=qr,t.VERSION=wi,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=view360.panoviewer.pkgd.min.js.map
