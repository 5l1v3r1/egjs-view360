/*
Copyright (c) 2017 NAVER Corp.
@egjs/view360 project is licensed under the MIT license
@egjs/view360 JavaScript library
https://github.com/naver/egjs-view360
@version 3.3.0
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@egjs/axes"),require("@egjs/component")):"function"==typeof define&&define.amd?define(["exports","@egjs/axes","@egjs/component"],e):e((t.eg=t.eg||{},t.eg.view360={}),t.eg.Axes,t.eg.Component)}(this,(function(t,e,n){"use strict";function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function i(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}function o(){return(o=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}function a(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}function s(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var u="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var h=function(t,e){return t(e={exports:{}},e.exports),e.exports}((function(t,e){t.exports=function(){function t(t){return"function"==typeof t}var e=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},n=0,r=void 0,i=void 0,o=function(t,e){l[n]=t,l[n+1]=e,2===(n+=2)&&(i?i(_):E())},a="undefined"!=typeof window?window:void 0,s=a||{},h=s.MutationObserver||s.WebKitMutationObserver,c="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),d="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function f(){var t=setTimeout;return function(){return t(_,1)}}var l=new Array(1e3);function _(){for(var t=0;t<n;t+=2)(0,l[t])(l[t+1]),l[t]=void 0,l[t+1]=void 0;n=0}var v,g,p,m,E=void 0;function y(t,e){var n=this,r=new this.constructor(T);void 0===r[x]&&V(r);var i=n._state;if(i){var a=arguments[i-1];o((function(){return L(i,r,a,n._result)}))}else D(n,r,t,e);return r}function w(t){if(t&&"object"==typeof t&&t.constructor===this)return t;var e=new this(T);return I(e,t),e}c?E=function(){return process.nextTick(_)}:h?(g=0,p=new h(_),m=document.createTextNode(""),p.observe(m,{characterData:!0}),E=function(){m.data=g=++g%2}):d?((v=new MessageChannel).port1.onmessage=_,E=function(){return v.port2.postMessage(0)}):E=void 0===a?function(){try{var t=Function("return this")().require("vertx");return void 0!==(r=t.runOnLoop||t.runOnContext)?function(){r(_)}:f()}catch(t){return f()}}():f();var x=Math.random().toString(36).substring(2);function T(){}var R=void 0,A=1,C=2;function b(e,n,r){n.constructor===e.constructor&&r===y&&n.constructor.resolve===w?function(t,e){e._state===A?O(t,e._result):e._state===C?P(t,e._result):D(e,void 0,(function(e){return I(t,e)}),(function(e){return P(t,e)}))}(e,n):void 0===r?O(e,n):t(r)?function(t,e,n){o((function(t){var r=!1,i=function(t,e,n,r){try{t.call(e,n,r)}catch(t){return t}}(n,e,(function(n){r||(r=!0,e!==n?I(t,n):O(t,n))}),(function(e){r||(r=!0,P(t,e))}),t._label);!r&&i&&(r=!0,P(t,i))}),t)}(e,n,r):O(e,n)}function I(t,e){if(t===e)P(t,new TypeError("You cannot resolve a promise with itself"));else if(function(t){var e=typeof t;return null!==t&&("object"===e||"function"===e)}(e)){var n=void 0;try{n=e.then}catch(e){return void P(t,e)}b(t,e,n)}else O(t,e)}function S(t){t._onerror&&t._onerror(t._result),M(t)}function O(t,e){t._state===R&&(t._result=e,t._state=A,0!==t._subscribers.length&&o(M,t))}function P(t,e){t._state===R&&(t._state=C,t._result=e,o(S,t))}function D(t,e,n,r){var i=t._subscribers,a=i.length;t._onerror=null,i[a]=e,i[a+A]=n,i[a+C]=r,0===a&&t._state&&o(M,t)}function M(t){var e=t._subscribers,n=t._state;if(0!==e.length){for(var r=void 0,i=void 0,o=t._result,a=0;a<e.length;a+=3)r=e[a],i=e[a+n],r?L(n,r,i,o):i(o);t._subscribers.length=0}}function L(e,n,r,i){var o=t(r),a=void 0,s=void 0,u=!0;if(o){try{a=r(i)}catch(t){u=!1,s=t}if(n===a)return void P(n,new TypeError("A promises callback cannot return that same promise."))}else a=i;n._state!==R||(o&&u?I(n,a):!1===u?P(n,s):e===A?O(n,a):e===C&&P(n,a))}var N=0;function V(t){t[x]=N++,t._state=void 0,t._result=void 0,t._subscribers=[]}var F=function(){function t(t,n){this._instanceConstructor=t,this.promise=new t(T),this.promise[x]||V(this.promise),e(n)?(this.length=n.length,this._remaining=n.length,this._result=new Array(this.length),0===this.length?O(this.promise,this._result):(this.length=this.length||0,this._enumerate(n),0===this._remaining&&O(this.promise,this._result))):P(this.promise,new Error("Array Methods must be provided an Array"))}return t.prototype._enumerate=function(t){for(var e=0;this._state===R&&e<t.length;e++)this._eachEntry(t[e],e)},t.prototype._eachEntry=function(t,e){var n=this._instanceConstructor,r=n.resolve;if(r===w){var i=void 0,o=void 0,a=!1;try{i=t.then}catch(t){a=!0,o=t}if(i===y&&t._state!==R)this._settledAt(t._state,e,t._result);else if("function"!=typeof i)this._remaining--,this._result[e]=t;else if(n===U){var s=new n(T);a?P(s,o):b(s,t,i),this._willSettleAt(s,e)}else this._willSettleAt(new n((function(e){return e(t)})),e)}else this._willSettleAt(r(t),e)},t.prototype._settledAt=function(t,e,n){var r=this.promise;r._state===R&&(this._remaining--,t===C?P(r,n):this._result[e]=n),0===this._remaining&&O(r,this._result)},t.prototype._willSettleAt=function(t,e){var n=this;D(t,void 0,(function(t){return n._settledAt(A,e,t)}),(function(t){return n._settledAt(C,e,t)}))},t}(),U=function(){function e(t){this[x]=N++,this._result=this._state=void 0,this._subscribers=[],T!==t&&("function"!=typeof t&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof e?function(t,e){try{e((function(e){I(t,e)}),(function(e){P(t,e)}))}catch(e){P(t,e)}}(this,t):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return e.prototype.catch=function(t){return this.then(null,t)},e.prototype.finally=function(e){var n=this.constructor;return t(e)?this.then((function(t){return n.resolve(e()).then((function(){return t}))}),(function(t){return n.resolve(e()).then((function(){throw t}))})):this.then(e,e)},e}();return U.prototype.then=y,U.all=function(t){return new F(this,t).promise},U.race=function(t){var n=this;return e(t)?new n((function(e,r){for(var i=t.length,o=0;o<i;o++)n.resolve(t[o]).then(e,r)})):new n((function(t,e){return e(new TypeError("You must pass an array to race."))}))},U.resolve=w,U.reject=function(t){var e=new this(T);return P(e,t),e},U._setScheduler=function(t){i=t},U._setAsap=function(t){o=t},U._asap=o,U.polyfill=function(){var t=void 0;if(void 0!==u)t=u;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var e=t.Promise;if(e){var n=null;try{n=Object.prototype.toString.call(e.resolve())}catch(t){}if("[object Promise]"===n&&!e.cast)return}t.Promise=U},U.Promise=U,U}()})),c=1e-6,d="undefined"!=typeof Float32Array?Float32Array:Array,f=Math.PI/180;function l(t){return t*f}function _(){var t=new d(9);return d!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function v(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function g(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],h=e[7],c=e[8],d=c*a-s*h,f=-c*o+s*u,l=h*o-a*u,_=n*d+r*f+i*l;return _?(_=1/_,t[0]=d*_,t[1]=(-c*r+i*h)*_,t[2]=(s*r-i*a)*_,t[3]=f*_,t[4]=(c*n-i*u)*_,t[5]=(-s*n+i*o)*_,t[6]=l*_,t[7]=(-h*n+r*u)*_,t[8]=(a*n-r*o)*_,t):null}function p(){var t=new d(16);return d!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function m(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[4],a=e[5],s=e[6],u=e[7],h=e[8],c=e[9],d=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*i+h*r,t[5]=a*i+c*r,t[6]=s*i+d*r,t[7]=u*i+f*r,t[8]=h*i-o*r,t[9]=c*i-a*r,t[10]=d*i-s*r,t[11]=f*i-u*r,t}function E(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[0],a=e[1],s=e[2],u=e[3],h=e[8],c=e[9],d=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i-h*r,t[1]=a*i-c*r,t[2]=s*i-d*r,t[3]=u*i-f*r,t[8]=o*r+h*i,t[9]=a*r+c*i,t[10]=s*r+d*i,t[11]=u*r+f*i,t}function y(t,e,n,r,i){var o,a=1/Math.tan(e/2);return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(o=1/(r-i),t[10]=(i+r)*o,t[14]=2*i*r*o):(t[10]=-1,t[14]=-2*r),t}function w(){var t=new d(3);return d!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function x(t){var e=t[0],n=t[1],r=t[2];return Math.hypot(e,n,r)}function T(t,e,n){var r=new d(3);return r[0]=t,r[1]=e,r[2]=n,r}function R(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function A(t,e){var n=e[0],r=e[1],i=e[2],o=n*n+r*r+i*i;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t}function C(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function b(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[0],s=n[1],u=n[2];return t[0]=i*u-o*s,t[1]=o*a-r*u,t[2]=r*s-i*a,t}function I(t,e,n){var r=e[0],i=e[1],o=e[2];return t[0]=r*n[0]+i*n[3]+o*n[6],t[1]=r*n[1]+i*n[4]+o*n[7],t[2]=r*n[2]+i*n[5]+o*n[8],t}function S(t,e,n){var r=n[0],i=n[1],o=n[2],a=n[3],s=e[0],u=e[1],h=e[2],c=i*h-o*u,d=o*s-r*h,f=r*u-i*s,l=i*f-o*d,_=o*c-r*f,v=r*d-i*c,g=2*a;return c*=g,d*=g,f*=g,l*=2,_*=2,v*=2,t[0]=s+c+l,t[1]=u+d+_,t[2]=h+f+v,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var O,P=R,D=x;O=w();!function(){var t,e=(t=new d(4),d!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t)}();function M(){var t=new d(4);return d!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function L(t,e,n){n*=.5;var r=Math.sin(n);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(n),t}function N(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=n[0],u=n[1],h=n[2],c=n[3];return t[0]=r*c+a*s+i*h-o*u,t[1]=i*c+a*u+o*s-r*h,t[2]=o*c+a*h+r*u-i*s,t[3]=a*c-r*s-i*u-o*h,t}function V(t,e,n,r){var i,o,a,s,u,h=e[0],d=e[1],f=e[2],l=e[3],_=n[0],v=n[1],g=n[2],p=n[3];return(o=h*_+d*v+f*g+l*p)<0&&(o=-o,_=-_,v=-v,g=-g,p=-p),1-o>c?(i=Math.acos(o),a=Math.sin(i),s=Math.sin((1-r)*i)/a,u=Math.sin(r*i)/a):(s=1-r,u=r),t[0]=s*h+u*_,t[1]=s*d+u*v,t[2]=s*f+u*g,t[3]=s*l+u*p,t}function F(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}var U,B,W,X,Y,H,G=function(t){var e=new d(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},k=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},j=N,q=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n*n+r*r+i*i+o*o;return a>0&&(a=1/Math.sqrt(a)),t[0]=n*a,t[1]=r*a,t[2]=i*a,t[3]=o*a,t},z=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]};U=w(),B=T(1,0,0),W=T(0,1,0),X=M(),Y=M(),H=_();function Q(t,e){var n=new d(2);return n[0]=t,n[1]=e,n}function K(t,e){return t[0]=e[0],t[1]=e[1],t}function Z(t,e){var n=e[0],r=e[1],i=n*n+r*r;return i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t}!function(){var t,e=(t=new d(2),d!=Float32Array&&(t[0]=0,t[1]=0),t)}();var J="undefined"!=typeof window&&window.Math===Math?window:"undefined"!=typeof self&&self.Math===Math?self:Function("return this")(),$=J.document,tt=J.navigator&&J.navigator.userAgent||"",et=navigator.platform&&/iPad|iPhone|iPod/.test(navigator.platform),nt=-1!==tt.indexOf("Safari")&&-1===tt.indexOf("Chrome")&&-1!==tt.indexOf("Mac OS X")&&!et;/SamsungBrowser/i.test(tt);J.Float32Array=void 0!==J.Float32Array?J.Float32Array:J.Array;J.Float32Array;var rt=J.getComputedStyle,it=J.navigator.userAgent,ot="ontouchstart"in J,at="ondevicemotion"in J,st=J.DeviceMotionEvent,ut=J.devicePixelRatio,ht=(function(){for(var t=$.documentElement.style,e=["transform","webkitTransform","msTransform","mozTransform"],n=0,r=e.length;n<r;n++)if(e[n]in t)return e[n]}(),J.CSS&&J.CSS.supports&&J.CSS.supports("will-change","transform"),!1),ct=function(){navigator.xr&&(navigator.xr.isSessionSupported?navigator.xr.isSessionSupported("immersive-vr").then((function(){ht=!0})).catch((function(){})):navigator.xr.supportsSession&&navigator.xr.supportsSession("immersive-vr").then((function(){ht=!0})).catch((function(){})))};function dt(t){return 180*t/Math.PI}var ft={isPowerOfTwo:function(t){return t&&0==(t&t-1)}};ft.extractPitchFromQuat=function(t){var e=function(t){var e=T(0,0,1);return S(e,e,t),e}(t);return-1*Math.atan2(e[1],Math.sqrt(Math.pow(e[0],2)+Math.pow(e[2],2)))},ft.hypot=Math.hypot||function(t,e){return Math.sqrt(t*t+e*e)};var lt={PITCH_DELTA:1,YAW_DELTA_BY_ROLL:2,YAW_DELTA_BY_YAW:3};function _t(t,e){var n=t[0]*e[1]-e[0]*t[1];return-Math.atan2(n,function(t,e){return t[0]*e[0]+t[1]*e[1]}(t,e))}lt[lt.PITCH_DELTA]={targetAxis:[0,1,0],meshPoint:[0,0,1]},lt[lt.YAW_DELTA_BY_ROLL]={targetAxis:[0,1,0],meshPoint:[1,0,0]},lt[lt.YAW_DELTA_BY_YAW]={targetAxis:[1,0,0],meshPoint:[0,0,1]},ft.yawOffsetBetween=function(t,e){var n=Q(t[0],t[2]),r=Q(e[0],e[2]);return Z(n,n),Z(r,r),-_t(n,r)},ft.toDegree=dt,ft.getRotationDelta=function(t,e,n){var r=T(lt[n].targetAxis[0],lt[n].targetAxis[1],lt[n].targetAxis[2]),i=lt[n].meshPoint,o=G(t),a=G(e);q(o,o),q(a,a);var s=T(0,0,1),u=T(0,0,1);S(s,s,o),S(u,u,a),S(r,r,a);var h,c=C(r,b(w(),s,u))>0?1:-1,d=T(i[0],i[1],i[2]);h=n!==lt.YAW_DELTA_BY_YAW?T(0,c,0):T(c,0,0),S(d,d,a),S(h,h,a);var f=d,l=h,_=w();b(_,f,l),A(_,_);var v=_[0],g=_[1],p=_[2];S(u=T(i[0],i[1],i[2]),u,a),S(s=T(i[0],i[1],i[2]),s,o);var m=Math.abs(s[0]*v+s[1]*g+s[2]*p),E=w();R(E,s,function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}(w(),_,m));var y=(E[0]*u[0]+E[1]*u[1]+E[2]*u[2])/(x(E)*x(u));y>1&&(y=1);var I=Math.acos(y),O=b(w(),u,E);return m=v*O[0]+g*O[1]+p*O[2],dt(I*(n!==lt.YAW_DELTA_BY_YAW?m>0?1:-1:m<0?1:-1)*c)},ft.angleBetweenVec2=_t;var vt=function(t){function n(n,r,i){var o;return(o=t.call(this,n,r)||this)._useRotation=!1,o._deviceSensor=i,o.setUseRotation(!(!r||!r.useRotation)),o._userDirection=e.DIRECTION_ALL,o}a(n,t);var r=n.prototype;return r.setUseRotation=function(t){this._useRotation=t},r.connect=function(n){this._userDirection=this._direction,this._useRotation&&this._direction&e.DIRECTION_ALL&&(this._direction=e.DIRECTION_HORIZONTAL),t.prototype.connect.call(this,n)},r.getOffset=function(n,r){if(!1===this._useRotation)return t.prototype.getOffset.call(this,n,r);var i=t.prototype.getOffset.call(this,n,[!0,!0]),o=[0,0],a=this._deviceSensor.getDeviceHorizontalRight(),s=Q(a[0],a[1]),u=Q(1,0),h=ft.angleBetweenVec2(s,u),c=Math.cos(h),d=Math.sin(h);return o[0]=i[0]*c-i[1]*d,o[1]=i[1]*c+i[0]*d,this._userDirection&e.DIRECTION_HORIZONTAL?this._userDirection&e.DIRECTION_VERTICAL||(o[1]=0):o[0]=0,o},r.destroy=function(){t.prototype.destroy.call(this)},n}(e.PanInput);const gt=Symbol("__sensor__"),pt=gt;function mt(t,e){for(const n in e)Object.defineProperty(t,n,{configurable:!0,value:e[n]})}const Et=(t,...e)=>(class extends t{constructor(...t){super(t);const e=document.createDocumentFragment();this.addEventListener=(t,...n)=>e.addEventListener(t,...n),this.removeEventListener=(...t)=>e.removeEventListener(...t),this.dispatchEvent=t=>{mt(t,{currentTarget:this}),t.target||mt(t,{target:this});const n=`on${t.type}`;"function"==typeof this[n]&&this[n](t);const r=e.dispatchEvent(t);return r&&this.parentNode&&this.parentNode.dispatchEvent(t),mt(t,{currentTarget:null,target:null}),r}}});class yt extends(Et(Object)){}function wt(t,e,n){const r=t[e];for(const e in n)r[e]=n[e],Object.defineProperty(t,e,{get:()=>r[e]})}class xt extends Event{constructor(t,e){if(super(t,e),!(e&&e.error instanceof DOMException))throw TypeError("Failed to construct 'SensorErrorEvent':2nd argument much contain 'error' property");Object.defineProperty(this,"error",{configurable:!1,writable:!1,value:e.error})}}function Tt(t,e){Object.defineProperty(t,`on${e}`,{enumerable:!0,configurable:!1,writable:!0,value:null})}const Rt={IDLE:1,ACTIVATING:2,ACTIVE:3};class At extends yt{constructor(t){if(super(),this[pt]=new WeakMap,Tt(this,"reading"),Tt(this,"activate"),Tt(this,"error"),wt(this,pt,{activated:!1,hasReading:!1,timestamp:null}),this[pt].state=Rt.IDLE,this[pt].notifyError=(t,e)=>{let n=new xt("error",{error:new DOMException(t,e)});this.dispatchEvent(n),this.stop()},this[pt].notifyActivatedState=()=>{let t=new Event("activate");this[pt].activated=!0,this.dispatchEvent(t),this[pt].state=Rt.ACTIVE},this[pt].activateCallback=()=>{},this[pt].deactivateCallback=()=>{},this[pt].frequency=null,window&&window.parent!=window.top)throw new DOMException("Only instantiable in a top-level browsing context","SecurityError");t&&"number"==typeof t.frequency&&t.frequency>60&&(this.frequency=t.frequency)}start(){this[pt].state!==Rt.ACTIVATING&&this[pt].state!==Rt.ACTIVE&&(this[pt].state=Rt.ACTIVATING,this[pt].activateCallback())}stop(){this[pt].state!==Rt.IDLE&&(this[pt].activated=!1,this[pt].hasReading=!1,this[pt].timestamp=null,this[pt].deactivateCallback(),this[pt].state=Rt.IDLE)}}const Ct=gt;let bt;screen.orientation?bt=screen.orientation:screen.msOrientation?bt=screen.msOrientation:(bt={},Object.defineProperty(bt,"angle",{get:()=>window.orientation||0}));const It=(t,...e)=>(class extends t{constructor(...t){super(t);for(const t of e)if(`on${t}`in window){this[Ct].eventName=t;break}this[Ct].activateCallback=()=>{window.addEventListener(this[Ct].eventName,this[Ct].handleEvent,{capture:!0})},this[Ct].deactivateCallback=()=>{window.removeEventListener(this[Ct].eventName,this[Ct].handleEvent,{capture:!0})}}});function St(t,e,n){const r=Math.PI/180,i=(e||0)*r,o=(n||0)*r,a=(t||0)*r,s=Math.cos(.5*a),u=Math.sin(.5*a),h=Math.cos(.5*o),c=Math.sin(.5*o),d=Math.cos(.5*i),f=Math.sin(.5*i);return[f*h*s-d*c*u,d*c*s+f*h*u,d*h*u+f*c*s,d*h*s-f*c*u]}function Ot(t,e){return(t instanceof Float32Array||t instanceof Float64Array)&&t.length>=16&&(t[0]=1-2*(e[1]**2+e[2]**2),t[1]=2*(e[0]*e[1]-e[2]*e[3]),t[2]=2*(e[0]*e[2]+e[1]*e[3]),t[3]=0,t[4]=2*(e[0]*e[1]+e[2]*e[3]),t[5]=1-2*(e[0]**2+e[2]**2),t[6]=2*(e[1]*e[2]-e[0]*e[3]),t[7]=0,t[8]=2*(e[0]*e[2]-e[1]*e[3]),t[9]=2*(e[1]*e[2]+e[0]*e[3]),t[10]=1-2*(e[0]**2+e[1]**2),t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1),t}function Pt(t){return t?function(t,e,n){const r=Math.sin(n/2),i=Math.cos(n/2);return function(t){const e=Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2);return 0===e?[0,0,0,1]:t.map(t=>t/e)}(function(t,e){return[t[0]*e[3]+t[3]*e[0]+t[1]*e[2]-t[2]*e[1],t[1]*e[3]+t[3]*e[1]+t[2]*e[0]-t[0]*e[2],t[2]*e[3]+t[3]*e[2]+t[0]*e[1]-t[1]*e[0],t[3]*e[3]-t[0]*e[0]-t[1]*e[1]-t[2]*e[2]]}(t,[e[0]*r,e[1]*r,e[2]*r,i]))}(t,[0,0,1],-bt.angle*Math.PI/180):null}const Dt=window.RelativeOrientationSensor||class extends(It(At,"deviceorientation")){constructor(t={}){switch(super(t),t.coordinateSystem||"world"){case"screen":Object.defineProperty(this,"quaternion",{get:()=>Pt(this[Ct].quaternion)});break;case"world":default:Object.defineProperty(this,"quaternion",{get:()=>this[Ct].quaternion})}this[Ct].handleEvent=t=>{t.absolute||null===t.alpha?this[Ct].notifyError("Could not connect to a sensor","NotReadableError"):(this[Ct].activated||this[Ct].notifyActivatedState(),this[Ct].timestamp=performance.now(),this[Ct].quaternion=St(t.alpha,t.beta,t.gamma),this[Ct].hasReading=!0,this.dispatchEvent(new Event("reading")))},this[Ct].deactivateCallback=()=>{this[Ct].quaternion=null}}populateMatrix(t){Ot(t,this.quaternion)}};window.AbsoluteOrientationSensor||It(At,"deviceorientationabsolute","deviceorientation"),window.Gyroscope||It(At,"devicemotion"),window.Accelerometer||It(At,"devicemotion"),window.LinearAccelerationSensor||It(At,"devicemotion"),window.GravitySensor||It(At,"devicemotion");function Mt(t,e){return ft.getRotationDelta(t,e,lt.PITCH_DELTA)}var Lt=/Chrome\/([0-9]+)\.(?:[0-9]*)\.([0-9]*)\.([0-9]*)/i.exec(it);Lt&&(parseInt(Lt[1],10),Lt[2],Lt[3]);/Android/i.test(it);var Nt=6,Vt=[.2,.2],Ft={NONE:"none",YAWPITCH:"yawPitch",VR:"VR"},Ut="undefined"==typeof Promise?h.Promise:Promise,Bt=T(1,0,0),Wt=T(0,1,0),Xt=L(M(),Bt,-Math.PI/2),Yt=function(){return function(t){function e(e){var n;return(n=t.call(this)||this)._onFirstRead=function(){var t=n._sensor,e=n._getOrientation(),r=T(0,0,-1),i=S(w(),r,e),o=ft.yawOffsetBetween(i,r);if(0!==o){var a=L(M(),Wt,-o);j(Xt,a,Xt),n._calibrated=!0,t.removeEventListener("reading",n._onFirstRead),t.addEventListener("reading",n._onSensorRead)}},n._onSensorRead=function(){if(n._observer&&n._gyroMode===Ft.YAWPITCH){var t=n.getYawPitchDelta();n._observer.change(s(n),{},{yaw:t.yaw,pitch:t.pitch})}n.trigger("change",{isTrusted:!0})},n._enabled=!1,n._calibrated=!1,n._sensor=new Dt({frequency:60,coordinateSystem:"screen",referenceFrame:"screen"}),n._prevQuaternion=null,n._gyroMode=e,n._observer=null,n.axes=null,n}a(e,t);var n=e.prototype;return n.mapAxes=function(t){this.axes=t},n.connect=function(t){return this._observer?this:(this._observer=t,this)},n.disconnect=function(){return this._observer?(this._observer=null,this):this},n.setGyroMode=function(t){this._gyroMode=t},n.enable=function(){var t=this;return this._enabled?Ut.resolve("Sensor already enabled"):navigator&&navigator.permissions?Ut.all([navigator.permissions.query({name:"accelerometer"}),navigator.permissions.query({name:"gyroscope"})]).then((function(e){e.every((function(t){return"granted"===t.state}))&&t._startSensor()})).catch((function(){t._startSensor()})):(this._startSensor(),Ut.resolve())},n.disable=function(){this._enabled&&(this._prevQuaternion=null,this._sensor.removeEventListener("read",this._onSensorRead),this._sensor.stop())},n.isEnabled=function(){return this._enabled},n.getYawPitchDelta=function(){var t=this._prevQuaternion,e=this._getOrientation();if(!t)return this._prevQuaternion=e,{yaw:0,pitch:0};var n,r,i,o={yaw:(n=t,r=e,i=ft.getRotationDelta(n,r,lt.YAW_DELTA_BY_YAW),ft.getRotationDelta(n,r,lt.YAW_DELTA_BY_ROLL)*Math.sin(ft.extractPitchFromQuat(r))+i),pitch:Mt(t,e)};return k(t,e),o},n.getCombinedQuaternion=function(t){var e=this._getOrientation();this._prevQuaternion||(this._prevQuaternion=k(M(),e));var n=L(M(),Wt,l(t)),r=N(M(),n,e);return F(r,r),k(this._prevQuaternion,e),r},n.getDeviceHorizontalRight=function(t){var e=t||this._getOrientation(),n=F(M(),e),r=T(0,0,-1),i=S(w(),r,e),o=b(w(),i,Wt),a=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}(w(),i,o),s=w();return S(s,a,n),P(s,s,r),s[2]=0,A(s,s),s},n.destroy=function(){this.disable()},n._getOrientation=function(){return this._sensor.quaternion?N(M(),Xt,this._sensor.quaternion):M()},n._startSensor=function(){var t=this._sensor;t.start(),this._calibrated?t.addEventListener("reading",this._onSensorRead):t.addEventListener("reading",this._onFirstRead),this._enabled=!0},e}(n)}(),Ht="undefined"==typeof Promise?h.Promise:Promise,Gt=[-180,180],kt=[-90,90],jt=[-180,180],qt=function(){var t=function(t){function n(e){var n;n=t.call(this)||this;var r=o({element:null,yaw:0,pitch:0,fov:65,showPolePoint:!1,useZoom:!0,useKeyboard:!0,gyroMode:Ft.YAWPITCH,touchDirection:Nt,yawRange:Gt,pitchRange:kt,fovRange:[30,110],aspectRatio:1},e);return n._element=r.element,n._initialFov=r.fov,n._enabled=!1,n._isAnimating=!1,n._deviceSensor=(new Yt).on("change",(function(t){n._triggerChange(t)})),n._initAxes(r),n.option(r),n}a(n,t);var r=n.prototype;return r._initAxes=function(t){var r=this,i=this._updateYawRange(t.yawRange,t.fov,t.aspectRatio),o=this._updatePitchRange(t.pitchRange,t.fov,t.showPolePoint),a=t.gyroMode===Ft.VR;this.axesPanInput=new vt(this._element,{useRotation:a},this._deviceSensor),this.axesWheelInput=new e.WheelInput(this._element,{scale:-4}),this.axesPinchInput=ot?new e.PinchInput(this._element,{scale:-1}):null,this.axesMoveKeyInput=new e.MoveKeyInput(this._element,{scale:[-6,6]}),this.axes=new e({yaw:{range:i,circular:n.isCircular(i),bounce:[0,0]},pitch:{range:o,circular:n.isCircular(o),bounce:[0,0]},fov:{range:t.fovRange,circular:[!1,!1],bounce:[0,0]}},{deceleration:.0014,maximumDuration:1e3},{yaw:t.yaw,pitch:t.pitch,fov:t.fov}).on({hold:function(t){r.axes.options.maximumDuration=1e3,r.trigger("hold",{isTrusted:t.isTrusted})},change:function(t){0!==t.delta.fov&&(r._updateControlScale(t),r.updatePanScale()),r._triggerChange(t)},release:function(t){r._triggerChange(t)},animationStart:function(t){},animationEnd:function(t){r.trigger("animationEnd",{isTrusted:t.isTrusted})}})},r.updatePanScale=function(t){void 0===t&&(t={});var e=this.axes.get().fov,n=t.height||parseInt(rt(this._element).height,10),r=Vt[0]*e/this._initialFov*320/n;return this.axesPanInput.options.scale=[r,r],this.axes.options.deceleration=.0014*e/110,this},r.option=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=e.length;if(0===r)return this._getOptions();if(1===r&&"string"==typeof e[0])return this._getOptions(e[0]);var i=o({},this.options),a={},s=[];return 1===r?(s=Object.keys(e[0]),a=o({},e[0])):r>=2&&(s.push(e[0]),a[e[0]]=e[1]),this._setOptions(this._getValidatedOptions(a)),this._applyOptions(s,i),this},r._getValidatedOptions=function(t){return t.yawRange&&(t.yawRange=this._getValidYawRange(t.yawRange,t.fov,t.aspectRatio)),t.pitchRange&&(t.pitchRange=this._getValidPitchRange(t.pitchRange,t.fov)),t},r._getOptions=function(t){var e;return"string"==typeof t?e=this.options[t]:0===arguments.length&&(e=this.options),e},r._setOptions=function(t){for(var e in t)this.options[e]=t[e]},r._applyOptions=function(t,e){var n=this.options,r=this.axes,i=n.gyroMode===Ft.VR,o=n.gyroMode===Ft.YAWPITCH,a=i?2&n.touchDirection:n.touchDirection;if(t.some((function(t){return"showPolePoint"===t||"fov"===t||"aspectRatio"===t||"yawRange"===t||"pitchRange"===t}))&&(t.indexOf("fov")>=0&&(r.setTo({fov:n.fov}),this.updatePanScale()),this._updateControlScale()),t.some((function(t){return"fovRange"===t}))){var s=n.fovRange,u=r.get().fov,h=r.get().fov;K(r.axis.fov.range,s),h<s[0]?h=s[0]:u>s[1]&&(h=s[1]),u!==h&&(r.setTo({fov:h},0),this._updateControlScale(),this.updatePanScale())}(t.some((function(t){return"gyroMode"===t}))&&at&&(i||o?(r.connect(["yaw","pitch"],this._deviceSensor),this._deviceSensor.enable().catch((function(){}))):(r.disconnect(this._deviceSensor),this._deviceSensor.disable()),this._deviceSensor.setGyroMode(n.gyroMode),i&&this.axesPanInput.setUseRotation(i)),t.some((function(t){return"useKeyboard"===t})))&&(n.useKeyboard?r.connect(["yaw","pitch"],this.axesMoveKeyInput):r.disconnect(this.axesMoveKeyInput));if(t.some((function(t){return"useZoom"===t}))){var c=n.useZoom;r.disconnect(this.axesWheelInput),c&&r.connect(["fov"],this.axesWheelInput)}this._togglePinchInputByOption(n.touchDirection,n.useZoom),t.some((function(t){return"touchDirection"===t}))&&this._enabled&&this._enableTouch(a)},r._togglePinchInputByOption=function(t,e){this.axesPinchInput&&(this.axes.disconnect(this.axesPinchInput),e&&t===Nt&&-1===this.axes._inputs.indexOf(this.axesPinchInput)&&this.axes.connect(["fov"],this.axesPinchInput))},r._enableTouch=function(t){this.axesPanInput&&this.axes.disconnect(this.axesPanInput);var e=2&t?"yaw":null,n=4&t?"pitch":null;this.axes.connect([e,n],this.axesPanInput)},r._getValidYawRange=function(t,e,r){var i=n.adjustAspectRatio(r||this.options.aspectRatio||1),o=(e||this.axes.get().fov)*i;return t[1]-t[0]>=o?t:this.options.yawRange||Gt},r._getValidPitchRange=function(t,e){var n=e||this.axes.get().fov;return t[1]-t[0]>=n?t:this.options.pitchRange||kt},n.isCircular=function(t){return t[1]-t[0]<360?[!1,!1]:[!0,!0]},r._updateControlScale=function(t){var e=this.options,r=this.axes.get().fov,i=this._updatePitchRange(e.pitchRange,r,e.showPolePoint),o=this._updateYawRange(e.yawRange,r,e.aspectRatio),a=this.axes.get(),s=a.yaw,u=a.pitch;return K(this.axes.axis.yaw.range,o),K(this.axes.axis.pitch.range,i),this.axes.axis.yaw.circular=n.isCircular(o),this.axes.axis.pitch.circular=n.isCircular(i),s<o[0]?s=o[0]:s>o[1]&&(s=o[1]),u<i[0]?u=i[0]:u>i[1]&&(u=i[1]),t&&t.set({yaw:s,pitch:u}),this.axes.setTo({yaw:s,pitch:u},0),this},r._updatePitchRange=function(t,e,n){if(this.options.gyroMode===Ft.VR)return jt;var r=t[1]-t[0],i=e/2;return n&&!(r<180)?t.concat():[t[0]+i,t[1]-i]},r._updateYawRange=function(t,e,n){if(this.options.gyroMode===Ft.VR)return Gt;if(t[1]-t[0]>=360)return t.concat();var r=ft.toDegree(Math.atan2(n,1/Math.tan(l(e/2))));return[t[0]+r,t[1]-r]},r._triggerChange=function(t){var e=this.axes.get(),n=this.options,r={targetElement:n.element,isTrusted:t.isTrusted};r.yaw=e.yaw,r.pitch=e.pitch,r.fov=e.fov,n.gyroMode===Ft.VR&&(r.quaternion=this._deviceSensor.getCombinedQuaternion(e.yaw)),this.trigger("change",r)},n.adjustAspectRatio=function(t){for(var e=[.52,.54,.563,.57,.584,.59,.609,.67,.702,.72,.76,.78,.82,.92,.97,1,1.07,1.14,1.19,1.25,1.32,1.38,1.4,1.43,1.53,1.62,1.76,1.77,1.86,1.96,2.26,2.3,2.6,3,5,6],r=[.51,.54,.606,.56,.628,.63,.647,.71,.736,.757,.78,.77,.8,.89,.975,1,1.07,1.1,1.15,1.18,1.22,1.27,1.3,1.33,1.39,1.45,1.54,1.55,1.58,1.62,1.72,1.82,1.92,2,2.24,2.3],i=-1,o=0;o<e.length-1;o++)if(e[o]<=t&&e[o+1]>=t){i=o;break}if(-1===i)return e[0]>t?r[0]:r[r[0].length-1];var a=e[i],s=e[i+1],u=r[i],h=r[i+1];return n.lerp(u,h,(t-a)/(s-a))},n.lerp=function(t,e,n){return t+n*(e-t)},r.enable=function(){return this._enabled?this:(this._enabled=!0,this._applyOptions(Object.keys(this.options),this.options),this.updatePanScale(),this.enableSensor().catch((function(){})),this)},r.disable=function(t){return this._enabled?(t||this._resetOrientation(),this.axes.disconnect(),this.disableSensor(),this._enabled=!1,this):this},r._resetOrientation=function(){var t=this.options;return this.axes.setTo({yaw:t.yaw,pitch:t.pitch,fov:t.fov},0),this},r.lookAt=function(t,e){var n=t.yaw,r=t.pitch,i=t.fov,o=this.axes.get(),a=void 0===n?0:n-o.yaw,s=void 0===r?0:r-o.pitch,u=void 0===i?0:i-o.fov;this.axes.options.maximumDuration=1/0,this.axes.setBy({yaw:a,pitch:s,fov:u},e)},r.enableSensor=function(){var t=this;return new Ht((function(e,n){var r=function(){t.options.gyroMode!==Ft.NONE?(t._deviceSensor.enable(),e()):n(new Error("gyroMode not set"))};DeviceMotionEvent&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceMotionEvent.requestPermission().then((function(t){"granted"===t?r():n(new Error("denied"))})).catch((function(t){n(t)})):r()}))},r.disableSensor=function(){this._deviceSensor.disable()},r.getYawPitch=function(){var t=this.axes.get();return{yaw:t.yaw,pitch:t.pitch}},r.getFov=function(){return this.axes.get().fov},r.getQuaternion=function(){var t=this.axes.get();return this._deviceSensor.getCombinedQuaternion(t.yaw)},r.shouldRenderWithQuaternion=function(){return this.options.gyroMode===Ft.VR},r.destroy=function(){this.axes&&this.axes.destroy(),this.axisPanInput&&this.axisPanInput.destroy(),this.axesWheelInput&&this.axesWheelInput.destroy(),this.axesDeviceOrientationInput&&this.axesDeviceOrientationInput.destroy(),this.axesPinchInput&&this.axesPinchInput.destroy(),this.axesMoveKeyInput&&this.axesMoveKeyInput.destroy(),this._deviceSensor&&this._deviceSensor.destroy()},n}(n);return t.VERSION="3.3.0",t.CONTROL_MODE_VR=1,t.CONTROL_MODE_YAWPITCH=2,t.TOUCH_DIRECTION_ALL=Nt,t.TOUCH_DIRECTION_YAW=2,t.TOUCH_DIRECTION_PITCH=4,t.TOUCH_DIRECTION_NONE=1,t}(),zt="undefined"==typeof Promise?h.Promise:Promise,Qt={NONE:0,LOADING:1,LOADED:2,ERROR:3},Kt="readystatechange",Zt=function(){var t=function(t){function e(e){var n;return(n=t.call(this)||this)._image=null,n._onceHandlers=[],n._loadStatus=Qt.NONE,e&&n.set(e),n}a(e,t);var n=e.prototype;return n.get=function(){var t=this;return new zt((function(n,r){t._image?t._loadStatus===Qt.LOADED?n(t.getElement()):t._loadStatus===Qt.LOADING?e.isMaybeLoaded(t._image)?(t._loadStatus=Qt.LOADED,n(t.getElement())):t.on(Kt,(function(e){e.type===Qt.LOADED?n(t.getElement()):r("ImageLoader: failed to load images.")})):r("ImageLoader: failed to load images"):r("ImageLoader: image is not defiend")}))},n.set=function(t){var n=this;this._loadStatus=Qt.LOADING,this._image=e.createElement(t),e.isMaybeLoaded(this._image)?this._loadStatus=Qt.LOADED:this.onceLoaded(this._image,(function(){n._loadStatus=Qt.LOADED,n.trigger(Kt,{type:Qt.LOADED})}),(function(){n._loadStatus=Qt.ERROR,n.trigger(Kt,{type:Qt.ERROR})}))},e.createElement=function(t){return(t instanceof Array?t:[t]).map((function(t){var e=t;return"string"==typeof t&&((e=new Image).crossOrigin="anonymous",e.src=t),e}))},n.getElement=function(){return 1===this._image.length?this._image[0]:this._image},e.isMaybeLoaded=function(t){var e=!1;return t instanceof Image?e=t.complete&&0!==t.naturalWidth:t instanceof Array&&(e=!t.some((function(t){return!t.complete||0===t.naturalWidth}))),e},n.onceLoaded=function(t,n,r){var i=this,o=t instanceof Array?t:[t],a=o.filter((function(t){return!e.isMaybeLoaded(t)})).map((function(t){return new zt((function(e,n){i._once(t,"load",(function(){return e(t)})),i._once(t,"error",(function(){return n(t)}))}))}));zt.all(a).then((function(t){return n(1===o.length?o[0]:o)}),(function(t){return r(t)}))},n._once=function(t,e,n){var r=function r(i){t.removeEventListener(e,r),n(i)};t.addEventListener(e,r),this._onceHandlers.push({target:t,type:e,fn:r})},n.getStatus=function(){return this._loadStatus},n.destroy=function(){this._onceHandlers.forEach((function(t){t.target.removeEventListener(t.type,t.fn)})),this._onceHandlers=[],this._image.src="",this._image=null,this._loadStatus=Qt.NONE},e}(n);return t.STATUS=Qt,t}(),Jt="undefined"==typeof Promise?h.Promise:Promise,$t={HAVE_NOTHING:0,HAVE_METADATA:1,HAVE_CURRENT_DATA:2,HAVE_FUTURE_DATA:3,HAVE_ENOUGH_DATA:4,LOADING_FAILED:-1},te={};te[$t.HAVE_METADATA]="loadedmetadata",te[$t.HAVE_CURRENT_DATA]="loadeddata",te[$t.HAVE_FUTURE_DATA]="canplay",te[$t.HAVE_ENOUGH_DATA]="canplaythrough";var ee=function(){function t(t){this._handlers=[],this._sourceCount=0,this._thresholdReadyState=$t.HAVE_METADATA,this._thresholdEventName=te[this._thresholdReadyState],this._loadStatus=t&&t.readyState||$t.HAVE_NOTHING,this._onerror=this._onerror.bind(this),t&&this.set(t)}var e=t.prototype;return e._onerror=function(){this._errorCount++,this._errorCount>=this._sourceCount&&(this._loadStatus=$t.LOADING_FAILED,this._detachErrorHandler(this._onerror))},e._appendSourceElement=function(t){var e,n;if("object"==typeof t?(e=t.src,n=t.type):"string"==typeof t&&(e=t),!e)return!1;var r=document.createElement("source");return r.src=e,n&&(r.type=n),this._video.appendChild(r),!0},e.set=function(t){var e=this;this._reset(),t&&(t instanceof HTMLVideoElement?this._video=t:"string"!=typeof t&&"object"!=typeof t||(this._video=document.createElement("video"),this._video.setAttribute("crossorigin","anonymous"),this._video.setAttribute("webkit-playsinline",""),this._video.setAttribute("playsinline",""),t instanceof Array?t.forEach((function(t){return e._appendSourceElement(t)})):this._appendSourceElement(t),this._sourceCount=this._video.querySelectorAll("source").length,this._sourceCount>0?this._video.readyState<this._thresholdReadyState&&(this._video.load(),this._attachErrorHandler(this._onerror)):this._video=null))},e._attachErrorHandler=function(t){this._video.addEventListener("error",t),this._sources=this._video.querySelectorAll("source"),[].forEach.call(this._sources,(function(e){e.addEventListener("error",t)}))},e._detachErrorHandler=function(t){this._video.removeEventListener("error",t),[].forEach.call(this._sources,(function(e){e.removeEventListener("error",t)}))},e.get=function(){var t=this;return new Jt((function(e,n){if(t._video)if(t._loadStatus===$t.LOADING_FAILED)n("VideoLoader: video source is invalid");else if(t._video.readyState>=t._thresholdReadyState)e(t._video);else{t._attachErrorHandler((function e(){t._loadStatus===$t.LOADING_FAILED&&(t._detachErrorHandler(e),n("VideoLoader: video source is invalid"))})),t._once(t._thresholdEventName,(function(){return e(t._video)}))}else n("VideoLoader: video is undefined")}))},e.getElement=function(){return this._video},e.destroy=function(){this._reset()},e._reset=function(){var t=this;this._handlers.forEach((function(e){t._video.removeEventListener(e.type,e.fn)})),this._handlers=[],this._video=null,this._sourceCount=0,this._errorCount=0},e._once=function(t,e){var n=this._video,r=function r(i){n.removeEventListener(t,r),e(i)};n.addEventListener(t,r,!0),this._handlers.push({type:t,fn:r})},t}(),ne="undefined"!=typeof window&&window||{},re=(ne.RegExp,ne.navigator),ie={browser:[{criteria:"PhantomJS",identity:"PhantomJS"},{criteria:/Whale/,identity:"Whale",versionSearch:"Whale"},{criteria:/Edge/,identity:"Edge",versionSearch:"Edge"},{criteria:/MSIE|Trident|Windows Phone/,identity:"IE",versionSearch:"IEMobile|MSIE|rv"},{criteria:/MiuiBrowser/,identity:"MIUI Browser",versionSearch:"MiuiBrowser"},{criteria:/SamsungBrowser/,identity:"Samsung Internet",versionSearch:"SamsungBrowser"},{criteria:/SAMSUNG /,identity:"Samsung Internet",versionSearch:"Version"},{criteria:/Chrome|CriOS/,identity:"Chrome"},{criteria:/Android/,identity:"Android Browser",versionSearch:"Version"},{criteria:/iPhone|iPad/,identity:"Safari",versionSearch:"Version"},{criteria:"Apple",identity:"Safari",versionSearch:"Version"},{criteria:"Firefox",identity:"Firefox"}],os:[{criteria:/Windows Phone/,identity:"Windows Phone",versionSearch:"Windows Phone"},{criteria:"Windows 2000",identity:"Window",versionAlias:"5.0"},{criteria:/Windows NT/,identity:"Window",versionSearch:"Windows NT"},{criteria:/iPhone|iPad/,identity:"iOS",versionSearch:"iPhone OS|CPU OS"},{criteria:"Mac",versionSearch:"OS X",identity:"MAC"},{criteria:/Android/,identity:"Android"},{criteria:/Tizen/,identity:"Tizen"},{criteria:/Web0S/,identity:"WebOS"}],webview:[{criteria:/iPhone|iPad/,browserVersionSearch:"Version",webviewBrowserVersion:/-1/},{criteria:/iPhone|iPad|Android/,webviewToken:/NAVER|DAUM|; wv/}],defaultString:{browser:{version:"-1",name:"unknown"},os:{version:"-1",name:"unknown"}}};function oe(t,e){for(var n=[],r=0;r<t.length;r++)e(t[r])&&n.push(t[r]);return n}var ae=void 0;function se(t,e){return e&&e.test?!!e.test(t):t.indexOf(e)>-1}function ue(t,e){var n=oe(t,(function(t){return se(ae,t.criteria)}))[0];return n&&n.identity||e.name}function he(t,e){return oe(t,(function(t){var n=t.criteria,r=new RegExp(t.identity,"i").test(e);return!!(n?r&&se(ae,n):r)}))[0]}function ce(t,e){var n=ie.defaultString.browser.version,r=new RegExp("("+t+")","i").exec(e);if(!r)return n;var i=r.index,o=r[0];if(i>-1){var a=i+o.length+1;n=e.substring(a).split(" ")[0].replace(/_/g,".").replace(/;|\)/g,"")}return n}function de(t){if(t)return ce(function(t){var e=he(ie.browser,t);return e||(e={criteria:t,versionSearch:t,identity:t}),e}(t).versionSearch||t,ae)}function fe(t){var e=function(t){return he(ie.os,t)}(t)||{},n=ie.defaultString.os.version,r=void 0;if(t){if(e.versionAlias)return e.versionAlias;var i=e.versionSearch||t,o=new RegExp("("+i+")\\s([\\d_\\.]+|\\d_0)","i");return o.exec(ae)&&(r=o.exec(ae)[2].replace(/_/g,".").replace(/;|\)/g,"")),r||n}}function le(){var t=ue(ie.os,ie.defaultString.os);return{name:t,version:fe(t)}}function _e(){var t,e,n=ue(ie.browser,ie.defaultString.browser);return{name:n,version:de(n),webview:(t=ie.webview,e=void 0,function(t,e){for(var n=0;n<t.length;n++)if(e(t[n]))return!0;return!1}(oe(t,(function(t){return se(ae,t.criteria)})),(function(t){return e=ce(t.browserVersionSearch,ae),!(!se(ae,t.webviewToken)&&!se(e,t.webviewBrowserVersion))})))}}function ve(){!function(t){ae=t}(arguments.length>0&&void 0!==arguments[0]?arguments[0]:re.userAgent);var t={os:le(),browser:_e(),isMobile:-1!==ae.indexOf("Mobi")};return t.browser.name=t.browser.name.toLowerCase(),t.os.name=t.os.name.toLowerCase(),t.os.version=t.os.version.toLowerCase(),"ios"===t.os.name&&t.browser.webview&&(t.browser.version="-1"),t}ve.VERSION="2.1.5";var ge,pe,me={0:"NO_ERROR",1280:"INVALID_ENUM",1281:"INVALID_VALUE",1282:"INVALID_OPERATION",1285:"OUT_OF_MEMORY",1286:"INVALID_FRAMEBUFFER_OPERATION",37442:"CONTEXT_LOST_WEBGL"},Ee=null,ye=function(){function t(){}return t.createShader=function(t,e,n){var r=t.createShader(e);return t.shaderSource(r,n),t.compileShader(r),t.getShaderParameter(r,t.COMPILE_STATUS)?r:(console.error(t.getShaderInfoLog(r)),null)},t.createProgram=function(t,e,n){var r=t.createProgram();return t.attachShader(r,e),t.attachShader(r,n),t.linkProgram(r),t.detachShader(r,e),t.detachShader(r,n),t.deleteShader(e),t.deleteShader(n),t.getProgramParameter(r,t.LINK_STATUS)?r:(t.deleteProgram(r),null)},t.initBuffer=function(t,e,n,r,i){var o=t.createBuffer();return t.bindBuffer(e,o),t.bufferData(e,n,t.STATIC_DRAW),o&&(o.itemSize=r,o.numItems=n.length/r),void 0!==i&&(t.enableVertexAttribArray(i),t.vertexAttribPointer(i,o.itemSize,t.FLOAT,!1,0,0)),o},t.getWebglContext=function(t,e){var n=["webgl","experimental-webgl","webkit-3d","moz-webgl"],r=null,i=o({preserveDrawingBuffer:!1,antialias:!1,xrCompatible:!0},e);function a(t){return t.statusMessage}t.addEventListener("webglcontextcreationerror",a);for(var s=0;s<n.length;s++){try{r=t.getContext(n[s],i)}catch(t){}if(r)break}return t.removeEventListener("webglcontextcreationerror",a),r},t.createTexture=function(t,e){var n=t.createTexture();return t.bindTexture(e,n),t.texParameteri(e,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(e,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(e,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(e,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.bindTexture(e,null),n},t.isWebGLAvailable=function(){if(null===Ee){var e=document.createElement("canvas"),n=t.getWebglContext(e);if(Ee=!!n,n){var r=n.getExtension("WEBGL_lose_context");r&&r.loseContext()}}return Ee},t.isStableWebGL=function(){var t=ve(),e=!0;return"android"===t.os.name&&parseFloat(t.os.version)<=4.3?e=!1:"android"===t.os.name&&4.4===parseFloat(t.os.version)&&"chrome"!==t.browser.name&&(e=!1),e},t.getErrorNameFromWebGLErrorCode=function(t){return t in me?me[t]:"UNKNOWN_ERROR"},t.texImage2D=function(t,e,n){try{t.texImage2D(e,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n)}catch(t){console.error("WebGLUtils.texImage2D error:",t)}},t.getMaxTextureSize=function(t){return t.getParameter(t.MAX_TEXTURE_SIZE)},t}(),we=ve(),xe="ie"===we.browser.name&&"11.0"===we.browser.version,Te={ERROR:"error"},Re=function(){var t=function(t){function e(){var e;return(e=t.call(this)||this)._forceDimension=null,e._pixelCanvas=null,e._pixelContext=null,e}a(e,t);var n=e.prototype;return n.render=function(t){var e=t.gl,n=t.shaderProgram,r=t.indexBuffer,i=t.mvMatrix,o=t.pMatrix;e.uniformMatrix4fv(n.pMatrixUniform,!1,o),e.uniformMatrix4fv(n.mvMatrixUniform,!1,i),r&&e.drawElements(e.TRIANGLES,r.numItems,e.UNSIGNED_SHORT,0)},n.getDimension=function(t){return{width:t.naturalWidth||t.videoWidth,height:t.naturalHeight||t.videoHeight}},n.updateShaderData=function(t){},n._initPixelSource=function(t,e){if(xe&&t instanceof HTMLVideoElement||e){var n=e||this.getDimension(t),r=n.width,i=n.height;this._pixelCanvas=document.createElement("canvas"),this._pixelCanvas.width=r,this._pixelCanvas.height=i,this._pixelContext=this._pixelCanvas.getContext("2d")}this._forceDimension=e},n._getPixelSource=function(t){if(!this._pixelCanvas)return t;var e=this.getDimension(t),n=this._forceDimension||e;return this._pixelCanvas.width!==n.width&&(this._pixelCanvas.width=n.width),this._pixelCanvas.height!==n.height&&(this._pixelCanvas.height=n.height),this._forceDimension?this._pixelContext.drawImage(t,0,0,e.width,e.height,0,0,n.width,n.height):this._pixelContext.drawImage(t,0,0),this._pixelCanvas},n._extractTileConfig=function(t){var e=Array.isArray(t.tileConfig)?t.tileConfig:Array.apply(void 0,Array(6)).map((function(){return t.tileConfig}));return e=e.map((function(t){return o({flipHorizontal:!1,rotation:0},t)}))},n._triggerError=function(t){console.error("Renderer Error:",t),this.trigger(Te.ERROR,{message:"string"==typeof t?t:t.message})},e}(n);return t.EVENTS=Te,t}(),Ae=function(){var t=function(t){function e(){return t.apply(this,arguments)||this}a(e,t);var n=e.prototype;return n.getVertexPositionData=function(){return e._VERTEX_POSITION_DATA=null!==e._VERTEX_POSITION_DATA?e._VERTEX_POSITION_DATA:[1,-1,1,-1,-1,1,-1,1,1,1,1,1,-1,-1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,1,-1,1,1,-1,1,1,1,-1,1,1,1,-1,-1,-1,-1,-1,-1,-1,1,1,-1,1,1,-1,-1,1,-1,1,1,1,1,1,1,-1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1],e._VERTEX_POSITION_DATA},n.getIndexData=function(){if(e._INDEX_DATA)return e._INDEX_DATA;for(var t=[],n=this.getVertexPositionData(),r=0;r<n.length/3;r+=4)t.push(r,r+2,r+1,r,r+3,r+2);return e._INDEX_DATA=t,t},e.extractOrder=function(t){return t.order||"RLUDBF"},n.getTextureCoordData=function(t){var n=e.extractOrder(t),r=this.getVertexPositionData(),i=this._extractTileConfig(t);return"BFUDRL".split("").map((function(t){return i[n.indexOf(t)]})).map((function(t,e){for(var n=parseInt(t.rotation/90,10),i=t.flipHorizontal?[0,1,2,3]:[1,0,3,2],o=0;o<Math.abs(n);o++)t.flipHorizontal&&n>0||!t.flipHorizontal&&n<0?i.push(i.shift()):i.unshift(i.pop());for(var a=r.slice(12*e,12*e+12),s=[],u=0;u<4;u++)s[i[u]]=a.splice(0,3);return s})).join().split(",").map((function(t){return parseInt(t,10)}))},n.getVertexShaderSource=function(){return"\nattribute vec3 aVertexPosition;\nattribute vec3 aTextureCoord;\nuniform mat4 uMVMatrix;\nuniform mat4 uPMatrix;\nvarying highp vec3 vVertexDirectionVector;\nvoid main(void) {\n\tvVertexDirectionVector = aTextureCoord;\n\tgl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\n}"},n.getFragmentShaderSource=function(){return"\nprecision highp float;\nuniform samplerCube uSampler;\nvarying highp vec3 vVertexDirectionVector;\nvoid main(void) {\n\tgl_FragColor = textureCube(uSampler, vVertexDirectionVector);\n}"},n.updateTexture=function(t,n,r){var i=e.extractOrder(r),o={};i.split("").forEach((function(t,e){o[t]=e}));try{if(n instanceof Array)for(var a=0;a<6;a++){var s=o["RLUDBF"[a]];ye.texImage2D(t,t.TEXTURE_CUBE_MAP_POSITIVE_X+a,n[s])}else for(var u=this.getMaxCubeMapTextureSize(t,n),h=0;h<6;h++){var c=o["RLUDBF"[h]],d=this.extractTileFromImage(n,c,u);ye.texImage2D(t,t.TEXTURE_CUBE_MAP_POSITIVE_X+h,d)}}catch(t){this._triggerError(t)}},n.bindTexture=function(t,e,n,r){t.bindTexture(t.TEXTURE_CUBE_MAP,e),this.updateTexture(t,n,r)},n.getSourceTileSize=function(t){var e=this.getDimension(t),n=e.width,r=e.height,i=n/r;return i===1/6?n:6===i?r:i===2/3?n/2:n/3},n.extractTileFromImage=function(t,e,n){var r=this.getDimension(t).width,i=this.getSourceTileSize(t),o=document.createElement("canvas");o.width=n,o.height=n;var a=o.getContext("2d"),s=r/i,u=i*e%(i*s),h=parseInt(e/s,10)*i;return a.drawImage(t,u,h,i,i,0,0,n,n),o},n.getMaxCubeMapTextureSize=function(t,e){var n=ve(),r=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),i=this.getSourceTileSize(e);if("ie"===n.browser.name&&11===parseInt(n.browser.version,10)&&!ft.isPowerOfTwo(i))for(var o=1;o<r;o*=2)if(!(o<i)){i=o;break}return"ios"===n.os.name&&9===parseInt(n.os.version,10)&&(i=1024),"ios"===n.os.name&&8===parseInt(n.os.version,10)&&(i=512),Math.min(r,i)},e}(Re);return t._VERTEX_POSITION_DATA=null,t._INDEX_DATA=null,t}(),Ce=function(t){function e(){return t.apply(this,arguments)||this}a(e,t);var n=e.prototype;return n.getVertexShaderSource=function(){return"\nattribute vec3 aVertexPosition;\nattribute vec2 aTextureCoord;\nuniform mat4 uMVMatrix;\nuniform mat4 uPMatrix;\nvarying highp vec2 vTextureCoord;\nvoid main(void) {\n\tvTextureCoord = aTextureCoord;\n\tgl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\n}"},n.getFragmentShaderSource=function(){return"\n#define PI 3.14159265359\nprecision highp float;\nvarying highp vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform bool uIsEAC;\nconst vec2 OPERATE_COORDS_RANGE = vec2(-1.0, 1.0);\nconst vec2 TEXTURE_COORDS_RANGE = vec2(0.0, 1.0);\n// vector type is used for initializing values instead of array.\nconst vec4 TEXTURE_DIVISION_X = vec4(0.0, 1.0 / 3.0, 2.0 / 3.0, 1.0);\nconst vec3 TEXTURE_DIVISION_Y = vec3(0.0, 1.0 / 2.0, 1.0);\nconst float EAC_CONST = 2.0 / PI;\nfloat scale(vec2 domainRange, vec2 targetRange, float val) {\n\tfloat unit = 1.0 / (domainRange[1] - domainRange[0]);\n\treturn targetRange[0] + (targetRange[1] - targetRange[0]) * (val - domainRange[0]) * unit;\n}\nvoid main(void) {\n\tfloat transformedCoordX;\n\tfloat transformedCoordY;\n\n\tif (uIsEAC) {\n\t\tvec2 orgTextureRangeX;\n\t\tvec2 orgTextureRangeY;\n\n\t\t// Apply EAC transform\n\t\tif (vTextureCoord.s >= TEXTURE_DIVISION_X[2]) {\n\t\t\torgTextureRangeX = vec2(TEXTURE_DIVISION_X[2], TEXTURE_DIVISION_X[3]);\n\t\t} else if (vTextureCoord.s >= TEXTURE_DIVISION_X[1]) {\n\t\t\torgTextureRangeX = vec2(TEXTURE_DIVISION_X[1], TEXTURE_DIVISION_X[2]);\n\t\t} else {\n\t\t\torgTextureRangeX = vec2(TEXTURE_DIVISION_X[0], TEXTURE_DIVISION_X[1]);\n\t\t}\n\n\t\tif (vTextureCoord.t >= TEXTURE_DIVISION_Y[1]) {\n\t\t\torgTextureRangeY = vec2(TEXTURE_DIVISION_Y[1], TEXTURE_DIVISION_Y[2]);\n\t\t} else {\n\t\t\torgTextureRangeY = vec2(TEXTURE_DIVISION_Y[0], TEXTURE_DIVISION_Y[1]);\n\t\t}\n\n\t\t// scaling coors by the coordinates following the range from -1.0 to 1.0.\n\t\tfloat px = scale(orgTextureRangeX, OPERATE_COORDS_RANGE, vTextureCoord.s);\n\t\tfloat py = scale(orgTextureRangeY, OPERATE_COORDS_RANGE, vTextureCoord.t);\n\n\t\tfloat qu = EAC_CONST * atan(px) + 0.5;\n\t\tfloat qv = EAC_CONST * atan(py) + 0.5;\n\n\t\t// re-scaling coors by original coordinates ranges\n\t\ttransformedCoordX = scale(TEXTURE_COORDS_RANGE, orgTextureRangeX, qu);\n\t\ttransformedCoordY = scale(TEXTURE_COORDS_RANGE, orgTextureRangeY, qv);\n\t} else {\n\t\t// normal cubemap\n\t\ttransformedCoordX = vTextureCoord.s;\n\t\ttransformedCoordY = vTextureCoord.t;\n\t}\n\n\tgl_FragColor = texture2D(uSampler, vec2(transformedCoordX, transformedCoordY));\n}"},n.getVertexPositionData=function(){return this._vertices||(this._vertices=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,-1,-1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,1,-1,1,1,-1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,-1,-1,-1,-1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,-1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1]),this._vertices},n.getIndexData=function(){var t=this;return function(){for(var e=[],n=0;n<t._vertices.length/3;n+=4)e.push(n,n+1,n+2,n,n+2,n+3);return e}()},n.getTextureCoordData=function(t){for(var e=this,n=t.order||"RLUDFB",r=[],i=1;i>=0;i--)for(var o=0;o<3;o++){var a=[o/3,i/2,(o+1)/3,i/2,(o+1)/3,(i+1)/2,o/3,(i+1)/2];r.push(a)}var s=this._extractTileConfig(t);return r=r.map((function(t){return e._shrinkCoord(t)})).map((function(t,n){return e._transformCoord(t,s[n])})),"BFUDRL".split("").map((function(t){return n.indexOf(t)})).map((function(t){return r[t]})).reduce((function(t,e){return t.concat(e)}),[])},n.updateTexture=function(t,e){ye.texImage2D(t,t.TEXTURE_2D,this._getPixelSource(e))},n.bindTexture=function(t,e,n){var r=this.getDimension(n),i=r.width,o=r.height,a=Math.max(i,o),s=ye.getMaxTextureSize(t);a>s?this._triggerError("Image width("+i+") exceeds device limit("+s+"))"):(this._initPixelSource(n),t.activeTexture(t.TEXTURE0),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.bindTexture(t.TEXTURE_2D,e),this.updateTexture(t,n))},n._transformCoord=function(t,e){var n=t.slice();return e.flipHorizontal&&(n=this._flipHorizontalCoord(n)),e.rotation&&(n=this._rotateCoord(n,e.rotation)),n},n._shrinkCoord=function(t){return[t[0]+0,t[1]+0,t[2]-0,t[3]+0,t[4]-0,t[5]-0,t[6]+0,t[7]-0]},n._rotateCoord=function(t,e){var n,r=parseInt(e/90,10)%4;if(0===r)return t;var i=[];return r>0?(n=t.splice(0,2*r),i=t.concat(n)):i=(n=t.splice(2*(4+r),2*-r)).concat(t),i},n._flipHorizontalCoord=function(t){return[t[2],t[3],t[0],t[1],t[6],t[7],t[4],t[5]]},e}(Re),be={INVALID_DEVICE:10,NO_WEBGL:11,FAIL_IMAGE_LOAD:12,FAIL_BIND_TEXTURE:13,INVALID_RESOURCE:14,RENDERING_CONTEXT_LOST:15},Ie={READY:"ready",VIEW_CHANGE:"viewChange",ANIMATION_END:"animationEnd",ERROR:"error"},Se={EQUIRECTANGULAR:"equirectangular",CUBEMAP:"cubemap",CUBESTRIP:"cubestrip",PANORAMA:"panorama",STEREOSCOPIC_EQUI:"stereoequi"},Oe={TOP_BOTTOM:"3dv",LEFT_RIGHT:"3dh",NONE:""},Pe=-.5*Math.PI,De=[],Me=[],Le=[];for(ge=0;ge<=60;ge++){var Ne=(ge/60-.5)*Math.PI,Ve=Math.sin(Ne),Fe=Math.cos(Ne);for(pe=0;pe<=60;pe++){var Ue=2*(pe/60-.5)*Math.PI+Pe,Be=Math.sin(Ue),We=Math.cos(Ue)*Fe,Xe=Ve,Ye=Be*Fe,He=pe/60,Ge=ge/60;if(De.push(He,Ge),Me.push(2*We,2*Xe,2*Ye),60!==pe&&60!==ge){var ke=61*ge+pe,je=ke+60+1;Le.push(ke,je,ke+1,je,je+1,ke+1)}}}var qe=function(){var t=function(t){function e(e){var n;return(n=t.call(this)||this)._stereoFormat=e,n}a(e,t);var n=e.prototype;return n.render=function(e){var n,r,i=e.gl,o=e.shaderProgram;switch(this._stereoFormat){case Oe.TOP_BOTTOM:n=[1,.5,0,0],r=[1,.5,0,.5];break;case Oe.LEFT_RIGHT:n=[.5,1,0,0],r=[.5,1,.5,0];break;default:n=[1,1,0,0],r=[1,1,0,0]}var a=i.getUniformLocation(o,"uTexScaleOffset");i.uniform4fv(a,[].concat(n,r)),t.prototype.render.call(this,e)},n.getVertexPositionData=function(){return e._VERTEX_POSITION_DATA},n.getIndexData=function(){return e._INDEX_DATA},n.getTextureCoordData=function(){return e._TEXTURE_COORD_DATA},n.getVertexShaderSource=function(){return"\nattribute vec3 aVertexPosition;\nattribute vec2 aTextureCoord;\nuniform mat4 uMVMatrix;\nuniform mat4 uPMatrix;\nuniform float uEye;\nuniform vec4 uTexScaleOffset[2];\nvarying highp vec2 vTextureCoord;\nvoid main(void) {\n\tvec4 scaleOffset = uTexScaleOffset[int(uEye)];\n\tvTextureCoord = aTextureCoord.xy * scaleOffset.xy + scaleOffset.zw;\n\tgl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\n}"},n.getFragmentShaderSource=function(){return"\nprecision highp float;\nvarying highp vec2 vTextureCoord;\nuniform sampler2D uSampler;\nvoid main(void) {\n\tgl_FragColor = texture2D(uSampler, vTextureCoord.st);\n}"},n.updateTexture=function(t,e){ye.texImage2D(t,t.TEXTURE_2D,this._getPixelSource(e))},n.bindTexture=function(t,e,n){var r=this.getDimension(n),i=r.width,o=r.height,a=Math.max(i,o),s=ye.getMaxTextureSize(t);a>s?this._triggerError("Image width("+i+") exceeds device limit("+s+"))"):(this._initPixelSource(n),t.activeTexture(t.TEXTURE0),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.bindTexture(t.TEXTURE_2D,e),this.updateTexture(t,n))},e}(Re);return t._VERTEX_POSITION_DATA=Me,t._TEXTURE_COORD_DATA=De,t._INDEX_DATA=Le,t}(),ze=[],Qe=[],Ke=[],Ze=function(){var t=function(t){function e(){return t.apply(this,arguments)||this}a(e,t);var n=e.prototype;return n.getVertexPositionData=function(){return e._VERTEX_POSITION_DATA},n.getIndexData=function(){return e._INDEX_DATA},n.getTextureCoordData=function(){return e._TEXTURE_COORD_DATA},n.getVertexShaderSource=function(){return"\nattribute vec3 aVertexPosition;\nattribute vec2 aTextureCoord;\nuniform mat4 uMVMatrix;\nuniform mat4 uPMatrix;\nvarying highp vec2 vTextureCoord;\nvoid main(void) {\n\tvTextureCoord = aTextureCoord;\n\tgl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\n}"},n.getFragmentShaderSource=function(){return"\nprecision highp float;\nvarying highp vec2 vTextureCoord;\nuniform sampler2D uSampler;\nvoid main(void) {\n\tgl_FragColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));\n}"},n.updateTexture=function(t,e){ye.texImage2D(t,t.TEXTURE_2D,this._getPixelSource(e))},n.bindTexture=function(t,e,n){var r,i=this.getDimension(n),o=i.width,a=i.height,s=Math.max(o,a),u=ye.getMaxTextureSize(t);s>u&&(this._triggerError("Image width("+o+") exceeds device texture limit("+u+"))"),r=o>a?{width:u,height:u*a/o}:{width:u*o/a,height:u}),this._initPixelSource(n,r),t.activeTexture(t.TEXTURE0),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.bindTexture(t.TEXTURE_2D,e),this.updateTexture(t,n)},n.updateShaderData=function(t){var e,n,r,i,o,a=t.imageAspectRatio,s=void 0===a?6:a;if(s<1?(i=!0,o=1/s):(i=!1,o=s),o>=6){var u=360/o;n=2*Math.PI,r=Math.tan(l(u/2))}else n=o,r=.5;ze.length=0,Qe.length=0,Ke.length=0;for(var h=[-r,r],c=Math.PI/2+(2*Math.PI-n)/2,d=0,f=h.length;d<f;d++)for(e=0;e<=60;e++){var _=c+e/60*n,v=Math.cos(_),g=h[d],p=Math.sin(_),m=void 0,E=void 0;if(i?(m=1-d,E=e/60):(m=e/60,E=d),ze.push(m,E),Qe.push(v,g,p),0===d&&e<60){var y=e,w=y+60+1;Ke.push(y,w,y+1,w,w+1,y+1)}}},e}(Re);return t._VERTEX_POSITION_DATA=Qe,t._TEXTURE_COORD_DATA=ze,t._INDEX_DATA=Ke,t}(),Je="undefined"==typeof Promise?h.Promise:Promise,$e=[0,0,.5,1],tn=[.5,0,.5,1],en="left",nn="right",rn=function(){return function(){function t(){var t=this;this.destroy=function(){var e=t._vrDisplay;t.removeEndCallback(t.destroy),e&&e.isPresenting&&e.exitPresent(),t._clear()},this._frameData=new window.VRFrameData,this._clear()}i(t,[{key:"context",get:function(){return this._vrDisplay}}]);var e=t.prototype;return e.canRender=function(){return Boolean(this._vrDisplay)},e.beforeRender=function(t){t.bindFramebuffer(t.FRAMEBUFFER,null)},e.afterRender=function(){this._vrDisplay.submitFrame()},e.getEyeParams=function(t){var e=this._vrDisplay,n=.5*t.drawingBufferWidth,r=t.drawingBufferHeight,i=this._frameData;e.getFrameData(i);var o=i.leftViewMatrix,a=i.rightViewMatrix;return E(o,o,this._yawOffset),E(a,a,this._yawOffset),[{viewport:[0,0,n,r],mvMatrix:o,pMatrix:i.leftProjectionMatrix},{viewport:[n,0,n,r],mvMatrix:a,pMatrix:i.rightProjectionMatrix}]},e.isPresenting=function(){return Boolean(this._vrDisplay&&this._vrDisplay.isPresenting)},e.addEndCallback=function(t){window.addEventListener("vrdisplaypresentchange",t)},e.removeEndCallback=function(t){window.removeEventListener("vrdisplaypresentchange",t)},e.requestPresent=function(t){var e=this;return new Je((function(n,r){navigator.getVRDisplays().then((function(i){var o=i.length&&i[0];o?o.capabilities.canPresent?o.requestPresent([{source:t}]).then((function(){var r=o.getEyeParameters(en),i=o.getEyeParameters(nn);t.width=2*Math.max(r.renderWidth,i.renderWidth),t.height=Math.max(r.renderHeight,i.renderHeight),e._setDisplay(o),n()})):r(new Error("Display lacking capability to present.")):r(new Error("No displays available."))}))}))},e.setYawOffset=function(t){this._yawOffset=t},e._setDisplay=function(t){this._vrDisplay=t;var e=t.getLayers();if(e.length){var n=e[0];this._leftBounds=n.leftBounds,this._rightBounds=n.rightBounds}this.addEndCallback(this.destroy)},e._clear=function(){this._vrDisplay=null,this._leftBounds=$e,this._rightBounds=tn,this._yawOffset=0},t}()}(),on=function(){return function(){function t(){var t=this;this.destroy=function(){var e=t._xrSession;t.removeEndCallback(t.destroy),e&&e.end().then((function(){}),(function(){})),t._clear()},this._clear()}i(t,[{key:"context",get:function(){return this._xrSession}}]);var e=t.prototype;return e.canRender=function(t){var e=t.getViewerPose(this._xrRefSpace);return Boolean(e)},e.beforeRender=function(t,e){var n=e.session.renderState.baseLayer;t.bindFramebuffer(t.FRAMEBUFFER,n.framebuffer)},e.afterRender=function(){},e.getEyeParams=function(t,e){var n=this,r=e.session,i=e.getViewerPose(this._xrRefSpace);if(!i)return null;var o=r.renderState.baseLayer;return i.views.map((function(t){var e=o.getViewport(t),r=t.transform.inverse.matrix;return nt&&m(r,r,l(180)),E(r,r,n._yawOffset),{viewport:[e.x,e.y,e.width,e.height],mvMatrix:r,pMatrix:t.projectionMatrix}}))},e.isPresenting=function(){return this._presenting},e.addEndCallback=function(t){var e=this._xrSession;e&&e.addEventListener("end",t)},e.removeEndCallback=function(t){var e=this._xrSession;e&&e.removeEventListener("end",t)},e.requestPresent=function(t,e){var n=this;return navigator.xr.requestSession("immersive-vr",{requiredFeatures:["local"]}).then((function(t){var r=new window.XRWebGLLayer(t,e);return t.updateRenderState({baseLayer:r}),t.requestReferenceSpace("local").then((function(e){n._setSession(t,r,e)}))}))},e.setYawOffset=function(t){this._yawOffset=t},e._setSession=function(t,e,n){this._xrSession=t,this._xrLayer=e,this._xrRefSpace=n,this._presenting=!0,this.addEndCallback(this.destroy)},e._clear=function(){this._xrSession=null,this._xrLayer=null,this._xrRefSpace=null,this._presenting=!1,this._yawOffset=0},t}()}(),an=function(){return function(){function t(){var t=this;this._onLoop=function(){t._callback.apply(t,arguments),t._rafId=t._context.requestAnimationFrame(t._onLoop)},this._onLoopNextTick=function(){var e=performance.now();t._callback.apply(t,arguments);var n=performance.now()-e;t._rafTimer>=0&&(clearTimeout(t._rafTimer),t._rafTimer=-1),n<16?t._rafId=t._context.requestAnimationFrame(t._onLoop):t._rafTimer=setTimeout(t._onLoop,0)},this._callback=null,this._context=window,this._rafId=-1,this._rafTimer=-1}var e=t.prototype;return e.setCallback=function(t){this._callback=t},e.setContext=function(t){this._context=t},e.start=function(){var t=this._context,e=this._callback;t&&e&&(this._rafId>=0||this._rafTimer>=0||(this._rafId=nt?t.requestAnimationFrame(this._onLoopNextTick):t.requestAnimationFrame(this._onLoop)))},e.stop=function(){this._rafId>=0&&this._context.cancelAnimationFrame(this._rafId),this._rafTimer>=0&&clearTimeout(this._rafTimer),this._rafId=-1,this._rafTimer=-1},t}()}(),sn="undefined"==typeof Promise?h.Promise:Promise,un=Se,hn=ut||1;hn>2&&(hn=2);var cn={BIND_TEXTURE:"bindTexture",IMAGE_LOADED:"imageLoaded",ERROR:"error",RENDERING_CONTEXT_LOST:"renderingContextLost",RENDERING_CONTEXT_RESTORE:"renderingContextRestore"},dn={INVALID_DEVICE:10,NO_WEBGL:11,FAIL_IMAGE_LOAD:12,RENDERER_ERROR:13},fn=function(){var t=function(t){function e(e,n,r,i,o,a){var u;return(u=t.call(this)||this)._renderStereo=function(t,e){var n=u._vr,r=u.context,i=r.getUniformLocation(u.shaderProgram,"uEye"),o=n.getEyeParams(r,e);if(o){n.beforeRender(r,e);for(var a=0,s=[0,1];a<s.length;a++){var h=s[a],c=o[h];u.mvMatrix=c.mvMatrix,u.pMatrix=c.pMatrix,r.viewport.apply(r,c.viewport),r.uniform1f(i,h),u._draw()}n.afterRender()}},u.exitVR=function(){var t=u._vr,e=u.context,n=u._animator;t&&(t.removeEndCallback(u.exitVR),t.destroy(),u._vr=null,et&&u._restoreStyle(),u.updateViewportDimensions(u.width,u.height),u._updateViewport(),e.bindFramebuffer(e.FRAMEBUFFER,null),u._shouldForceDraw=!0,n.stop(),n.setContext(window),n.setCallback(u._render.bind(s(u))),n.start())},u._onFirstVRFrame=function(t,e){var n=u._vr,r=u.context,i=u._animator;if(n.canRender(e)){var o=T(0,0,-1),a=n.getEyeParams(r,e)[0],s=v(_(),a.mvMatrix),h=v(_(),a.pMatrix),c=g(_(),s),d=g(_(),h),f=I(w(),o,d);I(f,f,c);var l=ft.yawOffsetBetween(f,T(0,0,1));0!==l&&(n.setYawOffset(l),i.setCallback(u._renderStereo))}},u.sphericalConfig=o,u.fieldOfView=o.fieldOfView,u.width=n,u.height=r,u._lastQuaternion=null,u._lastYaw=null,u._lastPitch=null,u._lastFieldOfView=null,u.pMatrix=p(),u.mvMatrix=p(),y(u.pMatrix,l(u.fieldOfView),n/r,.1,100),u.textureCoordBuffer=null,u.vertexBuffer=null,u.indexBuffer=null,u.canvas=u._initCanvas(n,r),u._setDefaultCanvasStyle(),u._wrapper=null,u._wrapperOrigStyle=null,u._renderingContextAttributes=a,u._image=null,u._imageConfig=null,u._imageIsReady=!1,u._shouldForceDraw=!1,u._keepUpdate=!1,u._onContentLoad=u._onContentLoad.bind(s(u)),u._onContentError=u._onContentError.bind(s(u)),u._animator=new an,u._vr=null,e&&u.setImage({image:e,imageType:o.imageType,isVideo:i,cubemapConfig:o.cubemapConfig}),u}a(e,t);var n=e.prototype;return n.setYawPitchControl=function(t){this._yawPitchControl=t},n.getContent=function(){return this._image},n.setImage=function(t){var e=t.image,n=t.imageType,r=t.isVideo,i=void 0!==r&&r,a=t.cubemapConfig;return this._imageIsReady=!1,this._isVideo=i,this._imageConfig=o({order:n===un.CUBEMAP?"RLUDBF":"RLUDFB",tileConfig:{flipHorizontal:!1,rotation:0}},a),this._setImageType(n),this._contentLoader&&this._contentLoader.destroy(),i?(this._contentLoader=new ee,this._keepUpdate=!0):(this._contentLoader=new Zt,this._keepUpdate=!1),this._contentLoader.set(e),this._image=this._contentLoader.getElement(),this._contentLoader.get().then(this._onContentLoad,this._onContentError).catch((function(t){return setTimeout((function(){throw t}))}))},n._setImageType=function(t){var e=this;if(t&&this._imageType!==t){switch(this._imageType=t,this._isCubeMap=t===un.CUBEMAP,this._renderer&&this._renderer.off(),t){case un.CUBEMAP:this._renderer=new Ae;break;case un.CUBESTRIP:this._renderer=new Ce;break;case un.PANORAMA:this._renderer=new Ze;break;case un.STEREOSCOPIC_EQUI:this._renderer=new qe(this.sphericalConfig.stereoFormat);break;default:this._renderer=new qe(Oe.NONE)}this._renderer.on(Re.EVENTS.ERROR,(function(t){e.trigger(cn.ERROR,{type:dn.RENDERER_ERROR,message:t.message})})),this._initWebGL()}},n._initCanvas=function(t,e){var n=document.createElement("canvas");return n.width=t,n.height=e,this._onWebglcontextlost=this._onWebglcontextlost.bind(this),this._onWebglcontextrestored=this._onWebglcontextrestored.bind(this),n.addEventListener("webglcontextlost",this._onWebglcontextlost),n.addEventListener("webglcontextrestored",this._onWebglcontextrestored),n},n._setDefaultCanvasStyle=function(){var t=this.canvas;t.style.bottom=0,t.style.left=0,t.style.right=0,t.style.top=0,t.style.margin="auto",t.style.maxHeight="100%",t.style.maxWidth="100%",t.style.outline="none",t.style.position="absolute"},n._onContentError=function(t){return this._imageIsReady=!1,this._image=null,this.trigger(cn.ERROR,{type:dn.FAIL_IMAGE_LOAD,message:"failed to load image"}),!1},n._triggerContentLoad=function(){this.trigger(cn.IMAGE_LOADED,{content:this._image,isVideo:this._isVideo,projectionType:this._imageType})},n._onContentLoad=function(t){return this._imageIsReady=!0,this._triggerContentLoad(),!0},n.isImageLoaded=function(){return!!this._image&&this._imageIsReady&&(!this._isVideo||this._image.readyState>=2)},n.bindTexture=function(){var t=this;return new sn((function(e,n){t._contentLoader?t._contentLoader.get().then((function(){t._bindTexture()}),n).then(e):n("ImageLoader is not initialized")}))},n.attachTo=function(t){this.detach(),t.appendChild(this.canvas),this._wrapper=t},n.forceContextLoss=function(){if(this.hasRenderingContext()){var t=this.context.getExtension("WEBGL_lose_context");t&&t.loseContext()}},n.detach=function(){this.canvas.parentElement&&this.canvas.parentElement.removeChild(this.canvas)},n.destroy=function(){this._contentLoader&&this._contentLoader.destroy(),this._animator.stop(),this.detach(),this.forceContextLoss(),this.off(),this.canvas.removeEventListener("webglcontextlost",this._onWebglcontextlost),this.canvas.removeEventListener("webglcontextrestored",this._onWebglcontextrestored)},n.hasRenderingContext=function(){return!(!this.context||this.context.isContextLost())&&!(this.context&&!this.context.getProgramParameter(this.shaderProgram,this.context.LINK_STATUS))},n._initShaderProgram=function(){var t=this.context;this.shaderProgram&&(t.deleteProgram(this.shaderProgram),this.shaderProgram=null);var e=this._renderer,n=e.getVertexShaderSource(),r=e.getFragmentShaderSource(),i=ye.createShader(t,t.VERTEX_SHADER,n),o=ye.createShader(t,t.FRAGMENT_SHADER,r),a=ye.createProgram(t,i,o);if(!a)throw new Error("Failed to intialize shaders: "+ye.getErrorNameFromWebGLErrorCode(t.getError()));t.useProgram(a),a.vertexPositionAttribute=t.getAttribLocation(a,"aVertexPosition"),t.enableVertexAttribArray(a.vertexPositionAttribute),a.pMatrixUniform=t.getUniformLocation(a,"uPMatrix"),a.mvMatrixUniform=t.getUniformLocation(a,"uMVMatrix"),a.samplerUniform=t.getUniformLocation(a,"uSampler"),a.textureCoordAttribute=t.getAttribLocation(a,"aTextureCoord"),t.enableVertexAttribArray(a.textureCoordAttribute),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT|t.STENCIL_BUFFER_BIT),t.uniform1i(a.samplerUniform,0),this.shaderProgram=a},n._onWebglcontextlost=function(t){t.preventDefault(),this.trigger(cn.RENDERING_CONTEXT_LOST)},n._onWebglcontextrestored=function(t){this._initWebGL(),this.trigger(cn.RENDERING_CONTEXT_RESTORE)},n.updateFieldOfView=function(t){this.fieldOfView=t,this._updateViewport()},n.updateViewportDimensions=function(t,e){var n=!1;this.width=t,this.height=e;var r=t*hn,i=e*hn;r!==this.canvas.width&&(this.canvas.width=r,n=!0),i!==this.canvas.height&&(this.canvas.height=i,n=!0),n&&(this._updateViewport(),this._shouldForceDraw=!0)},n._updateViewport=function(){y(this.pMatrix,l(this.fieldOfView),this.canvas.width/this.canvas.height,.1,100),this.context.viewport(0,0,this.context.drawingBufferWidth,this.context.drawingBufferHeight)},n._initWebGL=function(){var t;try{this._initRenderingContext(),t=this.context,this.updateViewportDimensions(this.width,this.height),this._initShaderProgram()}catch(t){return this.trigger(cn.ERROR,{type:dn.NO_WEBGL,message:"no webgl support"}),this.destroy(),void console.error(t)}t.clearColor(0,0,0,0);var e=this._isCubeMap?t.TEXTURE_CUBE_MAP:t.TEXTURE_2D;this.texture&&t.deleteTexture(this.texture),this.texture=ye.createTexture(t,e),this._imageType===un.CUBESTRIP&&t.enable(t.CULL_FACE)},n._initRenderingContext=function(){if(!this.hasRenderingContext()){if(!window.WebGLRenderingContext)throw new Error("WebGLRenderingContext not available.");if(this.context=ye.getWebglContext(this.canvas,this._renderingContextAttributes),!this.context)throw new Error("Failed to acquire 3D rendering context")}},n._initBuffers=function(){var t=this._renderer.getVertexPositionData(),e=this._renderer.getIndexData(),n=this._renderer.getTextureCoordData(this._imageConfig),r=this.context;this.vertexBuffer=ye.initBuffer(r,r.ARRAY_BUFFER,new Float32Array(t),3,this.shaderProgram.vertexPositionAttribute),this.indexBuffer=ye.initBuffer(r,r.ELEMENT_ARRAY_BUFFER,new Uint16Array(e),1),this.textureCoordBuffer=ye.initBuffer(r,r.ARRAY_BUFFER,new Float32Array(n),this._isCubeMap?3:2,this.shaderProgram.textureCoordAttribute)},n._bindTexture=function(){if(this._imageType===un.CUBESTRIP){var t=this._renderer.getDimension(this._image),e=t.width,n=t.height,r=e&&n&&e/n!=1.5;this.context.uniform1f(this.context.getUniformLocation(this.shaderProgram,"uIsEAC"),r)}else if(this._imageType===un.PANORAMA){var i=this._renderer.getDimension(this._image),o=i.width,a=i.height,s=o&&a&&o/a;this._renderer.updateShaderData({imageAspectRatio:s})}this._initBuffers(),this._renderer.bindTexture(this.context,this.texture,this._image,this._imageConfig),this._shouldForceDraw=!0,this.trigger(cn.BIND_TEXTURE)},n._updateTexture=function(){this._renderer.updateTexture(this.context,this._image,this._imageConfig)},n.keepUpdate=function(t){t&&!1===this.isImageLoaded()&&(this._shouldForceDraw=!0),this._keepUpdate=t},n.startRender=function(){this._animator.setCallback(this._render.bind(this)),this._animator.start()},n.stopRender=function(){this._animator.stop()},n.renderWithQuaternion=function(t,e){this.isImageLoaded()&&(!1===this._keepUpdate&&this._lastQuaternion&&z(this._lastQuaternion,t)&&this.fieldOfView&&this.fieldOfView===e&&!1===this._shouldForceDraw||(void 0!==e&&e!==this.fieldOfView&&this.updateFieldOfView(e),this.mvMatrix=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n+n,s=r+r,u=i+i,h=n*a,c=r*a,d=r*s,f=i*a,l=i*s,_=i*u,v=o*a,g=o*s,p=o*u;return t[0]=1-d-_,t[1]=c+p,t[2]=f-g,t[3]=0,t[4]=c-p,t[5]=1-h-_,t[6]=l+v,t[7]=0,t[8]=f+g,t[9]=l-v,t[10]=1-h-d,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}(p(),t),this._draw(),this._lastQuaternion=G(t),this._shouldForceDraw&&(this._shouldForceDraw=!1)))},n.renderWithYawPitch=function(t,e,n){var r;this.isImageLoaded()&&(!1===this._keepUpdate&&null!==this._lastYaw&&this._lastYaw===t&&null!==this._lastPitch&&this._lastPitch===e&&this.fieldOfView&&this.fieldOfView===n&&!1===this._shouldForceDraw||(void 0!==n&&n!==this.fieldOfView&&this.updateFieldOfView(n),(r=this.mvMatrix)[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,m(this.mvMatrix,this.mvMatrix,-l(e)),E(this.mvMatrix,this.mvMatrix,-l(t)),this._draw(),this._lastYaw=t,this._lastPitch=e,this._shouldForceDraw&&(this._shouldForceDraw=!1)))},n._render=function(){var t=this._yawPitchControl,e=t.getFov();if(t.shouldRenderWithQuaternion()){var n=t.getQuaternion();this.renderWithQuaternion(n,e)}else{var r=t.getYawPitch();this.renderWithYawPitch(r.yaw,r.pitch,e)}},n._draw=function(){this._isVideo&&this._keepUpdate&&this._updateTexture();var t=this.context,e=this.shaderProgram,n=this.vertexBuffer,r=this.textureCoordBuffer;t.bindBuffer(t.ARRAY_BUFFER,n),t.enableVertexAttribArray(e.vertexPositionAttribute),t.vertexAttribPointer(e.vertexPositionAttribute,n.itemSize,t.FLOAT,!1,0,0),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bindBuffer(t.ARRAY_BUFFER,r),t.enableVertexAttribArray(e.textureCoordAttribute),t.vertexAttribPointer(e.textureCoordAttribute,r.itemSize,t.FLOAT,!1,0,0),this._renderer.render({gl:this.context,shaderProgram:this.shaderProgram,indexBuffer:this.indexBuffer,mvMatrix:this.mvMatrix,pMatrix:this.pMatrix})},n.getProjectionRenderer=function(){return this._renderer},n.enterVR=function(){var t=this._vr;return ht||navigator.getVRDisplays?t&&t.isPresenting()?sn.resolve("VR already enabled."):this._requestPresent():sn.reject("VR is not available on this browser.")},n._requestPresent=function(){var t=this,e=this.context,n=this.canvas,r=this._animator;this._vr=ht?new on:new rn;var i=this._vr;return r.stop(),new sn((function(o,a){i.requestPresent(n,e).then((function(){i.addEndCallback(t.exitVR),r.setContext(i.context),r.setCallback(t._onFirstVRFrame),et&&t._setWrapperFullscreen(),t._shouldForceDraw=!0,r.start(),o("success")})).catch((function(e){i.destroy(),t._vr=null,r.start(),a(e)}))}))},n._setWrapperFullscreen=function(){var t=this._wrapper;if(t){this._wrapperOrigStyle=t.getAttribute("style");var e=t.style;e.width="100vw",e.height="100vh",e.position="fixed",e.left="0",e.top="0",e.zIndex="9999"}},n._restoreStyle=function(){var t=this._wrapper,e=this.canvas;t&&(this._wrapperOrigStyle?t.setAttribute("style",this._wrapperOrigStyle):t.removeAttribute("style"),this._wrapperOrigStyle=null,e.removeAttribute("style"),this._setDefaultCanvasStyle())},e}(n);return t.EVENTS=cn,t.ERROR_TYPE=dn,t}(),ln="undefined"==typeof Promise?h.Promise:Promise,_n=function(){var t=function(t){function e(n,r){var i;if(void 0===r&&(r={}),i=t.call(this)||this,!ye.isWebGLAvailable())return setTimeout((function(){i.trigger(Ie.ERROR,{type:be.NO_WEBGL,message:"no webgl support"})}),0),s(i)||s(i);if(!ye.isStableWebGL())return setTimeout((function(){i.trigger(Ie.ERROR,{type:be.INVALID_DEVICE,message:"blacklisted browser"})}),0),s(i)||s(i);if(r.image&&r.video)return setTimeout((function(){i.trigger(Ie.ERROR,{type:be.INVALID_RESOURCE,message:"Specifying multi resouces(both image and video) is not valid."})}),0),s(i)||s(i);ct(),i._container=n,i._image=r.image||r.video,i._isVideo=!!r.video,i._projectionType=r.projectionType||Se.EQUIRECTANGULAR,i._cubemapConfig=o({order:i._projectionType===Se.CUBEMAP?"RLUDBF":"RLUDFB",tileConfig:{flipHorizontal:!1,rotation:0}},r.cubemapConfig),i._stereoFormat=r.stereoFormat||Oe.TOP_BOTTOM,i._width=r.width||parseInt(window.getComputedStyle(n).width,10),i._height=r.height||parseInt(window.getComputedStyle(n).height,10),i._yaw=r.yaw||0,i._pitch=r.pitch||0,i._fov=r.fov||65,i._gyroMode=r.gyroMode||Ft.YAWPITCH,i._quaternion=null,i._aspectRatio=0!==i._height?i._width/i._height:1;var a=r.fovRange||[30,110],u=e._isValidTouchDirection(r.touchDirection)?r.touchDirection:qt.TOUCH_DIRECTION_ALL,h=o(r,{element:n,yaw:i._yaw,pitch:i._pitch,fov:i._fov,gyroMode:i._gyroMode,fovRange:a,aspectRatio:i._aspectRatio,touchDirection:u});return i._isReady=!1,i._initYawPitchControl(h),i._initRenderer(i._yaw,i._pitch,i._fov,i._projectionType,i._cubemapConfig),i}a(e,t);var n=e.prototype;return n.getVideo=function(){return this._isVideo?this._photoSphereRenderer.getContent():null},n.setVideo=function(t,e){return void 0===e&&(e={}),t&&this.setImage(t,{projectionType:e.projectionType,isVideo:!0,cubemapConfig:e.cubemapConfig,stereoFormat:e.stereoFormat}),this},n.getImage=function(){return this._isVideo?null:this._photoSphereRenderer.getContent()},n.setImage=function(t,e){void 0===e&&(e={});var n=o({order:"RLUDBF",tileConfig:{flipHorizontal:!1,rotation:0}},e.cubemapConfig),r=e.stereoFormat||Oe.TOP_BOTTOM,i=!!e.isVideo;return this._image&&this._isVideo!==i?(console.warn("Currently not supporting to change content type(Image <--\x3e Video)"),this):(t&&(this._image=t,this._isVideo=i,this._projectionType=e.projectionType||Se.EQUIRECTANGULAR,this._cubemapConfig=n,this._stereoFormat=r,this._deactivate(),this._initRenderer(this._yaw,this._pitch,this._fov,this._projectionType,this._cubemapConfig)),this)},n.keepUpdate=function(t){return this._photoSphereRenderer.keepUpdate(t),this},n.getProjectionType=function(){return this._projectionType},n.enableSensor=function(){return this._yawPitchControl.enableSensor()},n.disableSensor=function(){return this._yawPitchControl.disableSensor(),this},n.enterVR=function(){var t=this;return this._isReady?new ln((function(e,n){t.enableSensor().then((function(){return t._photoSphereRenderer.enterVR()})).then((function(t){return e(t)})).catch((function(t){return n(t)}))})):ln.reject(new Error("PanoViewer is not ready to show image."))},n.exitVR=function(){return this._photoSphereRenderer.exitVR(),this},n._initRenderer=function(t,e,n,r,i){var o=this;this._photoSphereRenderer=new fn(this._image,this._width,this._height,this._isVideo,{initialYaw:t,initialPitch:e,fieldOfView:n,imageType:r,cubemapConfig:i,stereoFormat:this._stereoFormat}),this._photoSphereRenderer.setYawPitchControl(this._yawPitchControl),this._bindRendererHandler(),this._photoSphereRenderer.bindTexture().then((function(){return o._activate()})).catch((function(){o._triggerEvent(Ie.ERROR,{type:be.FAIL_BIND_TEXTURE,message:"failed to bind texture"})}))},n._updateYawPitchIfNeeded=function(){if(this._projectionType===e.ProjectionType.PANORAMA){var t,n,r,i=this._photoSphereRenderer.getContent(),o=i.naturalWidth/i.naturalHeight;o<1&&(o=1/o),o<6?(n=ft.toDegree(o),t=!1,r=2*ft.toDegree(Math.atan(.5))):(n=360,t=!0,r=360/o);var a=this._yawPitchControl.option("fovRange")[0];this._yawPitchControl.option({fov:r,yawRange:[-n/2,n/2],isCircular:t,pitchRange:[-r/2,r/2],fovRange:[a,r]}),this.lookAt({fov:r})}},n._bindRendererHandler=function(){var t=this;this._photoSphereRenderer.on(fn.EVENTS.ERROR,(function(e){t.trigger(Ie.ERROR,e)})),this._photoSphereRenderer.on(fn.EVENTS.RENDERING_CONTEXT_LOST,(function(e){t._deactivate(),t.trigger(Ie.ERROR,{type:be.RENDERING_CONTEXT_LOST,message:"webgl rendering context lost"})}))},n._initYawPitchControl=function(t){var e=this;this._yawPitchControl=new qt(t),this._yawPitchControl.on(Ie.ANIMATION_END,(function(t){e._triggerEvent(Ie.ANIMATION_END,t)})),this._yawPitchControl.on("change",(function(t){e._yaw=t.yaw,e._pitch=t.pitch,e._fov=t.fov,e._quaternion=t.quaternion,e._triggerEvent(Ie.VIEW_CHANGE,t)}))},n._triggerEvent=function(t,e){var n=e||{};return this.trigger(t,n)},n.setUseZoom=function(t){return"boolean"==typeof t&&this._yawPitchControl.option("useZoom",t),this},n.setUseKeyboard=function(t){return this._yawPitchControl.option("useKeyboard",t),this},n.setGyroMode=function(t){return this._yawPitchControl.option("gyroMode",t),this},n.setFovRange=function(t){return this._yawPitchControl.option("fovRange",t),this},n.getFovRange=function(){return this._yawPitchControl.option("fovRange")},n.updateViewportDimensions=function(t){if(void 0===t&&(t={width:void 0,height:void 0}),!this._isReady)return this;var e;void 0!==t.width&&void 0!==t.height||(e=window.getComputedStyle(this._container));var n=t.width||parseInt(e.width,10),r=t.height||parseInt(e.height,10);return n===this._width&&r===this._height?this:(this._width=n,this._height=r,this._aspectRatio=n/r,this._photoSphereRenderer.updateViewportDimensions(n,r),this._yawPitchControl.option("aspectRatio",this._aspectRatio),this._yawPitchControl.updatePanScale({height:r}),this.lookAt({},0),this)},n.getFov=function(){return this._fov},n._getHFov=function(){return ft.toDegree(2*Math.atan(this._aspectRatio*Math.tan(l(this._fov)/2)))},n.getYaw=function(){return this._yaw},n.getPitch=function(){return this._pitch},n.getYawRange=function(){return this._yawPitchControl.option("yawRange")},n.getPitchRange=function(){return this._yawPitchControl.option("pitchRange")},n.setYawRange=function(t){return this._yawPitchControl.option("yawRange",t),this},n.setPitchRange=function(t){return this._yawPitchControl.option("pitchRange",t),this},n.setShowPolePoint=function(t){return this._yawPitchControl.option("showPolePoint",t),this},n.lookAt=function(t,e){if(!this._isReady)return this;var n=void 0!==t.yaw?t.yaw:this._yaw,r=void 0!==t.pitch?t.pitch:this._pitch,i=this._yawPitchControl.option("pitchRange"),o=i[1]-i[0],a=void 0!==t.fov?t.fov:this._fov;return o<a&&(a=o),this._yawPitchControl.lookAt({yaw:n,pitch:r,fov:a},e),0===e&&this._photoSphereRenderer.renderWithYawPitch(n,r,a),this},n._activate=function(){this._photoSphereRenderer.attachTo(this._container),this._yawPitchControl.enable(),this.updateViewportDimensions(),this._isReady=!0,this._updateYawPitchIfNeeded(),this._triggerEvent(Ie.READY),this._photoSphereRenderer.startRender()},n._deactivate=function(){this._isReady&&(this._photoSphereRenderer.stopRender(),this._yawPitchControl.disable(),this._isReady=!1),this._photoSphereRenderer&&(this._photoSphereRenderer.destroy(),this._photoSphereRenderer=null)},e._isValidTouchDirection=function(t){return t===e.TOUCH_DIRECTION.NONE||t===e.TOUCH_DIRECTION.YAW||t===e.TOUCH_DIRECTION.PITCH||t===e.TOUCH_DIRECTION.ALL},n.setTouchDirection=function(t){return e._isValidTouchDirection(t)&&this._yawPitchControl.option("touchDirection",t),this},n.getTouchDirection=function(){return this._yawPitchControl.option("touchDirection")},n.destroy=function(){return this._deactivate(),this._yawPitchControl&&(this._yawPitchControl.destroy(),this._yawPitchControl=null),this},e.isSupported=function(){return ye.isWebGLAvailable()&&ye.isStableWebGL()},e.isWebGLAvailable=function(){return ye.isWebGLAvailable()},e.isGyroSensorAvailable=function(t){var n;st?ln.race([new ln((function(t,e){n=function(e){var n=!(null==e.rotationRate.alpha);t(n)},window.addEventListener("devicemotion",n)})),new ln((function(t,e){setTimeout((function(){return t(!1)}),1e3)}))]).then((function(r){window.removeEventListener("devicemotion",n),t&&t(r),e.isGyroSensorAvailable=function(t){return t&&t(r),r}})):t&&t(!1)},e}(n);return t.VERSION="3.3.0",t.ERROR_TYPE=be,t.EVENTS=Ie,t.PROJECTION_TYPE=Se,t.GYRO_MODE=Ft,t.ProjectionType=Se,t.STEREO_FORMAT=Oe,t.TOUCH_DIRECTION={NONE:qt.TOUCH_DIRECTION_NONE,YAW:qt.TOUCH_DIRECTION_YAW,PITCH:qt.TOUCH_DIRECTION_PITCH,ALL:qt.TOUCH_DIRECTION_ALL},t}();t.PanoViewer=_n,t.VERSION="3.3.0",Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=view360.panoviewer.min.js.map
